# 鸟哥的Linux私房菜-服务器架设篇

## 1.架设服务器前的准备工作

架站需要很强的 Linux 基础概念以及基础网络知识

对于网络服务器来说最重要的基础档案权限、程序之启动关闭与管 理、 Bash shell 之操作与 script 、使用者账号的管理等等，您都必须要具备最基础 的认知才行

> Linux/Unix 的文件调用权限分为三级 : 文件所有者（Owner）、用户组（Group）、其它用户（Other Users）。
>
> | r    | 读       | 设置为可读权限   |
> | ---- | -------- | ---------------- |
> | w    | 写       | 设置为可写权限   |
> | x    | 执行权限 | 设置为可执行权限 |

## 2.基础网络概念

一组合理的网络设定需

 IP  Netmask  Network  Broadcast  Gateway  DNS

Network 与 Broadcast 可以经由 IP/Netmask 的计算而得到，因此需 要设定于你 PC 端的网络参数， 主要就是 IP, Netmask, Default Gateway, DNS 这四 个就是了！

## 3.局域网络架构简介

proxy 服务器:代理服务器，可以通过其来实现防火墙功能与网络浏览数据分析等功能。

让 Linux 作为 IP 分享器的功能相当的简单，同时Linux 必须具备两张网络卡，分别是对外与对内.
该主机必须要具有 router 的能力，所以当然必须就要有两个接口，一个接口与 Internet 沟通，另一个接口则与内部的 LAN 沟通。那么为什么鸟哥说的是『两个网络接口』而不是『两张网络卡』呢？原因很简单， 因为一张网络卡可以设定多个 IP 啊！因此，在 Linux 当中一张网络卡可以具有一个以上的 IP 呢！由于一个 IP 即为一个网络接口，因此只要两个网络接口 (不论有几张网络卡) 即可进行 NAT (类似 IP 分享器功能) 的设定啦！所以自然一个网络卡即可啰！不过，鸟哥个人还是比较喜欢并且建议两张网络卡的啦， 将内外网络环境完整的分开，让你的内部网络效能较佳一点！
(page 103)

4.
1. 取得官方网站的驱动程序
2. 解压缩与编译
3. 模块重载
4. 设定 IP 

hostname

1. IP/Netmask/Gateway 的设定、启动与观察
设定网络参数得要修改 /etc/sysconfig/network-scripts/ifcfg-eth0
2. DNS 服务器的 IP 设定与观察
3. 主机名的修改、启动与观察

可自动取得 IP 的环境是怎么回事啊？不是很简单吗？当你在 IP 分享器后头的主机在设定时，不是都会选择『自动取得 IP 』吗？那就是可自动取得 IP 的环境啦！那么这个自动取得是怎么回事啊？也不难了解啦，其实就是『有一部主机提供 DHCP 服务给整个网域内的计算机』就是了！例如 IP 分享器就可能是一部 DHCP 主机。那么DHCP 是啥？ 他是：Dynamic Host Configuration Protocol 的简写，顾名思义，他可以『动态的调整主机的网络参数』的意思。

线网络所需要的硬件： AP、无线网卡
我们知道在 RJ-45 的以太网络联机环境中，以 switch/hub 以及网络卡与网络线最重要，该架构中主要以 switch/hub 串接所有的网络设备。那么在无线网络中，当然也需要一个接收讯号的装置，那就是无线基地台 (Wireless Access Point, 简称 AP) 了！另一个装置当然就是安装在计算机主机上面的无线网卡啰！
其实无线基地台本身就是个 IP 分享器了，他本身会有两个接口，一个可以与外部的 IP 做沟通，另外一个则是作为 LAN 内部其他主机的 GATEWAY 啰！那其他主机上面只要安装了无线网卡，并且顺利的连上 AP 后，自然就可以透过 AP 来连上 Internet 啦！
『如果 AP 不设
定任何联机限制，那任何拥有无线网卡的主机都可以透过这个 AP 连接上你的 LAN 』，要知道，通常我们都会认为 LAN 是信任网域，所以内部是没有防火墙的，亦即是不设防的状态，呵呵！ 如果刚好有人拿着笔记本电脑经过你的 AP 可以接收讯号的范围，那么他就可以轻易的透过你的 AP 连接上你的 LAN ，并且可以透过你的 AP 连上Internet ，如果他刚好是个喜欢搞破坏的 cracker ， 哈哈！那么当他使用你的 AP 去攻击别人时，最后被发现的跳板是谁？当然是你的 AP！ 那是谁会吃上官司？够清楚了吧？而且你内部主机的数据也很有可能被窃取啊！
Linux 以太网络卡的默认代号为 eth0, eth1 等等, 无线网卡则为 wlan0, ra0 等等；
最简单的方法就是『给予内部的主机每部主机一个名称与IP 的对应』即可。举例来说，我们知道每部主机都有一个主机名为 localhost ，对应到 127.0.0.1 ，为什么呢？因为这个 127.0.0.1 与 localhost 的对应就被写到/etc/hosts 内嘛！ 当我们需要主机名与 IP 的对应时，系统就会先到 /etc/hosts 找寻对应的设定值， 如果找不到，才会使用 /etc/resolv.conf 的设定去因特网找。这
样说，你明白了吧？ 也就是说，只要修改了 /etc/hosts，加入每部主机与 IP 的对应，就能够加快主机名的检查啰！所以说，你就要将你的 私有 IP 的计算机与计算机名称写入你的/etc/hosts 当中了！

5
ifup 与 ifdown 真是太简单了！这两支程序其实是 script 而已，他会直接到/etc/sysconfig/network-scripts 目录下搜寻对应的配置文件，例如 ifup eth0 时，他会找出 ifcfg-eth0 这个档案的内容，然后来加以设定。
route 与 route -n 的输出结果，你可以发现有加 -n 参数的主要是显示出 IP ，至于使用 route 而已的话，显示的则是『主机名』喔！
Gateway：该网域是通过哪个 gateway 连接出去的？如果显示 0.0.0.0 表示该路由是直接由本机传送，亦即可以透过局域网络的 MAC 直接传讯；如果有显示 IP 的话，表示该路由需要经过路由器 (通讯闸) 的帮忙才能够传送出去。
ip link show
如果说 ip link 是与 OSI 七层协定 的第二层资料连阶层有关的话，那么 ip address (ip addr) 就是与第三层网络层有关的参数啦！ 主要是在设定与 IP 有关的各项参数，包括 netmask, broadcast 等等。
 无线网络： iwlist, iwconfig
 
  netstat -tulnp
  -t ：仅列出 TCP 封包的联机；
 -u ：仅列出 UDP 封包的联机；
 -l ：仅列出有在 Listen (监听) 的服务之网络状态；
 -n ：不使用主机名与服务名称，使用 IP 与 port number ，如同 route -n与网络接口有关的参数：
 
上面最重要的其实是那个 -l 的参数，因为可以仅列出有在 Listen 的
port

『Client 端是随机取一个大于 1024 以上的port 进行联机』，此外『只有 root 可以启动小于 1024 以下的 port 』

如果说 links 是在进行网页的『浏览』，那么 wget 就是在进行『网页数据的取得』。举例来说，我们的 Linux 核心是放置在 www.kernel.org 内，主要同时提供 ftp 与 http 来下载。我们知道可以使用 lftp 来下载资料，但如果想要用浏览器来下载呢？那就利用 wget 吧！

wget虽然功能强大，但是使用起来还是比较简单的，基本的语法是：wget [参数列表] URL。

 说实在的，对于 tcpdump 这个软件来说，你甚至可以说这个软件其实就是个黑客软件， 因为他不但可以分析封包的流向，连封包的内容也可以进行『监听』， 如果你使用的传输数据是明码的话，不得了，在 router 或 hub 上面就可能被人家监听走了！


这个 nc 指令可以用来作为某些服务的检测，因为他可以连接到某个 port 来进行沟通，此外，还可以自行启动一个 port 来倾听其他用户的联机吶！

GJ-vFSCP-GUK[Tue Jun 28][13:56:44]root@usp00:~# nc fs000 35002
abc
hhhhhhh
usp00
^Z
[1]+  Stopped                 nc fs000 35002
GJ-vFSCP-GUK[Tue Jun 28][14:05:22]root@usp00:~#

GJ-vFSCP-GUK[Tue Jun 28][14:03:25]root@fs000:~# nc -l fs000 35002
abc
hhhhhhh
usp00
^Z
[4]+  Stopped                 nc -l fs000 35002


6
确认 DNS 查询：利用 nslookup 或 host 或 dig 检查 www.google.com 看看；
确认 Internet 节点：可以利用 traceroute 检查各节点是否没问题？

7
为了避免前面一个步骤的权限误用，或者是程序有问题所造成的资安状况，因此Security Enhanced Linux (安全强化 Linux) 就来发挥它的功能啦！简单的说，SELinux 可以针对网络服务的权限来设定一些规则 (policy) ，让程序能够进行的功能有限， 因此即使使用者的档案权限设定错误，以及程序有问题时，该程序能够进行的动作还是被限制的，即使该程序使用的是 root 的权限也一样。举例来说，前一个步骤的 httpd 真的被 cracker 攻击而让对方取得 root 的使用权，由于 httpd 已经被 SELinux 控制在 /var/www/html 里面，且能够进行的功能已经被规范住了，因此 cracker 就无法使用该程序来进行系统的进一步破坏啰。现在这个 SELinux 一定要开启喔！
如此一来，我们针对控制的『主体』变成了『程序』而不是『使用者』喔！
假设你需要对全世界开放 WWW ，那么提供WWW 服务的 httpd 这只程序就得要执行，并且，你的防火墙得要打开 port 80 让全世界都可以连接到你的 port 80 ，这样才是一部合理的 WWW 服务器嘛！
根据网络上面多年来的观察，很多朋友在发生权限不足方面的问题后，都会直接将某个目录直接修订成为 chmod -R 777 /some/path/。 如果这部主机只是测试用的没有上网提供服务，那还好。如果有上网提供某些服务时，那可就伤脑筋了！
 那如果由于当初规划的账号身份与群组设定的太杂乱，导致无法使用单纯的三种身份的三种权限来设定你的系统时，那该如何是好？ 没关系的，可以透过 ACL 这个好用的东西！ ACL 可以针对单一账号或单一群组进行特定的权限设定，相当好用喔！ 
如果全世界使用 CentOS 的朋友通通联机到同一部 Yum 服务器去下载所需要的 RPM 档案，哇！ 那带宽不就很容易被塞爆！那怎办？没关系，有所谓的映射站啊！ CentOS 在世界各地都有映像站，这些映像站会将官网的 yum 服务器的数据复制一份，同时在映射站上面也提供同样的 yum 功能，因此，你可以在任何一部 yum 服务器的映像站上面下载与安装软件。
我们知道浏览器默认会连接到 WWW 主机的 port 80，那么你的 WWW 是否可以启动在非 80 的其他埠口？ 当然可以啊！你可以透过 WWW 软件的设定功能将该软件使用的 port 启动在非正规的埠口， 只是如此一来，您的客户端要连接到你的主机时，就得要在浏览器的地方额外指定你所启用的非正规的埠口才行。 这个启动在非正规的端口口功能，常常被用在一些所谓的地下网站啦。另外，某些软件默认就启动在大于 1024 以上的端口口，如 MySQL 数据库软件就启动在 3306。
删除已建立或在监听当中的联机：如果想要将已经建立，或者是正在监听当中的网络服务关闭的话，最简单的方法当然就是找出该联机的 PID， 然后将他 kill 掉即可啊！

