# 鸟哥的Linux私房菜-服务器架设篇

## 第一部份：架站前的进修专区

### 1.架设服务器前的准备工作

架站需要很强的 Linux 基础概念以及基础网络知识

对于网络服务器来说最重要的基础档案权限、程序之启动关闭与管 理、 Bash shell 之操作与 script 、使用者账号的管理等等，您都必须要具备最基础 的认知才行

> Linux/Unix 的文件调用权限分为三级 : 文件所有者（Owner）、用户组（Group）、其它用户（Other Users）。
>
> | r    | 读       | 设置为可读权限   |
> | ---- | -------- | ---------------- |
> | w    | 写       | 设置为可写权限   |
> | x    | 执行权限 | 设置为可执行权限 |

### 2.基础网络概念

一组合理的网络设定需

 IP  Netmask  Network  Broadcast  Gateway  DNS

Network 与 Broadcast 可以经由 IP/Netmask 的计算而得到，因此需 要设定于你 PC 端的网络参数， 主要就是 IP, Netmask, Default Gateway, DNS 这四 个就是了！

### 3.局域网络架构简介

> proxy 服务器:代理服务器，可以通过其来实现防火墙功能与网络浏览数据分析等功能。
>

让 Linux 作为 IP 分享器的功能相当的简单，同时Linux 必须具备两张网络卡，分别是对外与对内.
该主机必须要具有 router 的能力，所以当然必须就要有两个接口，一个接口与 Internet 沟通，另一个接口则与内部的 LAN 沟通。那么为什么鸟哥说的是『两个网络接口』而不是『两张网络卡』呢？原因很简单， 因为一张网络卡可以设定多个 IP 啊！因此，在 Linux 当中一张网络卡可以具有一个以上的 IP 呢！由于一个 IP 即为一个网络接口，因此只要两个网络接口 (不论有几张网络卡) 即可进行 NAT (类似 IP 分享器功能) 的设定啦！所以自然一个网络卡即可啰！不过，鸟哥个人还是比较喜欢并且建议两张网络卡的啦， 将内外网络环境完整的分开，让你的内部网络效能较佳一点！

### 4.连上Internet

1. 取得官方网站的驱动程序
2. 解压缩与编译
3. 模块重载
4. 设定 IP 

hostname

1. IP/Netmask/Gateway 的设定、启动与观察
设定网络参数得要修改 /etc/sysconfig/network-scripts/ifcfg-eth0
2. DNS 服务器的 IP 设定与观察
3. 主机名的修改、启动与观察

可自动取得 IP 的环境是怎么回事啊？不是很简单吗？当你在 IP 分享器后头的主机在设定时，不是都会选择『自动取得 IP 』吗？那就是可自动取得 IP 的环境啦！那么这个自动取得是怎么回事啊？也不难了解啦，其实就是『有一部主机提供 DHCP 服务给整个网域内的计算机』就是了！例如 IP 分享器就可能是一部 DHCP 主机。那么DHCP 是啥？ 他是：Dynamic Host Configuration Protocol 的简写，顾名思义，他可以『动态的调整主机的网络参数』的意思。

线网络所需要的硬件： AP、无线网卡
我们知道在 RJ-45 的以太网络联机环境中，以 switch/hub 以及网络卡与网络线最重要，该架构中主要以 switch/hub 串接所有的网络设备。那么在无线网络中，当然也需要一个接收讯号的装置，那就是无线基地台 (Wireless Access Point, 简称 AP) 了！另一个装置当然就是安装在计算机主机上面的无线网卡啰！
其实无线基地台本身就是个 IP 分享器了，他本身会有两个接口，一个可以与外部的 IP 做沟通，另外一个则是作为 LAN 内部其他主机的 GATEWAY 啰！那其他主机上面只要安装了无线网卡，并且顺利的连上 AP 后，自然就可以透过 AP 来连上 Internet 啦！
『如果 AP 不设定任何联机限制，那任何拥有无线网卡的主机都可以透过这个 AP 连接上你的 LAN 』，要知道，通常我们都会认为 LAN 是信任网域，所以内部是没有防火墙的，亦即是不设防的状态，呵呵！ 如果刚好有人拿着笔记本电脑经过你的 AP 可以接收讯号的范围，那么他就可以轻易的透过你的 AP 连接上你的 LAN ，并且可以透过你的 AP 连上Internet ，如果他刚好是个喜欢搞破坏的 cracker ， 哈哈！那么当他使用你的 AP 去攻击别人时，最后被发现的跳板是谁？当然是你的 AP！ 那是谁会吃上官司？够清楚了吧？而且你内部主机的数据也很有可能被窃取啊！
Linux 以太网络卡的默认代号为 eth0, eth1 等等, 无线网卡则为 wlan0, ra0 等等；
最简单的方法就是『给予内部的主机每部主机一个名称与IP 的对应』即可。举例来说，我们知道每部主机都有一个主机名为 localhost ，对应到 127.0.0.1 ，为什么呢？因为这个 127.0.0.1 与 localhost 的对应就被到/etc/hosts 内嘛！ 当我们需要主机名与 IP 的对应时，系统就会先到 /etc/hosts 找寻对应的设定值， 如果找不到，才会使用 /etc/resolv.conf 的设定去因特网找。这样说，你明白了吧？ 也就是说，只要修改了 /etc/hosts，加入每部主机与 IP 的对应，就能够加快主机名的检查啰！所以说，你就要将你的 私有 IP 的计算机与计算机名称写入你的/etc/hosts 当中了！

### 5.Linux常用网络指令

ifup 与 ifdown 真是太简单了！这两支程序其实是 script 而已，他会直接到/etc/sysconfig/network-scripts 目录下搜寻对应的配置文件，例如 ifup eth0 时，他会找出 ifcfg-eth0 这个档案的内容，然后来加以设定。
route 与 route -n 的输出结果，你可以发现有加 -n 参数的主要是显示出 IP ，至于使用 route 而已的话，显示的则是『主机名』喔！
Gateway：该网域是通过哪个 gateway 连接出去的？如果显示 0.0.0.0 表示该路由是直接由本机传送，亦即可以透过局域网络的 MAC 直接传讯；如果有显示 IP 的话，表示该路由需要经过路由器 (通讯闸) 的帮忙才能够传送出去。
ip link show
如果说 ip link 是与 OSI 七层协定 的第二层资料连阶层有关的话，那么 ip address (ip addr) 就是与第三层网络层有关的参数啦！ 主要是在设定与 IP 有关的各项参数，包括 netmask, broadcast 等等。
 无线网络： iwlist, iwconfig

  netstat -tulnp
  -t ：仅列出 TCP 封包的联机；
 -u ：仅列出 UDP 封包的联机；
 -l ：仅列出有在 Listen (监听) 的服务之网络状态；
 -n ：不使用主机名与服务名称，使用 IP 与 port number ，如同 route -n与网络接口有关的参数：

上面最重要的其实是那个 -l 的参数，因为可以仅列出有在 Listen 的port

『Client 端是随机取一个大于 1024 以上的port 进行联机』，此外『只有 root 可以启动小于 1024 以下的 port 』

如果说 links 是在进行网页的『浏览』，那么 wget 就是在进行『网页数据的取得』。举例来说，我们的 Linux 核心是放置在 www.kernel.org 内，主要同时提供 ftp 与 http 来下载。我们知道可以使用 lftp 来下载资料，但如果想要用浏览器来下载呢？那就利用 wget 吧！

wget虽然功能强大，但是使用起来还是比较简单的，基本的语法是：wget [参数列表] URL。

 说实在的，对于 tcpdump 这个软件来说，你甚至可以说这个软件其实就是个黑客软件， 因为他不但可以分析封包的流向，连封包的内容也可以进行『监听』， 如果你使用的传输数据是明码的话，不得了，在 router 或 hub 上面就可能被人家监听走了！


这个 nc 指令可以用来作为某些服务的检测，因为他可以连接到某个 port 来进行沟通，此外，还可以自行启动一个 port 来倾听其他用户的联机吶！

```
GJ-vFSCP-GUK[Tue Jun 28][13:56:44]root@usp00:~# nc fs000 35002
abc
hhhhhhh
usp00
^Z
[1]+  Stopped                 nc fs000 35002
GJ-vFSCP-GUK[Tue Jun 28][14:05:22]root@usp00:~#

GJ-vFSCP-GUK[Tue Jun 28][14:03:25]root@fs000:~# nc -l fs000 35002
abc
hhhhhhh
usp00
^Z
[4]+  Stopped                 nc -l fs000 35002
```

通过杀掉进程的方法来关闭端口

每个端口都有一个守护进程，kill掉这个守护进程就可以了

每个端口都是一个进程占用着，

第一步、用下面命令

netstat -anp |grep 端口

找出占用这个端口的进程，

第二步、用下面命令

kill -9 PID

杀掉就行了

### 6.Linux网络侦错

确认 DNS 查询：利用 nslookup 或 host 或 dig 检查 www.google.com 看看；
确认 Internet 节点：可以利用 traceroute 检查各节点是否没问题？

## 第二部分：主机的简易资安防护措施

### 7.网络安全与主机基本防护

为了避免前面一个步骤的权限误用，或者是程序有问题所造成的资安状况，因此Security Enhanced Linux (安全强化 Linux) 就来发挥它的功能啦！简单的说，SELinux 可以针对网络服务的权限来设定一些规则 (policy) ，让程序能够进行的功能有限， 因此即使使用者的档案权限设定错误，以及程序有问题时，该程序能够进行的动作还是被限制的，即使该程序使用的是 root 的权限也一样。举例来说，前一个步骤的 httpd 真的被 cracker 攻击而让对方取得 root 的使用权，由于 httpd 已经被 SELinux 控制在 /var/www/html 里面，且能够进行的功能已经被规范住了，因此 cracker 就无法使用该程序来进行系统的进一步破坏啰。现在这个 SELinux 一定要开启喔！
如此一来，我们针对控制的『主体』变成了『程序』而不是『使用者』喔！
 SELinux 并非防火墙，他是用来作为更细部权限设定的一个核心模块。
假设你需要对全世界开放 WWW ，那么提供WWW 服务的 httpd 这只程序就得要执行，并且，你的防火墙得要打开 port 80 让全世界都可以连接到你的 port 80 ，这样才是一部合理的 WWW 服务器嘛！
根据网络上面多年来的观察，很多朋友在发生权限不足方面的问题后，都会直接将某个目录直接修订成为 chmod -R 777 /some/path/。 如果这部主机只是测试用的没有上网提供服务，那还好。如果有上网提供某些服务时，那可就伤脑筋了！
 那如果由于当初规划的账号身份与群组设定的太杂乱，导致无法使用单纯的三种身份的三种权限来设定你的系统时，那该如何是好？ 没关系的，可以透过 ACL 这个好用的东西！ ACL 可以针对单一账号或单一群组进行特定的权限设定，相当好用喔！ 
如果全世界使用 CentOS 的朋友通通联机到同一部 Yum 服务器去下载所需要的 RPM 档案，哇！ 那带宽不就很容易被塞爆！那怎办？没关系，有所谓的映射站啊！ CentOS 在世界各地都有映像站，这些映像站会将官网的 yum 服务器的数据复制一份，同时在映射站上面也提供同样的 yum 功能，因此，你可以在任何一部 yum 服务器的映像站上面下载与安装软件。
我们知道浏览器默认会连接到 WWW 主机的 port 80，那么你的 WWW 是否可以启动在非 80 的其他埠口？ 当然可以啊！你可以透过 WWW 软件的设定功能将该软件使用的 port 启动在非正规的埠口， 只是如此一来，您的客户端要连接到你的主机时，就得要在浏览器的地方额外指定你所启用的非正规的埠口才行。 这个启动在非正规的端口口功能，常常被用在一些所谓的地下网站啦。另外，某些软件默认就启动在大于 1024 以上的端口口，如 MySQL 数据库软件就启动在 3306。
删除已建立或在监听当中的联机：如果想要将已经建立，或者是正在监听当中的网络服务关闭的话，最简单的方法当然就是找出该联机的 PID， 然后将他 kill 掉即可啊！

### 8.路由观念与路由设定

eth0:0 这个装置吧？这个装置可以在原本的 eth0 上面模拟出一个虚拟接口出来，以让我们原本的网络卡具有多个 IP ，具有多个 IP 的功能就被称为 IP Alias 了。而这个 eth0:0 的装置可以透过 ifconfig或 ip 这两个指令来达成
基本上，除非有特殊需求，否则建议你要有多个 IP 时，最好在不同的网卡上面达成
一般来说，不应该设定同一的网段的不同 IP 在同一部主机上面。

 那么路由器的功能
可以如何达成呢？目前有两种方法可以达成：
 硬件功能：例如 Cisco, TP-Link, D-Link (注 2) 等公司都有生产硬件路由器， 这些路由器内有嵌入式的操作系统，可以负责不同网域间的封包转译与转递等功能；
 软件功能：例如 Linux 这个操作系统的核心就有提供封包转递的能力。

了解了路由器之后，接下来你可能需要了解到什么是 **NAT (**Network Address Translation, 网络地址转换) 服务器，NAT 是啥？其实 IP 分享器就是最简单的 NAT 服务器啦！嘿嘿，了解了吗？没错， NAT 可以达成 IP 分享的功能， 而 NAT 本身就是一个路由器，只是 NAT 比路由器多了一个『 IP 转换』的功能。
一般来说，路由器会有两个网络接口，透过路由器本身的 IP 转递功能让两个网域可以互相沟通网络封包。那如果两个接口一边是公共 IP (public IP) 但一边是私有 IP (private IP) 呢？ 由于私有 IP 不能直接与公共 IP 沟通其路由信息，此时就得要额外的『 IP 转译』功能了
Linux 的 NAT 服务器可以透过修改封包的 IP 表头数据之来源或目标 IP ，让来自私有 IP 的封包可以转成 NAT 服务器的公共 IP ，就可以连上Internet ！

目前常见的动态路由协议有：RIPv1, RIPv2, OSPF, BGP 等。

### 9.防护墙与NAT服务器

我们这个章节主要在介绍 Linux 系统本身提供的软件防火墙的功能，那就是 Netfilter 。至于 TCP Wrappers 虽然在基础篇的第十八章认识系统服务里面谈过了，我们这里还会稍微简单的介绍啦！
Netfilter (封包过滤机制) :由于这种方式可以直接分析封包表头数据，所以包括硬件地址(MAC), 软件地址 (IP), TCP, UDP, ICMP 等封包的信息都可以进行过滤分析的功能，因此用途非常的广泛。(其实主要分析的是OSI 七层协议的 2, 3, 4 层啦) 
在 Linux 上面我们使用核心内建的 Netfilter 这个机制，而 Netfilter 提供了 iptables 这个软件来作为防火墙封包过滤的指令。由于 Netfilter 是核心内建的功能，因此他的效率非常的高！ 非常适合于一般小型环境的设定呢！

一般 proxy 主机通常仅开放 port 80, 21, 20 等 WWW 与 FTP 的埠口而已，而且通常 Proxy 就架设在路由器上面，因此可以完整的掌控局域网络内的对外联机！

防火墙的设定主要使用的就是 iptables 这个指令而已。而防火墙是系统管理员的主要任务之一， 且对于系统的影响相当的大，因『只能让 root 使用 iptables 』，不论是设定还是观察防火墙规则喔！

我们在前一章谈到所谓的阻断式服务 (DoS) 攻击法当中的一种方式，就是利用 TCP 封包的 SYN 三向交握原理所达成的， 这种方式称为 SYN Flooding 。那如 何预防这种方式的攻击呢？我们可以启用核心的 SYN Cookie 模块啊！ 这个 SYN Cookie 模块可以在系统用来启动随机联机的埠口 (1024:65535) 即将用完 时自动启动。

鸟哥还 是比较偏好使用脚本来撰写防火墙， 然后透过最终的 /etc/init.d/iptables save 来 将结果储存到 /etc/sysconfig/iptables 去！ 而且此一特色还可以用在呼叫其他的 scripts ，可以让防火墙规则具有较为灵活的使用方式。

NAT 服务器与路由器有啥不同？基本上，NAT 服务器一定是路由器， 不过， NAT 服务器由于会修改 IP 表头数据， 因此与单纯转递封 包的路由器不同。。最常见的 IP 分享器就是一个路由器，但是这个 IP 分享器一定会有一个 Public IP 与一个 Private IP，让 LAN 内 的 Private IP 可以透过 IP 分享器的 Public IP 传送出去喔！至 于路由器通常两边都是 Public IP 或同时为 Private IP。

你的 NAT 服务器必须要有一个 public IP 接口， 以及一个内部 LAN 连接的 private IP 接口才行。底下的范例中，鸟哥的假设是这样 的： 

 外部接口使用 eth0 ，这个接口具有 public IP 喔； 

 内部接口使用 eth1 ，假设这个 IP 为 192.168.100.254 ；

你的 Linux 就拥有主机防火墙以及 NAT 服务器的功能了

防火墙依据封包抵挡的阶层，可以分为 Proxy 以及 IP Filter (封包过滤)  两种类型；

### 10. 申请合法的主机名

早期连上网络的计算机数量不多，所以在网络上的人们就想出一个简单的办法来进行主机名与 IP 的对应，那就是『在每部计算机的 /etc/hosts 里面设定好主机名与 IP 的对应表』。那么人们就可以直接藉由主机名来连接上某些网络上的主机啰！
然而因为科技的发达，连上 Internet 的人们越来越多，使用 /etc/hosts 的方法已经搞不定了 (只要一部新计算机上线，全部 Internet 上面的所有计算机都要重新改写 /etc/hosts 才行！) ，这个时候领域名系统 ( Domain Name System, DNS ) 就适时的出现了！
DNS 是个很庞大的架构，而且是串连在全球的网络当中，除非你经由『注册』的手续来让 DNS 系统承认你主机名存在的合法性，否则你架设的 DNS 只能说是一个『地下练习的测试站』而已啦！

很多小网站都是以非固定 IP 来上网的,很多 ISP 提供了所谓的动态 DNS 服务的功能，他是这样做的：
1. Client 端(就是你啦)每次开机或者是重新拨接，并取得一个新的 IP 之后，会主动向 DNS Server 端提出要求，希望 Server 端变更主机名与 IP 的对应(这个步骤在每个主要的 ISP 都有提供适当的程序来提供给 client 使用)；
2. Server 端接受 Client 端的要求之后，会先去查询 Client 提供的账号密码是否正确， 若正确就会立即修改 Server 本身对于你的主机名的设定值。

## 第三部分：局域网络内常见的服务器架设

### 11.远程联机服务器 SS/XDMCP/VNC/RDP

一部开放到因特网上的服务器，基本上，它可以不需要屏幕、键盘、 鼠标等等的周边配备，只要有基本的主板、CPU、RAM、硬盘再加上一块好一点的网络卡，并且连上因特网， 那这部主机就能够提供你有需要的网络服务了。
文字接口明码： telnet
什么是『明码』与『加密』的数据封包传送模式呢？为什么 telnet 使用明码就比较不安全？所谓的明码就是： 『当我们的数据封包在网络上传输时，该数据封包的内容为数据的原始格式』， 也就是说，你使用 telnet 登入远程主机时，不是得要输入账号密码吗？那你的账号密码是以原本的数据格式传输，所以如果被类似 tcpdump 之类的监听软件撷取数据， 那你的帐密就有可能被窃取啦！
另外一款目前很常见的图形联机服务器，就是 VNC (Virtual Network Computing)， 透过 VNC server/client 软件来进行连接。(VNC 客户端在 Linux 系统上面有默认的软件，但是在Windows 系统上面则必须要额外安装其他软件。)如果你想要使用类似 Windows 的远程桌面联机，该功能使用的是 RDP (Remote Desktop Protocol)，那你可得要架设 RDP 服务器才行。
需要注意的是，SSH 不但提供了 shell 给我们使用，亦即是 ssh protocol 的主要目的，同时亦提供了一个较为安全的 FTP server ，亦即是 ssh-ftp server 给我们当成是 FTP 来使用！所以，这个 sshd 可以同时提供 shell 与 ftp 喔！而且都是架构在port 22 上面的呢！   =>模拟 FTP 的文件传输方式： sftp
ssh 是登入远程服务器进行工作，那如果你只是想要从远程服务器下载或上传档案呢？ 那就不是使用 ssh 啦，而必须要使用 sftp 或 scp。这两个指令也都是使用 ssh 的通道 (port 22)，只是模拟成 FTP 与复制的动作而已。我们先谈谈 sftp ，这个指令的用法与 ssh 很相似，只是 ssh 是用在登入而 sftp 在上传/下载文件而已。
**针对远方服务器主机 (Server) 之行为**
变换目录到 /etc/test 或其他目录

```
cd /etc/test
cd PATH
```

列出目前所在目录下的文件名 

```
ls
dir
```

建立目录 

```
mkdir directory
```

删除目录

```
 rmdir directory
```

显示目前所在的目录

```
 pwd
```

更改档案或目录群组 

```
chgrp groupname PATH
```

更改档案或目录拥有者 

```
chown username PATH
```

更改档案或目录的权限

```
chmod 644 PATH
```

其中，644 与权限有关！回去看基础篇！
建立连结档

```
 ln oldname newname
```

删除档案或目录

```
 rm PATH
```

更改档案或目录名称 

```
rename oldname newname
```

离开远程主机 

```
exit (or) bye (or) quit
```

**针对本机 (Client) 之行为(都加上 l, L 的小写 )**
变换目录到本机的 PATH 当中

```
 lcd PATH
```

列出目前本机所在目录下的文件名

```
 lls
```

在本机建立目录

```
lmkdir
```

显示目前所在的本机目录

```
 lpwd
```

通常使用 sftp 是因为可能不知道服务器上面有什么档名的档案存在，如果已经知道服务器上的档案档名了， 那么最简单的文件传输则是透过 scp 这个指令喔！

一般使用 ssh 登入远程主机，都会填写『 ssh 账号@主机 IP 』的格式， 意思是说，使用该主机的某账号登入的意思。但是很多朋友都不喜欢写账号，亦即使用『 ssh 主机 IP 』的格式。 如同上面的范例情况。要注意喔，如果不写账号的话，那么会以本地端计算机的账号来尝试登入远程。 也就是说，如果近端与远程具有相同的账号，那么不写账号也没有关系，如上表中的范例。但是，为了以后习惯着想， 还是一开始就使用类似 email 的方式来登入远程主机，这样的行为习惯比较好啦！

与 Linux 不同的是，预设的 Windows 并没有 ssh 的客户端程序，因此所有的程序都得要下载其他第三方软件才行。 常见的软件主要有 pietty

基本上，所有的 sshd 服务器详细设定都放在 /etc/ssh/sshd_config 里面！
基本上，CentOS 预设的 sshd 服务已经算是挺安全的了，不过还不够！建议你 (1)将root 的登入权限取消； (2)将 ssh 版本设定为 2 。其他的设定值就请你依照自己的喜好来设定了。 通常不建议进行随便修改啦！另外，如果你修改过上面这个档案(/etc/ssh/sshd_config)，那么就必需要重新启动一次 sshd 这个 daemon 才行！亦即是：

```
/etc/init.d/sshd restart
```

...分别是私钥 (id_rsa) 与公钥 (id_rsa.pub)。 ~/.ssh/ 目录必须要是 700 的权限才行！
sshd 之所谓的『安全』其实指的是『 sshd 的数据是加密过的，所以他的数据在Internet 上面传递时是比较安全的。至于 sshd 这个服务本身就不是那样安全了！所以说：『非必要，不要将 sshd 对 Internet 开放可登入的权限，尽量局限在几个小范围内的 IP 或主机名即可！这很重要的喔！

### 12.网络参数控管者：DHCP服务器

在开始 DHCP 的说明之前，我们先来复习一下之前在第二章网络基础里面提到的几个网络参数吧！ 要设定好一个网络的环境，使计算机可以顺利的连上 Internet ，那么你的计算机里面一定要有底下几个网络的参数才行，分别是：
 IP, netmask, network, broadcast, gateway, DNS IP
 其中，那个 IP, netmask, network, broadcast 与 gateway 都可以在/etc/sysconfig/network-scripts/ifcfg-eth[0-n] 这档案里面设定，DNS 服务器的地址则是在 /etc/resolv.conf 里头设定。只要这几个项目设定正确，那么计算机应该就没问题的可以上网了！ 所以说，你家里面的 3, 4 部计算机，你都可以手动的来设定好你所需要的网络参数， 然后利用 NAT 服务器的功能，就可以大摇大摆的连上Internet 了！真是不错，不是吗？
 (如果你在工作单位使用的是笔记本电脑，而且常常要带着你的笔记本电脑到处跑， 那么由第四章、连上 Internet 的说明中会发现，哇！ 我的网络卡参数要常常修改啊！而且，每到一个新的地方，就得问清楚该地的网络参数才行！真是麻烦。)
这个 DHCP (Dynamic Host Configuration Protocol) 服务器最主要的工作，就是自动的将网络参数正确的分配给网域中的每部计算机， 让客户端的计算机可以在开机的时候就立即自动的设定好网络的参数值，这些参数值可以包括了 IP、netmask、network、gateway 与 DNS 的地址等等。如此一来，身为管理员的你，只要注意到这一部提供网络参数的主机有没有挂掉就好了， 其他同学们的个人计算机，哈！你想都不必想要怎么去帮忙！

DHCP 服务器在接收到这个客户端的要求后，会针对这个客户端的硬件地址 (MAC)与本身的设定数据来进行下列工作：

1. 到服务器的登录文件中寻找该用户之前是否曾经用过某个 IP ，若有且该 IP 目前无人使用，则提供此 IP 给客户端；
2. 若配置文件针对该 MAC 提供额外的固定 IP (static IP) 时，则提供该固定 IP 给客户端；
3. 若不符合上述两个条件，则随机取用目前没有被使用的 IP 参数给客户端，并记录下来。
   (软件的名称 dhcp => 配置文件)
4. 客户端脱机：不论是关闭网络接口 (ifdown)、重新启动 (reboot)、关机 (shutdown) 等行为，皆算是脱机状态，这个时候 Server 端就会将该 IP 回收，并放到 Server 自己的备用区中，等待未来的使用；

不建议使用 DHCP 主机的时机

1. 在你网域内的计算机，有很多机器其实是做为主机的用途，很少用户需求，那么似乎就没有必要架设 DHCP；
2. 更极端的情况是，像一般家里，只有 3 ~ 4 部计算机，这个时候，架设 DHCP 只能拿来练练功力，事实上，并没有多大的效益；

目前市面上的 IP 分享器已经便宜到爆了！而 IP 分享器本身就含有 DHCP 的功能。 所以如果你只是想要单纯的使用 DHCP 在你的局域网络当中而已，那么建议你直接购买一部 IP 分享器来使用即可， 因为至少它很省电。如果你还有其他考虑的话，才来架设 DHCP 吧！
DHCP 的软件需求很简单，就是只要服务器端软件即可，在 CentOS 6.x 上面，这个软件的名称就是 dhcp 啰！如果是默认安装，那么这个软件是不会安装的，请自行使用 yum 去装好这个软件吧！
dhcpd 使用的埠口是 port 67
如果你有仔细的瞧过第二章的网络基础的话，那么应该还会记得那个 /etc/hosts (第四章 4.4.1) 会影响内部计算机在联机阶段的等待时间吧？那么我现在使用 DHCP 之后，糟糕！我怎么知道哪一部 PC 连上我的主机，那要怎么填写 /etc/hosts 的内容呢？这真是太简单了！就将所有可能的计算机 IP 都加进去该档案呀！ 
不过， 更好的解决方案则是架设内部的 DNS 服务器，这样一来，内部的其他 Linux 服务器也不必更改 /etc/hosts 就能够取得每部主机的 IP 与主机名对应，那样就更加妥当啦！
 因此，一个好的区网内，理论上，我们应该在 DHCP 服务器主机上面在安装一个 DNS 服务器，提供内部计算机的名称解析为宜。(DHCP 服务与 DNS 服务的相关性很高；)

### 13.文件服务器之一：NFS服务器

NFS 为 Network FileSystem 的简称，它的目的就是想让不同的机器、不同的操作系统可以彼此分享个别的档案啦！基本上， Unix Like 主机连接到另一部 Unix Like 主机来分享彼此的档案时，使用 NFS 要比 SAMBA 这个服务器快速且方便的多了！
因为预设 NFS 用来传输的埠口是随机选择小于 1024 以下的埠口来使用的。咦！那客户端怎么知道你服务器端使用那个埠口啊？此时就得要 远程过程调用(Remote Procedure Call, RPC) 的协议来辅助啦！
RPC 最主要的功能就是在指定每个 NFS 功能所对应的 port number ，并且回报给客户端，让客户端可以连结到正确的埠口上去。 那 RPC 又是如何知道每个 NFS 的埠口呢？这是因为当服务器在启动NFS 时会随机取用数个埠口，并主动的向 RPC 注册，因此 RPC 可以知道每个端口口对应的 NFS 功能，然后 RPC 又是固定使用 port 111 来监听客户端的需求并回报客户端正确的埠口， 所以当然可以让 NFS 的启动更为轻松愉快了！
也就是说，NFS 必须要有 RPC 存在时才能成功的提供服务，因此我们称 NFS 为 RPC server 的一种。事实上，有很多这样的服务器都是向 RPC 注册的，举例来说，NIS (Network Information Service) 也是 RPC server 的一种呢。
NFS 通常需要与NIS (十四章) 这一个可以确认客户端与服务器端身份一致的服务搭配使用，以避免身份的错乱啊！
NFS 主程序：nfs-utils :就是提供 rpc.nfsd 及 rpc.mountd 这两个 NFS daemons 与其他相关documents 与说明文件、执行文件等的软件！这个就是 NFS 服务所需要的主要软件啦！一定要有喔！

entOS 或者是其他版本的 Linux ，预设核心通常是支持 NFS 功能的，所以你只要确认你的核心版本是目前新的 2.6.x 版，并且使用你的 distribution 所提供的核心，那应该就不会有问题啦！
我们知道开机就挂载的挂载点与相关参数是写入 /etc/fstab 中的，那 NFS 能不能写入 /etc/fstab 当中呢？非常可惜的是， 不可以呢！为啥呢？分析一下开机的流程，我们可以发现网络的启动是在本机挂载之后，因此当你利用 /etc/fstab 尝试挂载NFS 时，系统由于尚未启动网络，所以肯定是无法挂载成功的啦！

一般来说， NFS 的服务仅会对内部网域开放，不会对因特网开放的。

### 14.账号管控：NIS服务器

 Network Information Services (NIS server) 这个服务器软件喔！
NIS 主要提供的是用户的账号、密码、家目录文件名、UID 等信息，但 NIS 并没有提供文件系统。同时， NIS 同样使用前一章谈到的RPC 服务器，
通常我们都会建议，一部 Linux 主机的功能越单纯越好，也就是说，一部 Linux 就专门进行一项服务。这样有许多的好处，这包含功能单纯所以系统资源得以完整运用，并且在发生入侵或者是系统产生状况的时候，也比较容易追查问题所在。
由于『预测』这个玩意儿越来越重要，比如说气象预报、空气质量预报等等，而预测需要一个很庞大的模式来进行仿真的工作， 这么庞大的模拟工作需要大量的运算，在学校单位要买一部很贵的大型主机实在很不容易！不过，如果能够串接十部四核心的个人计算机的话， 那么可能只需要不到 20 万便能够组成相当于具有 40 颗CPU 的大型主机的运算能力了！所以说，在未来 PC cluster 是一个可以发展的课题喔！=>PC cluster 上面的所有计算机就得要有：相同的用户帐户信息，包括账号、密码、家目录等等一大堆信息；

### 15.时间服务器：NTP服务器

如果你架设了一个登录档服务器的话，那么总得要分析每个主机所传来的登录文件信息吧？如果每一部主机的时间都不相同， 那如何判断问题发生的时间点？所以啰，『每一部主机的时间同步化』就很重要了。
那就需要『网络校时』(Network Time Protocol, NTP) 的功能了！底下我们就谈一谈那个 NTP 的 daemon 吧！
Linux 操作系统的计时方式主要是由 1970/01/01 开始计算总秒数，因此，如果你还记得 date 这个指令的话，会发现它有个 +%s 的参数，可以取得总秒数，这个就是软件时钟。
时间服务器
上头介绍了 NTP 服务器的安装与设定，如果我们仅有十部不到的主机时，老实说，实在没有架设 NTP 服务器的需求。 只要能够在你的主机上头以 NTP 客户端软件来进行网络校时就能够同步化时间了，没必要时时刻刻进行时间的校正吧！ 但是，如果是类似一定要时间同步的丛集计算机群或登录服务器群，那就得要使用时间服务器比较好啰！
在软件时钟方面，我们可以透过 date 这个指令来进行手动修订，但如果要修改BIOS 记录的时间，就得要使用 hwclock 这个指令来写入才行。
当我们进行完 Linux 时间的校时后，还需要以 hwclock 来更新BIOS 的时间，因为每次重新启动的时候，系统会重新由 BIOS 将时间读出来，所以，BIOS 才是重要的时间依据吶。
我们以欧洲的格林威治时间为一个对照的依据，这个即是 GMT 时间。台湾时间比 GMT 时间快了 8 小时。至于 UTC 时间则是由原子钟所计算的时间，这个时间是相当的准确的， 主要仍以格林威治时间为时区！

### 16.文件服务器之二：SAMBA服务器

如果想要共享档案，在 Linux 对 Linux 的环境下，最简单的方法就是透过 NFS 这玩意儿了！至于Windows 对 Windows 的环境下，最简单的方法则是是 Common Internet File System, CIFS 这个咚咚啦！那如果你的区网中有 Windows 也有 Linux 而且想要共享文件系统的话，那该怎办？ 那就使用 Samba 服务器吧！Samba 可以让 Linux 加入 Windows 的网芳支持，让异质平台可以共享文件系统！ 非常好用的呦！不仅如此， Samba 也可以让 Linux 上面的打印机成为打印机服务器 (Printer Server)。鸟哥个人觉得， Samba 对于整个区网的贡献真的是很大啦！
Server Message Block (SMB) 这个文件系统，而就是这套 SMB 软件就能够让 Unix 与 DOS 互相的分享数据啰！这个 SAMBA 刚好含有 SMB ， 又是热情有劲的拉丁舞蹈的名称，不然就用这个名字来做为商标好了！这成为我们今天所使用的 SAMBA 的名称由来啦！ 
就像 NFS 是架构在 RPC Server 上面一样， SAMBA 这个文件系统是架构在 NetBIOS (Network Basic Input/Output System, NetBIOS) 这个通讯协议上面所开发出来的。

 SAMBA 使用的 daemons:
我们的 SAMBA 则是透过两支服务来控制这两个步骤，分别是：

1. nmbd ：这个 daemon 是用来管理工作组啦、NetBIOS name 啦等等的解析。主要利用 UDP 协议开启 port 137, 138 来负责名称解析的任务；
2. smbd ：这个 daemon 的主要功能就是用来管理 SAMBA 主机分享的目录、档案与打印机等等。 主要利用可靠的 TCP 协议来传输数据，开放的端口口为 139 及 445(不一定存在) 。

时至今日，打印机的网络功能已经很强悍了！甚至也有支持无线网络的打印机，因此每台打印机都可以独立作为各个 PC 的独自的打印机，老实说也没有必要进行 Samba 的网络打印机服务器啦！但毕竟还是有些比较旧型的机种， 或者买不起有内建网络的打印机时，那么 Samba 的打印机服务器还是有存在的价值啰 (2001/09/17)

### 17.区网控制者：Proxy服务器

一般来说，代理服务器会架设在整个区网的单点对外防火墙上头，而在区网内部的计算机就都是透过 Proxy 来向因特网要求数据的，这就是所谓的『代理服务器』啦！还可以兼做高阶防火墙之用啦

代理服务器与 NAT 服务器的差异:
Linux 的 NAT 功能主要透过封包过滤的方式， 并使用 iptables 的 nat 表格进行 IP 伪装 (SNAT) ，让客户端自行前往因特网上的任何地方的一种方式。主要的运作行为是在 OSI 七层协议的二、三、四层。由于是透过封包过滤与伪装，因此客户端可以使用的端口口号码 (第四层) 较弹性；
主要透过 Proxy 的服务程序 (daemon) 提供网络代理的任务，因此 Proxy 能不能进行某些工作，与该服务的程序功能有关。 举例来说，如果你的 Proxy 并没有提供邮件或 FTP 代理，那么你的客户端就是无法透过 Proxy 去取得这些网络资源。 主要运作的行为在 OSI 七层协议的应用层部分

代理服务器的功能主要有：

1. 作为 WWW 的网页资料取得代理人
2. 作为内部区网的单点对外防火墙系统：而且还不需要设定那复杂的 NAT 功能呢！
   由于 Proxy 的这种特性，让他很常被使用于大型的企业内部，因为可以达到杜绝内部人员上班时使用非 WWW 以外的网络服务，而且还可以监测用户的资料要求流向与流量呢！很不错吧！

达成代理服务器功能的软件很多，例如效能不是很好的 Apache 以及我们这个章节要介绍的八爪章鱼 squid 这一套。
安装好 squid 之后，它主要的提供的配置文件有：...

Proxy 服务放在 NAT 服务器上：通透式代理 (Transparent Proxy)
从上面的说法来看，我们可以发现 proxy 可以做到类似防火墙的功能 (acl dst, acl dstdomain 再配合 http_access 处理)， 但是，我们也知道浏览器得要设定好proxy 之后，才会真的使用 proxy 嘛！那就不就是在耍宝用的防火墙吗？ 只要你的用户知道不要设定 proxy 就可以躲过你的管控，那这部 proxy 防火墙有啥屁用啊？您说是吧？
那该如何强制使用者一定要使用你的 proxy 呢？很简单！那就是： (1)在对外的防火墙服务器 (NAT) 上面安装 proxy； (2)在 proxy 上头启动 transparent 功能；(3) NAT 服务器加上一条 port 80 转 port 3128 的规则，如此一来，所有往 port 80 的封包就会被你的 NAT 转向 port 3128 ， 而你的 port 3128 就是 proxy ，那大家就得要用你的 proxy ，而且重点是，浏览器不需要进行任何设定！

### 18.网络驱动器装置：iSCSI服务器
做为服务器的系统通常是需要储存设备的，而储存设备除了可以使用系统内建的磁盘之外，如果内建的磁盘容量不够大， 而且也没有额外的磁盘插槽 (SATA 或 IDE) 可用时，那么常见解决的方案就是增加 NAS (网络附加储存服务器) 或外接式储存设备。再高档一点的系统，可能就会用到 SAN (储存局域网络) 这个高贵的玩意儿

NAS (Network Attached Storage, 网络附加储存服务器)
基本上，NAS 其实就是一部客制化好的主机了，只要将 NAS 连接上网络，那么在网络上面的其他主机就能够存取 NAS 上头的数据了。简单的说，NAS 就是一部 file server 啰
NAS 也通常支持 TCP/IP ，并会提供 NFS, SAMBA, FTP 等常见的通讯协议来提供客户端取得文件系统。
那为什么不要直接使用个人计算机安装 Linux 再搭配相关的服务，即可提供 NAS 预计要提供的大容量空间啦！干嘛需要 NAS 呢？ 因为，通常 NAS 还会包括很多组态的接口，通常是利用 Web 接口来控制磁盘阵列的设定状况、提供 IP 或其他相关网络设定， 以及是否提供某些特定的服务等等。因为具有较为亲和的操作与控制接口，对于非 IT 的人员来说，控管较为容易啦。 这也是 NAS 存在的目的。

> NAS是存储的一种方式 NAS可以是一个设备.也可以是一种存储网络的架构.而NFS是一种协议.两者有本质上的区别
>
> NAS是功能单一的精简型电脑，因此在架构上不像个人电脑那么复杂，像键盘、鼠标、荧幕、音效卡、喇叭、扩充漕、各式连接口等都不需要；在外观上就像家电产品，只需电源与简单的控制钮。NAS在架构上与个人电脑相似，但因功能单纯，可移除许多不必要的连接器、控制晶片、电子回路，如键盘、鼠标、USB、VGA等。
>
> NAS应用于高效的文件共享任务中，不同的主机与客户端通过文件共享协定存取NAS上的资料，实现文件共享功能，例如UNIX中的NFS和Windows NT中的CIFS，其中基于网络的文件级锁定提供了高级并发访问保护的功能。

SAN (Storage Area Networks, 储存局域网络)
最简单的看法，就是将 SAN 视为一个外接式的储存设备。只是单纯的外接式储存设备仅能透过某些接口 (如 SCSI 或 eSATA) 提供单一部主机使用，而 SAN 却可以透过某些特殊的接口或信道来提供局域网络内的所有机器进行磁盘存取。要注意喔，**SAN 是提供『磁盘 (block device)』给主机用，而不是像 NAS 提供的是『网络协议的文件系统 (NFS, SMB...)』！**因此，挂载使用 SAN 的主机会多出一个大磁盘，并可针对 SAN 提供的磁盘进行分割与格式化等动作。想想看，你能对 NAS 提供的文件系统格式化吗？不行吧！这样了解差异否？
 SAN 早期使用光纤信道，由于以太网络的发展，近来使用 iSCSI 协议在 TCP/IP 架构上面实作；
 有厂商将 SAN 的连接方式改为利用 IP 技术来处理。然后再透过一些标准的订定，最后就得到 Internet SCSI (iSCSI) 这玩意的产生啦！
 iSCSI 是在 TCP/IP 上面所开发出来的一套应用，所以得要有网络才行啊！

 iSCSI 这个架构主要将储存装置与使用的主机分为两个部分，分别是：
 iSCSI target：就是储存设备端，存放磁盘或 RAID 的设备，目前也能够将Linux 主机仿真成 iSCSI target 了！目的在提供其他主机使用的『磁盘』；
 iSCSI initiator：就是能够使用 target 的客户端，通常是服务器。 也就是说，想要连接到 iSCSI target 的服务器，也必须要安装 iSCSI initiator 的相关功能后才能够使用 iSCSI target 提供的磁盘就是了。

 iSCSI target 主要使用 scsi-target-utils 软件达成主要利用 tgt-admin 及tgtadm 指令完成：
 **iSCSI 就是透过一个网络接口，将既有的磁盘给分享出去就是了。** 

> **DAS （硬盘，U 盘）**： Direct Attached Storage（直连附加存储），直接到计算机主板总线，识别为一个块设备，例如硬盘，U 盘等，这种很难做到共享。
>
> **DAS和NAS** 、**SAN的区别**： 三种模式不同点在于存储连接形态，其中DAS模式最简单，就是直接把存储设备连接到服务，而这种模式最大的问题是：每个应用服务器都要有独立的存储设备，这样增加了数据处理的复杂度，随着服务器的增加，网络系统效率也急剧下降。为了解决上述问题，提出了NAS和SAN两种模式。
>
> **NAS和SAN的区别**：NAS：通过TCP/IP协议访问数据，采用业界标准文件共享协议，如果NFS、HTTP、CIFS实现共享。SAN：通过专用光纤交换机访问数据，采用SCSI、FC-AL接口。NAS和SAN最本质的区别就是文件管理系统在哪里。如图1所示，SAN结构中，文件管理系统（FS）分别在每一个应用服务器上面，而NAS则是每个应用服务器通过网络共享协议，使用同一个文件管理系统即NAS和SAN存储系统的区别就是NAS有自已的文件管理系统。




## 第四部分：常见因特网服务器架设

### 19.主机名控制者：DNS服务器

讲到因特网服务器，你第一个会想到的应该就是 WWW 还有 FTP 吧！但其实还有一个更重要的你可能会不知道他的存在， 那就是 DNS ！这才是重点中的重点

用网络主机名取得 IP 的历史渊源:
单一档案处理上网的年代： /etc/hosts  =>客户端计算机每次都得要重新下载一次档案才能顺利联网
/etc/hosts 这个档案的用法，基本上该档案内容就是『IP 主机名 主机别名一 主机别名二...』。在里面最重要的就是 localhost 对应到 127.0.0.1 这个咚咚！你千万不能删除该笔记录的。这里也再次强调，在你的私有网域内部，最好将所有的私有 IP 与主机名对应都写入这个档案中啦！

分布式、阶层式主机名管理架构： DNS 系统
DNS 是一种因特网的通讯协议名称， 至于 Bind 则是提供这个 DNS 服务的软件

在 Internet 当中，任何一部合法的主机都具有独一无二的主机名，这个主机名包含了 hostname 与 domain name ，并称为 Fully Qualified Domain Name (FQDN)；

我们晓得**主机名对应到 IP 有两种方法**，早期的方法是直接 写在档案里面来对应， 后来比较新的方法则是透过 DNS 架构！那么这两种方法分别使 用什么配置文件？可不可以同时存在？ 若同时存在时，那个方法优先？嗯！我们先来 谈一谈几个配置文件吧！

一般而言， Linux 的预设主机名与 IP 的对应搜寻都以 /etc/hosts 为优先

 在 Internet 当中，任何一部合法的主机都具有独一无二的主机名，这个主 机名包含了 hostname 与 domain name ，并称为 Fully Qualified Domain Name  (FQDN)； 

 为了克服人类对于 IP 不易记忆的困扰，而有名称解析器的产生，首先是 /etc/hosts ，而后则是 DNS 系统的产生；

**示例：公司CDB测试环境中就以前者‘：Linux 的预设主机名与 IP 的对应搜寻都以 /etc/hosts 为主要方式。比如在pe26中**

```
[s_kouha@pe26 s_kouha]$ cat /etc/hosts
# Do not remove the following line, or various programs
# that require network functionality will fail.
186.64.120.21   pe26
127.0.0.1               pe26 localhost.localdomain localhost
::1             localhost6.localdomain6 localhost6

186.32.120.1    PE01    #       PowerEage01
```

**除了本机ip之外，只有PE01的IP，而这个PE01上/etc/hosts 则集成了各个CDB环境主机的IP。**

```
# Do not remove the following line, or various programs
# that require network functionality will fail.
127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4
#::1         localhost localhost.localdomain localhost6 localhost6.localdomain6

129.71.132.129  scpfile07       file7
129.71.132.130  scpfile08       file8
129.71.132.131  scpfile09       file9
129.71.147.1    scpfile10       file10
129.71.147.2    scpfile11       file11
129.71.147.3    scpfile12       file12
129.71.147.65   scpfile13       file13

129.71.50.2     ygukfs yukfs        # FSCP#GUK FS
129.71.50.3     ygukfep yukfep      # FSCP#GUK FEP
129.71.50.4     ygukusp0 yukusp0    # FSCP#GUK USP0
129.71.50.5     ygukusp1 yukusp1    # FSCP#GUK USP1
129.71.50.6     yguksim yuksim      # FSCP#GUK SIM
129.71.50.8     ygulfs yulfs        # FSCP#GUL FS
129.71.50.9     ygulfep yulfep      # FSCP#GUL FEP
129.71.50.10    ygulusp0 yulusp0    # FSCP#GUL USP0
129.71.50.11    ygulusp1 yulusp1    # FSCP#GUL USP1
129.71.50.12    ygulsim yulsim      # FSCP#GUL SIM

...
```

**PE01上DNS服务器则没有设置**

```
[s_kouha@pe01 etc]$ cat resolv.conf
# Generated by NetworkManager


# No nameservers found; try putting DNS servers into your
# ifcfg files in /etc/sysconfig/network-scripts like so:
#
# DNS1=xxx.xxx.xxx.xxx
# DNS2=xxx.xxx.xxx.xxx
# DOMAIN=lab.foo.com bar.foo.com
```

**至于PE26如何在登陆 `telnet -8 yukfs`时通过pe01查询到相应的IP，就不太了解了...**



### 20.WWW服务器

大约在 90 年代初期由伊利诺大学的国家超级计算机应用中心 开发出服务器 HTTPd (HTTP daemon 之意)。HTTPd 为自由软件，所以很快的领导了 WWW 服务器市场。
由于 HTTPd 这个服务器一直没有妥善的发展，于是一群社群朋友便发起一个计划，这个计划主要在改善原本的 HTTPd 服务器软件，他们称这个改良过的软件为Apache，取其『一个修修改改的服务器 (A patch server)』的双关语！(这东西就是主要提供 WWW 的服务器平台，后面谈到的 PHP 必须要在这玩意儿上才能运作！)
虽然 WWW 越来越重要，但相对的来说，客户端如果没有浏览器的话那么他们当然就无法去浏览 WWW 服务器所提供的数据。

1. WWW 是依据 HTTP 这个协议而来的，分为服务器端与客户端；
2. Apache 是一个服务器端的软件，主要依据 NCSA 的 HTTPd 服务器发展而来，为自由软件；
3. Mozilla 是一个自由软件的开发计划，其中 firefox 浏览器是相当成功的作品。

URL:<协定>://<主机地址或主机名>[:port]/<目录资源>
鸟哥的网站 www 数据放置在我主机的 /var/www/html/ 当中，通常首页目录底下会有个特殊的文件名，例如 index.html 
默认的首页目录在 /var/www/html/，你应该将所有的 WWW 数据都搬到该目录底下才对！
在整个平台设计上面，目前常见的有两大系统，一个是 Linux 操作系统上面，搭配 Apache + MySQL + PHP 等而达成，这个系统被称为 LAMP。

PHP 是一个工具，他可以被用来建立动态网页，PHP 程序代码可以直接在 HTML 网页当中嵌入， 就像你在编辑 HTML 网页一样的简单。所以说， PHP 是一种『程序语言』，这种程序语言可以直接在网页当中编写， 不需要经过编译即可进行程序的执行。
我们知道在 Linux 上面要达成网页服务器需要 Apache 这套服务器软件吶！不过 Apache 仅能提供最基本的静态网站数据而已，想要达成动态网站的话，那么最好还是需要 PHP 与 MySQL 的支持才好。
那么我们的 LAMP 需要哪些东西呢？你必需要知道的是，PHP 是挂在 Apache 底下执行的一个模块， 而我们要用网页的 PHP 程控 MySQL 时，你的 PHP 就得要支持MySQL 的模块才行！所以你至少需要底下几个软件：

1. httpd (提供 Apache 主程序)
2. mysql (MySQL 客户端程序)
3. mysql-server (MySQL 服务器程序)
4. php (PHP 主程序含给 apache 使用的模块)
5. php-devel (PHP 的发展工具，这个与 PHP 外挂的加速软件有关)
6. php-mysql (提供给 PHP 程序读取 MySQL 数据库的模块)

要达成让 apache 支持 https 协议的话，你必须要有 mod_ssl 这个软件才行！

Apache 也自行提供一支 script 可以让我们来简单的使用，那就是apachectl 这支程序啦！这支程序的用法与 /etc/init.d/httpd 几乎完全一模一样喔！
如果想要知道有没有成功的驱动 PHP 模块...

虽然 PHP 网页程序标榜的是速度快速，不过因为 PHP 毕竟是先将一些可用函数先编译成为模块，然后当网页使用到该 PHP 程序的时候，再由呼叫 PHP 模块来达成程序所需要的行为。由于多了一道手续， 所以他的执行效能还是有别于传统编译的程序语言啰。
 那么如果我们可以将 PHP 程序预先转换成为可直接执行的 binary file，不就可以直接读取进而加快速度吗？ 没错！是这样～这东西称为预编器～其中有一套软件称为 eaccelerator，eaccelerator 可以将你的 PHP 程序与 PHP 核心及相关函式库预先编译后暂存下来，以提供未来使用时可以直接执行，加上他可以优化你的 PHP 程序

```
 [root@www eaccelerator-0.9.6.1]# make install
```

此时这个新编译的模块会被放置到

/usr/lib64/php/modules/eaccelerator.so 当中！


如果你想要 Apache 可以执行 perl 之类的网页程序时(helloworld.pl)， 你就得需要安装一些额外的模块才行。其中 mod_perl 与 mod_python 这两个软件建议你最好安装一下啦！

 找不到网页时的显示讯息通知:
事实上 CentOS 所提供的 Apache 已经规范好一些简单的错误资料网页了，你可以到 /var/www/error/ 目录下瞧瞧就晓得。

```
[root@www ~]# vim /etc/httpd/conf/httpd.conf
```

大约在 875 行左右，预设就是批注掉的！

```
ErrorDocument 403 /error/HTTP_FORBIDDEN.html.var

ErrorDocument 404 /error/HTTP_NOT_FOUND.html.var

ErrorDocument 405 /error/HTTP_METHOD_NOT_ALLOWED.html.var

ErrorDocument 408 /error/HTTP_REQUEST_TIME_OUT.html.var
```

### 21.文件服务器之三：FTP服务器
FTP (File transfer protocol) 是相当古老的传输协议之一，他最主要的功能是在服务器与客户端之间进行档案的传输。
利用上述的说明来整理一下 FTP 服务器端会使用到的埠号主要有：命令通道的 ftp (默认为 port 21) 与数据传输的 ftp-data (默认为 port 20)。
再强调一次，这两个埠口的工作是不一样的，而且，重要的是两者的联机发起端是不一样的！首先 port 21 主要接受来自客户端的主动联机，至于 port 20 则为 FTP 服务器主动联机至客户端呢！
拜 SSH 所赐，目前我们已经有较为安全的 FTP 了，那就是 ssh 提供的 sftp 这个 server 啊！这个 sftp-server 最大的优点就是：『在上面传输的数据是经过加密的』！

FTP 的服务器软件非常多，例如 Wu FTP, Proftpd, vsftpd 等等，各种 FTP 服务器软件的发展理念并不相同， 所以选择时请依照你的需求来决定所需的软件；

vsftpd 的全名是『Very Secure FTP Daemon 』的意思， 换句话说，vsftpd 最初发展的理念就是在建构一个以安全为重的FTP 服务器呢！
vsftpd 这个服务的启动者身份为一般用户，所以对于 Linux 系统的权限较低，对于 Linux 系统的危害就相对的减低了。此外， vsftpd 亦利用chroot() 这个函式进行改换根目录的动作，使得系统工具不会被 vsftpd 这支服务所误用；

浏览器所支持的协议，其中一个就是ftp 这个协议啰！这个协议的处理方式可以在网址列的地方这样输入的：ftp://username@your_ip


### 22.邮件服务器：Postfix

> POP3是Post Office Protocol 3的简称，即邮局协议的第3个版本,它规定怎样将个人计算机连接到Internet的邮件服务器和下载电子邮件的电子协议。它是因特网电子邮件的第一个离线协议标准,POP3允许用户从服务器上把邮件存储到本地主机（即自己的计算机）上,**同时删除保存在邮件服务器上的邮件**
> IMAP全称是Internet Mail Access Protocol，即交互式邮件存取协议，它是跟POP3类似邮件访问标准协议之一。不同的是，开启了IMAP后，在电子邮件客户端收取的邮件仍然保留在服务器上，同时在客户端上的操作都会反馈到服务器上，如：删除邮件，标记已读等，服务器上的邮件也会做相应的动作。所以无论从浏览器登录邮箱或者客户端 软件登录邮箱，看到的邮件以及状态都是一致的。IMAP提供的摘要浏览功能可以让你在阅读完所有的邮件到达时间、主题、发件人、大小等信息后才作出是否下载的决定。此外，IMAP 更好地支持了从多个不同设备中随时访问新邮件。所以现在主流使用的都是IMAP协议。
>
> SMTP 的全称是“Simple Mail Transfer Protocol”，即简单邮件传输协议。它是一组用于从源地址到目的地址传输邮件的规范，通过它来控制邮件的中转方式。SMTP 协议属于 TCP/IP 协议簇，它帮助每台计算机在发送或中转信件时找到下一个目的地。SMTP 服务器就是遵循 SMTP 协议的发送邮件服务器。

**示例：工作中，邮件服务器上当然也可以直接阅读邮件，然而如果其上有容量限制，那么采用POP3协议本地用Outlook等应用服务去服务器上收邮件就很有用，下载完本地对服务器可以设置自动删除时间（默认一般14天），此时就不用配置IMAP也行，就你一个客户端收取嘛。发送邮件的协议基本都采用SMTP。**

MUA (Mail User Agent)：除非你可以直接利用类似 telnet 之类的软件登入邮件服务器来主动发出信件，否则您就得要透过 MUA 来帮你送信到邮件服务器上头去。最常见的 MUA 像是 Linux 桌面 KDE 常见的 Kmail ，及Windows 内件的 Outlook Express 等。 MUA 主要的功能就是收受邮件主机的电子邮件，以及提供用户浏览与编写邮件的功能！
MTA (Mail Transfer Agent)：MUA 帮用户传送邮件到邮件主机上，那这部邮件主机如果能够帮用户将这封信寄出去，那他就是一部邮件传送主机 (MTA) 啦！这个 MTA 就是『邮件传送代理人』的意思。MTA 主机最主要的功能就是：将来自客户端或者是其他 MTA 的来信收下来，这个时候 MTA 使用的是 Simple Mail Transfer Protocol (SMTP)，他使用的是 port 25 啦！
MDA (Mail Delivery Agent)：字面上的意思是『邮件递送代理人』的意思。事实上，这个 MDA 是挂在 MTA 底下的一个小程序， 最主要的功能就是：分析由 MTA 所收到的信件表头或内容等数据， 来决定这封邮件的去向。所以说，上面提到的 MTA 的信件转递功能，其实是由 MDA 达成的。 举例来说，如果 MTA 所收到的这封信目标是自己，那么MDA 会将这封信给他转到使用者的信箱 (Mailbox) 去，如果不是呢？那就准备要转递出去了。
Mailbox：就是电子邮件信箱嘛！简单的说，就是某个账号专用的信件收受档案啰。我们的Linux 系统默认的信箱都是放在 /var/spool/mail/使用者账号 中！若 MTA 所收到的信件是本机的使用者，MDA 就会将信件送到该 mailbox 当中去啰！


我们本地端的 MUA 想要使用 MTA 来传出信件时， 当然需要取得 MTA 的权限。通常就是说：我们必须要向 MTA 注册一组可使用 email 的账号与密码才行。
你是可以寄信给你自己的，所以如果你的 MTA 收到该封信件的目标是自己的用户时，那就会透过 MDA 将这封信送到 Mailbox 去啰！
我们的 MTA 就会开始分析该封信是否具有合法的权限， 若具有权限时，则我们的 MDA 会开始进行邮件转递，亦即该封信件会透过我们的 MTA 向下一部 MTA 的 smtp (port 25) 发送出去。如果该封信件顺利的发送出去了，那么该封信件就会由队列当中移除掉了。
如果一切都没有问题的话，远程的 MTA 会收到我们 MTA 所发出的那封信，并将该信件放置到正确的使用者信箱当中， 等待使用者登入来读取或下载。
在这整个过程当中，你会发现你的信件是由我们的 MTA 帮忙发送出去的，此时 MTA 提供的协议是简单邮件传输协议 (Simple Mail Transfer Protocol, smtp)， 并且该封信最终是停留在对方主机的 MTA 上头！并不是你朋友的 MUA 上头啊！

MRA (Mail Retrieval Agent)：使用者可以透过 MRA 服务器提供的邮政服务协议 (Post Office Protocol, POP) 来收下自己的信件，也可以透过 IMAP (Internet Message Access Protocol) 协议将自己的信件保留在邮件主机上面， 并进一步建立邮件数据匣等进阶工作。

我们先谈一谈 POP3 的收信方式吧：MUA 透过 POP3 (Post Office Protocol version 3) 的协议连接到 MRA 的port 110， 并且输入账号与密码来取得正确的认证与授权；MRA 确认该用户账号/密码没有问题后，会前往该使用者的 Mailbox (/var/spool/mail/使用者账号) 取得使用者的信件并传送给用户的 MUA 软件上；当所有的信件传送完毕后，用户的 mailbox 内的数据将会被删除！

OK！透过上面的说明你要知道，要架设一部可以使用 MUA 进行收发信件的 MTA, MRA 服务器，你至少也需要启动 SMTP 以及 POP3 这两个协议才行！而这两个协议的启动程序并不相同， 所以架设上还是得要小心注意啊！

启动单纯的 pop3/imap 是很简单的啦，你得要先确定已经安装了 dovecot 这个软件。而这个软件的配置文件只有一个，就是/etc/dovecot/dovecot.conf。

设定 Mail server 不是拿来好看的，当然是要好好的应用他啰！应用 mail server 有两种主要的方式，你可以直接登入 Linux 主机来操作 MTA ，当然也可以透过客户端的 MUA 软件来收发信件

在 Unix like 的操作系统当中都会存有一支可以进行收发信件的软件，那就是『 mail 』这个指令。这个指令是由 mailx 这个软件所提供的，所以您得要先安装这个软件才行。另外，由于 mail 是 Linux 系统的功能，所以即使你的 port 25 (smtp) 没有启动，他还是可以使用的，只是该封邮件就只会被放到队列，而无法寄出去啰！^_^！

老实说，由于 gmail 等免费邮件的盛行，目前连 Openwebmail 自由软件都很少人安装了！鸟哥上课时看到的同学， 几乎全部使用gmail, yahoo mail, hotmail 等的 web 接口的 MUA，根本没人在用本机端的 MUA 了～但是， 某些时刻某些过时的信件还是得要从web mail 上面捉下来，这时，Thunderbird 就派上用场啰！ ^_^ 

邮件服务器主要是指 SMTP (简单邮件传送协议) 而已，不过要架设一部可利用类似 Thunderbird 收发的邮件服务器，最好能够具有 SMTP 以及 POP3 等通讯协议；
常见的可以启动 SMTP 的软件有 sendmail, postfix 及 qmail 等等。







