# è‡ªåŠ¨åŒ–è¿ç»´å­¦ä¹ 

# Ansible

## åŽ†å²ä¸Žå®‰è£…

åŽ†å²ï¼š

> Ansible æ˜¯ç”± Michael DeHaan äºŽ 2012 å¹´å¼€å‘çš„ã€‚æœ€åˆï¼ŒAnsible æ˜¯ä½œä¸ºä¸€ä¸ªä¸ªäººé¡¹ç›®å¯åŠ¨çš„ï¼Œæ—¨åœ¨ç®€åŒ– IT è‡ªåŠ¨åŒ–å’Œé…ç½®ç®¡ç†ã€‚2013 å¹´ï¼ŒAnsible è¢«å¼€æºï¼Œå¹¶è¿…é€Ÿå—åˆ°ç¤¾åŒºçš„æ¬¢è¿Žã€‚
>
> åœ¨éšåŽçš„å‡ å¹´é‡Œï¼ŒAnsible é€æ¸å‘å±•ï¼Œå¢žåŠ äº†è®¸å¤šåŠŸèƒ½ï¼Œæ”¯æŒå„ç§å¹³å°å’ŒæœåŠ¡ã€‚2015 å¹´ï¼ŒAnsible è¢« Red Hat æ”¶è´­ï¼Œå¹¶ç»§ç»­åœ¨å…¶åŸºç¡€ä¸Šå‘å±•ï¼Œæˆä¸ºçŽ°ä»£ IT åŸºç¡€è®¾æ–½ç®¡ç†çš„é‡è¦å·¥å…·ä¹‹ä¸€ã€‚

å¦‚ä½•å®‰è£…:

Ubuntu

```
sudo apt update
sudo apt install ansible
ansible --version
```

CentOS/RHEL

```
sudo yum install epel-release
sudo yum install ansible
ansible --version
```

> Ansible é‡‡ç”¨çš„æ˜¯ä¸€ç§â€œæ— ä»£ç†â€ï¼ˆagentlessï¼‰çš„æž¶æž„ï¼Œè¿™æ„å‘³ç€ä½ ä¸éœ€è¦åœ¨ç›®æ ‡æœåŠ¡å™¨ä¸Šå®‰è£… Ansibleã€‚Ansible é€šè¿‡ SSHï¼ˆå¯¹äºŽ Linux/Unix ç³»ç»Ÿï¼‰æˆ– WinRMï¼ˆå¯¹äºŽ Windows ç³»ç»Ÿï¼‰ä¸Žç›®æ ‡æœºå™¨é€šä¿¡ï¼Œç›´æŽ¥åœ¨æŽ§åˆ¶èŠ‚ç‚¹ï¼ˆAnsible æ‰€åœ¨çš„æœåŠ¡å™¨ï¼‰ä¸Šæ‰§è¡Œå‘½ä»¤å’Œå‰§æœ¬ã€‚

## Ansibleè¿ç»´è‡ªåŠ¨åŒ–

[Link](https://www.bilibili.com/video/BV1DY4y137Be?p=2&spm_id_from=pageDriver&vd_source=6fc477a8e79179a3fd30bed2e2ba5fbe)

ansibleæ˜¯æ–°å‡ºçŽ°çš„è‡ªåŠ¨åŒ–è¿ç»´å·¥å…·ï¼ŒåŸºäºŽPythonå¼€å‘ï¼Œé›†åˆäº†ä¼—å¤šè¿ç»´å·¥å…·ï¼ˆpuppetã€cfengineã€chefã€funcã€fabricï¼‰çš„ä¼˜ç‚¹ï¼Œå®žçŽ°äº†**æ‰¹é‡**ç³»ç»Ÿé…ç½®ã€**æ‰¹é‡**ç¨‹åºéƒ¨ç½²ã€**æ‰¹é‡**è¿è¡Œå‘½ä»¤ç­‰åŠŸèƒ½ã€‚

### Ansible Inventory 20240903

åœ¨hostsæ–‡ä»¶é‡Œå†™å„ç§ä¸»æœºçš„IPï¼Œå¯ä»¥åˆ†ç»„ï¼Œæœ‰ä¸“é—¨çš„æ ¼å¼è¦æ±‚

```
[web]
172.16.1.5 
172.16.1.6
[db]
172.16.1.7
[nfs]
172.16.1.11
```

ç”šè‡³å¯ä»¥å°†ç”¨æˆ·åå’Œå¯†ç å†™è¿›ä¸»æœºæ¸…å•é‡Œï¼Œä½†æ˜¯ä¸æŽ¨è

```shell
#åœ¨hostsæ–‡ä»¶é‡Œå†™å„ç§ä¸»æœºçš„IPï¼Œå¯ä»¥åˆ†ç»„
#-i inventory list æŒ‡å®šä¸»æœºæ¸…å•
#-m æŒ‡å®šæ¨¡å—
#-a æŒ‡å®šåŠ¨ä½œ
ansible -i hosts all -m ping

#ä»Žansibleæ‰€åœ¨ä¸»æœºè¿œç¨‹æ“ä½œ
ssh 172.16.1.6 'lis -l .ssh'
```

### Ansibleæ¨¡å— 20240904

| å‘½ä»¤/è„šæœ¬æ¨¡å— |                                                              |
| ------------- | ------------------------------------------------------------ |
| pingæ¨¡å—      | æ£€æŸ¥ansibleä¸Žä¸»æœºè¿žé€šæ€§                                      |
| shellæ¨¡å—     | æ‰¹é‡æ‰§è¡Œshellå‘½ä»¤                                            |
| commandæ¨¡å—   | ä¸æŒ‡å®šæ¨¡å—,é»˜è®¤å°±ä½¿ç”¨è¯¥æ¨¡å—ï¼Œæ‰¹é‡æ‰§è¡Œç®€å•å‘½ä»¤                |
| scriptsæ¨¡å—   | åˆ†å‘è„šæœ¬å¹¶æ‰§è¡Œï¼Œåœ¨ansibleä¸Šå†™ä¸ªè„šæœ¬åˆ†å‘åˆ°å„ä¸ªä¸»æœºæ‰§è¡Œï¼Œæ¯”å¦‚å®‰è£…Python |

è°ƒç”¨å…·ä½“æ¨¡å—è¦ä»€ä¹ˆå‚æ•°ï¼ŒæŸ¥é˜…ansibleå®˜æ–¹ç½‘ç«™

#### 

| æ–‡ä»¶ç›¸å…³æ¨¡å—       |                                |                                                              |
| ------------------ | ------------------------------ | ------------------------------------------------------------ |
| fileæ¨¡å—           | æ–‡ä»¶ç›®å½•åˆ›å»ºï¼Œåˆ é™¤...          |                                                              |
| copyæ¨¡å—           | è¿œç¨‹å¤åˆ¶ï¼Œåˆ†å‘æ–‡ä»¶             | ansible -i hosts all -m copy -a 'src=/etc/hostname dest=/tmp/' |
| **æœåŠ¡ç®¡ç†æ¨¡å—**   |                                |                                                              |
| systemdæ¨¡å—        | æœåŠ¡çš„å¼€æœºè‡ªå¯åŠ¨ï¼ŒæœåŠ¡å¼€å¯å…³é—­ |                                                              |
| serviceæ¨¡å—        |                                |                                                              |
| **è½¯ä»¶åŒ…ç®¡ç†**     |                                |                                                              |
| yum_repositoryæ¨¡å— | ç»™è¿œç«¯é…ç½®ä¸€ä¸ªyumæºæ–‡ä»¶        | ansible -i hosts lb -m yum_repository -a '...'               |
| yumæ¨¡å—            | å®‰è£…æ–‡ä»¶                       | ansible -i hosts lb -m yum -a 'name=nginx state=latest'      |
| get_urlæ¨¡å—        |                                |                                                              |
| **ç³»ç»Ÿç®¡ç†**       |                                |                                                              |
| mouteæ¨¡å—          | mouteè¿œç¨‹æŒ‚åœ¨nfs               | ansible -i hosts web -m mount -a 'fstype=nfs ...'            |
| cronæ¨¡å—           | å®šæ—¶ä»»åŠ¡æ¨¡å—                   |                                                              |
| **ç”¨æˆ·ç®¡ç†**       |                                |                                                              |
| groupç®¡ç†          |                                |                                                              |
| useræ¨¡å—           |                                |                                                              |
|                    |                                |                                                              |
|                    |                                |                                                              |
|                    |                                |                                                              |
|                    |                                |                                                              |



ansibleçŽ°åœ¨æœ‰ä¸Šåƒçš„æ¨¡å—...

è·³æ¿æœº/å ¡åž’æœº: Jump Server, é€šè¿‡è·³æ¿æœºç®¡ç†å…¶ä»–æ‰€æœ‰æœºå™¨

ç½‘ç«™æž¶æž„-è¿ç»´è§’åº¦ï¼šDevelopers => VPNé€šé“ => è·³æ¿æœº => æ‰¹é‡ç®¡ç†ï¼šAnsible => ç›‘æŽ§ï¼Œæ—¥å¿—æ”¶é›†



ansibleè¿”å›žçš„ç»“æžœé€šå¸¸æ˜¯jsonç»“æž„

### Ansibleå‰§æœ¬(Playbook) 20240918

å¯¹äºŽé‡å¤æ€§æ“ä½œä¸Žéƒ¨ç½²æŽ¨èä½¿ç”¨å‰§æœ¬ï¼ˆè„šæœ¬ï¼‰ï¼Œä½¿ç”¨æ¨¡å—+å›ºå®šæ ¼å¼ï¼ˆå¯¹é½ï¼‰

å‰§æœ¬æ ¼å¼ï¼šyamlæ ¼å¼ï¼Œymlå°¾ç¼€çš„æ–‡ä»¶

Playbookç»„æˆ

Ansible Playbook ç¤ºä¾‹ï¼š

```yaml
---
- name: å®‰è£…å’Œé…ç½® Nginx
  hosts: webservers
  become: yes  # ä»¥è¶…çº§ç”¨æˆ·èº«ä»½è¿è¡Œä»»åŠ¡
  vars: #å®šä¹‰åœ¨ playbook ä¸­ä½¿ç”¨çš„å˜é‡
    nginx_port: 80
    nginx_server_name: "example.com"
  tasks:
    - name: ç¡®ä¿ Nginx å·²å®‰è£…
      apt:
        name: nginx
        state: present
      notify:
        - é‡å¯ Nginx

    - name: é…ç½® Nginx
      template:
        src: nginx.conf.j2
        dest: /etc/nginx/nginx.conf
      notify:
        - é‡å¯ Nginx

    - name: ç¡®ä¿ Nginx æœåŠ¡æ­£åœ¨è¿è¡Œ
      service:
        name: nginx
        state: started
        enabled: yes

  handlers:
    - name: é‡å¯ Nginx
      service:
        name: nginx
        state: restarted

```

ä½ å¯ä»¥ä½¿ç”¨ `ansible-playbook` å‘½ä»¤æ¥è¿è¡Œè¿™ä¸ª playbookï¼Œä¾‹å¦‚ï¼š`ansible-playbook -i inventory playbook.yml`



æ³¨æ„ç©ºæ ¼ç¼©è¿›ï¼Œè¿˜ä¸èƒ½ç”¨tabé”®ï¼Œæœ‰äº›çç¢Žçš„æ ¼å¼è¦æ±‚

Playbookä¸­å¯ä»¥å®šä¹‰å˜é‡å’Œä½¿ç”¨å˜é‡ï¼Œé™¤äº†è‡ªå®šä¹‰ï¼Œè¿˜æœ‰å†…åµŒå˜é‡factsï¼ŒèŽ·å–ä¸»æœºå,ipï¼Œcpuä¿¡æ¯

å¯ä»¥å°†Playbookä¸­è¿™äº›å˜é‡æŠ½å‡ºåˆ°ä¸€ä¸ªç‹¬ç«‹æ–‡ä»¶vars_filesä¸­ç»´æŠ¤

> Ansible ä¸­çš„ `register` ç”¨äºŽæ•èŽ·ä»»åŠ¡çš„è¾“å‡ºå¹¶å°†å…¶å­˜å‚¨åœ¨å˜é‡ä¸­ï¼Œä¾›åŽç»­ä»»åŠ¡ä½¿ç”¨ã€‚

æ€»ç»“ï¼šansibleä¸­å˜é‡å®šä¹‰å°±æ˜¯è¿™ä¸‰ç§ï¼šè‡ªå®šä¹‰ï¼Œfactsï¼Œregister



å‰§æœ¬æµç¨‹æŽ§åˆ¶ï¼š

1. handlerè§¦å‘å™¨ => å…³é”®è¯ notify ä¸Ž handlers é…åˆï¼Œç±»ä¼¼äºŽCè¯­è¨€ä¸­çš„â€œgotoâ€
2. whenåˆ¤æ–­ => whenä¸€èˆ¬ä¸Žansible factså˜é‡ä¸€èµ·ä½¿ç”¨ï¼Œåˆ¤æ–­ä¸»æœº/åˆ¤æ–­ç³»ç»Ÿç³»ç±»
3. loopå¾ªçŽ¯=> å…³é”®è¯ with items, æ‰¹é‡å¯åŠ¨æœåŠ¡ï¼Œæ‰¹é‡æ·»åŠ ç”¨æˆ·ï¼Œæ„Ÿè§‰è¿™é‡Œæ‰€è°“çš„å¾ªçŽ¯æ›´åƒ æ‰¹é‡æ“ä½œï¼Œäº‹å…ˆåˆ—å‡ºæ‰€æœ‰é¡¹ç›®ï¼Œæ‰€ä»¥æ— æ‰€è°“æŸä¸€æ¡ä»¶çš„break

```yaml
---
- name: Install and configure Nginx on Ubuntu
  hosts: webservers
  become: true  # ä»¥è¶…çº§ç”¨æˆ·æƒé™æ‰§è¡Œ

  vars:
    nginx_conf_file: /etc/nginx/nginx.conf
    server_blocks:
      - server_name: example.com
        root: /var/www/example
      - server_name: example.org
        root: /var/www/example_org
    is_ubuntu: "{{ ansible_distribution == 'Ubuntu' }}"  # å£°æ˜Ž Ubuntu æ¡ä»¶

  tasks:
    - name: Install Nginx
      apt:
        name: nginx
        state: present
      notify: Restart Nginx  # è§¦å‘ handler
      when: is_ubuntu  # ä»…åœ¨ Ubuntu ä¸Šæ‰§è¡Œ

    - name: Ensure the Nginx configuration file exists
      file:
        path: "{{ nginx_conf_file }}"
        state: touch
      when: is_ubuntu  # ä»…åœ¨ Ubuntu ä¸Šæ‰§è¡Œ

    - name: Configure Nginx server blocks
      template:
        src: nginx.conf.j2  # æ¨¡æ¿æ–‡ä»¶
        dest: "{{ nginx_conf_file }}"
      notify: Restart Nginx  # è§¦å‘ handler
      when: is_ubuntu  # ä»…åœ¨ Ubuntu ä¸Šæ‰§è¡Œ

    - name: Create document root directories
      file:
        path: "{{ item.root }}"
        state: directory
        owner: www-data
        group: www-data
        mode: '0755'
      with_items: "{{ server_blocks }}"
      when: is_ubuntu  # ä»…åœ¨ Ubuntu ä¸Šæ‰§è¡Œ

  handlers:
    - name: Restart Nginx
      service:
        name: nginx
        state: restarted
```

ç®€å•çš„ Nginx é…ç½®æ¨¡æ¿nginx.conf.j2ï¼š

```
http {
    {% for block in server_blocks %}
    server {
        listen 80;
        server_name {{ block.server_name }};

        root {{ block.root }};
        index index.html;

        location / {
            try_files $uri $uri/ =404;
        }
    }
    {% endfor %}
}

```

> **Handler**ï¼š
>
> - åœ¨ Playbook çš„æœ€åŽéƒ¨åˆ†å®šä¹‰ã€‚åä¸º `Restart Nginx` çš„ handler ä¼šåœ¨å…¶ä»–ä»»åŠ¡é€šè¿‡ `notify` æŒ‡ä»¤è§¦å‘æ—¶è¢«æ‰§è¡Œã€‚è¿™é‡Œï¼Œå®ƒä¼šé‡æ–°å¯åŠ¨ Nginx æœåŠ¡
>
> **`with_items` å¾ªçŽ¯**ï¼š
>
> - `with_items` ç”¨äºŽå¾ªçŽ¯åˆ›å»ºå¤šä¸ªæ–‡æ¡£æ ¹ç›®å½•ã€‚è¿™é‡Œé€šè¿‡ `server_blocks` å˜é‡ä¸­çš„æ¯ä¸ªé¡¹ç›®ï¼Œåˆ›å»ºå¯¹åº”çš„ç›®å½•



å¯¹äºŽæ¯”è¾ƒå¤æ‚çš„å‰§æœ¬ï¼Œå¯ä»¥è¿›è¡Œæ‹†åˆ†ï¼Œåˆ†æˆè®°å½•ä¸»è¦æ­¥éª¤çš„ä¸»å‰§æœ¬ ä»¥åŠ ä¸€äº›ymlå°å‰§æœ¬ï¼Œå³æ‰€è°“çš„ includeæœºåˆ¶

è¿˜å¯ä»¥ç”¨rolesè§„åˆ™å¯¹è¿™ä¸€äº›ymlå°å‰§æœ¬åˆ†é—¨åˆ«ç±»æ”¾åœ¨ä¸åŒçš„è·¯å¾„ä¸­ï¼Œä½¿æ–‡ä»¶å±‚æ¬¡æ›´ä¸ºæ¸…æ™°



### Ansibleé¡¹ç›®  20241028

éƒ¨ç½²æž¶æž„çš„æ—¶å€™ï¼Œæ‹†åˆ†ä¸åŒçš„ç»„ä»¶/æ¨¡å—ï¼Œé€šè¿‡Ansible roleséƒ¨ç½²æ¯ä¸ªæ¨¡å—

1. åŸºç¡€çŽ¯å¢ƒï¼šyumæºï¼Œç”¨æˆ·ï¼Œå…³é—­é˜²ç«å¢™ï¼Œå†…æ ¸å‚æ•°... ï¼ˆæ¨¡æ¿æœºåšäº†ï¼‰
2. åº”ç”¨/æœåŠ¡çŽ¯å¢ƒï¼šæœåŠ¡ nginx php å®‰è£…é…ç½®å¯åŠ¨ï¼Œ é€šç”¨ç‹¬ç«‹å…¨é¢ï¼Œæ ¹æ®ä¸åŒçš„æœåŠ¡åº”ç”¨æ‹†åˆ† LNMP
3. ä¸šåŠ¡çŽ¯å¢ƒä»£ç ï¼šæ¯”å¦‚éƒ¨ç½²Javaçš„ä»£ç 

=>å¯ä»¥å¯¹å¼€å‘å®Œæˆçš„é¡¹ç›®ä¸€é”®éƒ¨ç½²ï¼Œè™½ç„¶æ²¡ä½¿ç”¨è¿‡ï¼Œä½†æ˜¯NTCçŽ°åœºå®Œå…¨å¯ä»¥ç”¨Ansbileæ¥å‡çº§çš„



1é€šè¿‡æœåŠ¡å™¨éƒ¨ç½²åŠé…ç½®æµç¨‹-->è½¬æ¢ä¸ºå¯¹åº”çš„æ­¥éª¤

2æ ¹æ®æ­¥éª¤è½¬åŒ–æˆæ¨¡å—

3ä¹¦å†™å‰§æœ¬ï¼Œè°ƒè¯•å‰§æœ¬

1. å®‰è£…ï¼šä½¿ç”¨ä»€ä¹ˆæ¨¡å—
2. é…ç½®ï¼šä½¿ç”¨ä»€ä¹ˆæ¨¡å—
3. å¯åŠ¨ä¸Žä½¿ç”¨ï¼šä½¿ç”¨ä»€ä¹ˆæ¨¡å—
4. æœ€åŽä¹¦å†™å‰§æœ¬roles



# Terraform 

### Terraform Crash Course 20250208

[link]([The Terraform Crash Course](https://www.youtube.com/watch?v=4ukf6-S8wL4))

> Terraform æ˜¯ä¸€ä¸ª **åŸºç¡€è®¾æ–½å³ä»£ç ï¼ˆInfrastructure as Code, IaCï¼‰** å·¥å…·ï¼Œç”± **HashiCorp** å¼€å‘ã€‚å®ƒç”¨äºŽ**è‡ªåŠ¨åŒ–ç®¡ç†äº‘åŸºç¡€è®¾æ–½**ï¼Œå¯ä»¥è®©ä½ ä½¿ç”¨ä»£ç æ¥å®šä¹‰ã€éƒ¨ç½²å’Œç®¡ç†åŸºç¡€è®¾æ–½èµ„æºï¼ˆå¦‚æœåŠ¡å™¨ã€æ•°æ®åº“ã€ç½‘ç»œç­‰ï¼‰ã€‚
>
> ### **Terraform çš„æ ¸å¿ƒç‰¹ç‚¹**
>
> 1. **å£°æ˜Žå¼ï¼ˆDeclarativeï¼‰**
>    - ä½ åªéœ€æè¿°æœ€ç»ˆçš„åŸºç¡€è®¾æ–½çŠ¶æ€ï¼ŒTerraform ä¼šè‡ªåŠ¨è®¡ç®—å¹¶æ‰§è¡Œå¿…è¦çš„æ›´æ”¹ã€‚
> 2. **è·¨äº‘å¹³å°**
>    - æ”¯æŒ AWSã€Azureã€Google Cloudã€Kubernetesã€VMwareã€é˜¿é‡Œäº‘ç­‰å¤šç§äº‘å¹³å°ï¼Œç”šè‡³å¯ä»¥ç”¨äºŽæœ¬åœ°æ•°æ®ä¸­å¿ƒã€‚
> 3. **çŠ¶æ€ç®¡ç†ï¼ˆState Managementï¼‰**
>    - Terraform ç»´æŠ¤ä¸€ä¸ª **çŠ¶æ€æ–‡ä»¶ï¼ˆtfstateï¼‰** æ¥è·Ÿè¸ªå½“å‰çš„åŸºç¡€è®¾æ–½çŠ¶æ€ï¼Œå¹¶ç¡®ä¿æ‰€æœ‰æ›´æ”¹éƒ½å¯é¢„æµ‹å’Œå¯è¿½è¸ªã€‚
> 4. **æ¨¡å—åŒ–ï¼ˆModularï¼‰**
>    - å¯ä»¥ä½¿ç”¨ **æ¨¡å—ï¼ˆModulesï¼‰** å¤ç”¨ä»£ç ï¼Œæé«˜ç®¡ç†æ•ˆçŽ‡ã€‚
> 5. **å¯å®¡è®¡ & å¯ç‰ˆæœ¬åŒ–**
>    - åŸºç¡€è®¾æ–½ä»£ç å¯ä»¥å­˜å…¥ Git è¿›è¡Œç‰ˆæœ¬ç®¡ç†ï¼Œæ–¹ä¾¿å®¡è®¡å’Œåä½œã€‚
>
> 
>
> ### **Terraform å·¥ä½œæµç¨‹**
>
> 1. **ç¼–å†™é…ç½®æ–‡ä»¶**ï¼ˆ.tf æ–‡ä»¶ï¼‰
>    - ä½¿ç”¨ HCLï¼ˆHashiCorp Configuration Languageï¼‰ æˆ– JSON æè¿°åŸºç¡€è®¾æ–½ã€‚
> 2. **åˆå§‹åŒ–ï¼ˆterraform initï¼‰**
>    - ä¸‹è½½ç›¸å…³æ’ä»¶å’Œä¾èµ–é¡¹ã€‚
> 3. **æ‰§è¡Œè®¡åˆ’ï¼ˆterraform planï¼‰**
>    - é¢„è§ˆ Terraform è®¡åˆ’åšå‡ºçš„æ›´æ”¹ï¼Œä¸ä¼šçœŸæ­£ä¿®æ”¹åŸºç¡€è®¾æ–½ã€‚
> 4. **åº”ç”¨å˜æ›´ï¼ˆterraform applyï¼‰**
>    - æ‰§è¡Œå˜æ›´ï¼Œåˆ›å»ºæˆ–æ›´æ–°åŸºç¡€è®¾æ–½ã€‚
> 5. **é”€æ¯èµ„æºï¼ˆterraform destroyï¼‰**
>    - åˆ é™¤æ‰€æœ‰é…ç½®çš„èµ„æºï¼Œé‡Šæ”¾äº‘å¹³å°ä¸Šçš„åŸºç¡€è®¾æ–½ã€‚
>
> 
>
> ### Terraform ç¤ºä¾‹
>
> ä¸‹é¢æ˜¯ä¸€ä¸ªåˆ›å»º AWS EC2 å®žä¾‹çš„ Terraform é…ç½®æ–‡ä»¶ï¼ˆ`main.tf`ï¼‰ï¼š
>
> ```
> provider "aws" {
>   region = "us-east-1"
> }
> 
> resource "aws_instance" "example" {
>   ami           = "ami-12345678"
>   instance_type = "t2.micro"
>   
>   tags = {
>     Name = "TerraformInstance"
>   }
> }
> ```
>
> æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š
>
> ```shell
> terraform init      # åˆå§‹åŒ– Terraform
> terraform plan      # é¢„è§ˆå˜æ›´
> terraform apply     # åº”ç”¨å˜æ›´ï¼Œåˆ›å»ºå®žä¾‹
> terraform destroy   # åˆ é™¤å®žä¾‹
> ```
>
> 
>
> ### **Terraform vs. å…¶ä»– IaC å·¥å…·**
>
> | å·¥å…·               | è¯­è¨€                 | ä¸»è¦ç‰¹ç‚¹           | é€‚ç”¨åœºæ™¯               |
> | ------------------ | -------------------- | ------------------ | ---------------------- |
> | **Terraform**      | HCLï¼ˆå£°æ˜Žå¼ï¼‰        | å¤šäº‘æ”¯æŒï¼ŒçŠ¶æ€ç®¡ç† | é€‚ç”¨äºŽå¤§è§„æ¨¡äº‘åŸºç¡€è®¾æ–½ |
> | **Ansible**        | YAMLï¼ˆå‘½ä»¤å¼ï¼‰       | åå‘é…ç½®ç®¡ç†       | é…ç½®æœåŠ¡å™¨å’Œåº”ç”¨éƒ¨ç½²   |
> | **CloudFormation** | JSON/YAML            | ä»…æ”¯æŒ AWS         | é€‚ç”¨äºŽ AWS ç”Ÿæ€        |
> | **Pulumi**         | Python/Go/TypeScript | ç¼–ç¨‹å¼ IaC         | é€‚åˆ DevOps å’Œå¼€å‘è€…   |
>
> 
>
> ### **Terraform é€‚ç”¨äºŽå“ªäº›åœºæ™¯ï¼Ÿ**
>
> - **å¤šäº‘ç®¡ç†**ï¼ˆAWS + Azure + GCPï¼‰
> - **è‡ªåŠ¨åŒ–åŸºç¡€è®¾æ–½éƒ¨ç½²**ï¼ˆåˆ›å»ºæœåŠ¡å™¨ã€æ•°æ®åº“ã€ç½‘ç»œç­‰ï¼‰
> - **DevOps CI/CD**ï¼ˆç»“åˆ GitOpsï¼Œè‡ªåŠ¨éƒ¨ç½²çŽ¯å¢ƒï¼‰
> - **Kubernetes èµ„æºç®¡ç†**
> - **ç¾éš¾æ¢å¤ï¼ˆDRï¼‰**ï¼ˆä¸€é”®æ¢å¤åŸºç¡€è®¾æ–½ï¼‰



ç”¨vsç¼–è¾‘å°¾ç¼€ä¸ºtfçš„æ–‡ä»¶ï¼ŒåŠ å…¥ç›¸åº”æ’ä»¶

å¦‚ä½•å®‰è£… Terraformï¼Œè¿™ä¸ªåƒä¸€ä¸ªç¼–è¯‘å™¨ï¼Ÿterraform planç›´æŽ¥ç¼–è¯‘tfæ–‡ä»¶ï¼Œç”šè‡³terraform applyè¿è¡Œå®ƒï¼Œç„¶åŽå¯ä»¥å¾—åˆ°ä¸€ä¸ªtfstateçš„æè¿°è®¾æ–½çŠ¶æ€çš„æ–‡ä»¶

è¿˜æœ‰å…¶ä»–å‘½ä»¤ terraform destroy

æŽ¥ä¸‹æ¥Manage Resource on AWS:

åˆ›å»ºä¸€ä¸ª IAM å¾—åˆ°keyå’Œå¯†ç å¯ä»¥è®¿é—®ç»ˆç«¯ï¼Œåœ¨vsä¸Šç”¨exportå‘½ä»¤æ³¨å†Œå®ƒï¼Ÿ

å¦‚æžœè¦åˆ›å»ºä¸€ä¸ªEC2ï¼Œä½ å¯ä»¥è®¿é—®[link](https://registry.terraform.io/providers/hashicorp/aws/latest/docs)ï¼ŒæŸ¥çœ‹è¯¥å¦‚ä½•å®šä¹‰å®ƒåœ¨tfæ–‡ä»¶ä¸­ï¼Œå®šä¹‰resourceï¼Œdataç­‰ï¼Œæ‰€ä»¥è¿™æ–¹é¢ä½ éƒ½ä¸ç”¨è®°å¿†ä»€ä¹ˆä¸œè¥¿ï¼Œæœ€åŽé€šç”¨è¿è¡Œå®ƒ



### Complete Terraform Course

[Link](https://www.youtube.com/watch?v=7xngnjfIlK4&t=8883s)

#### ç®€ä»‹ 20250218

1. Evolution of Cloud + Infrastructure as Code
2. Terraform Overview + Setup
3. Basic Terraform Usage  =>å±•ç¤ºäº†ä¸€ä¸ªmain.tfæ–‡ä»¶ç”¨äºŽåˆ›å»ºRouter53 LoaderBalacnerç­‰ä¸€ä¸ªåŽåŽç«¯æž¶æž„çš„åˆ›å»º
4. Variables and Outputs
5. Language Features =>HCLè¯­è¨€
6. Projest Organization + Modules
7. Mnaging Multiple Environments
8. Testing Terraform Code
9. Developer workflows

Declarative vs. Imperative

Provisioning + Config Management => Terraform+Ansible

Provisioning + Orchestration=> Terraform+Kubernetes

> Terraform é€šè¿‡ **Provider**ï¼ˆæä¾›è€…ï¼‰ä¸Žäº‘å¹³å°è¿›è¡Œäº¤äº’ï¼Œæ¯ä¸ª Provider éƒ½å°è£…äº†äº‘å¹³å°çš„ APIï¼ŒTerraform é€šè¿‡å£°æ˜Žå¼é…ç½®ç®¡ç†èµ„æºã€‚

å®‰è£…Terraformå°±æ˜¯åœ¨vscodeä¸€è¡Œå‘½ä»¤çš„äº‹ï¼Œæ‹¿åˆ°AWSçš„IAMï¼Œç„¶åŽé€šè¿‡tfè„šæœ¬å°±å¯ä»¥æ“æŽ§AWSäº†

#### Terraform State File

> Terraform **State File**ï¼ˆçŠ¶æ€æ–‡ä»¶ï¼‰æ˜¯ Terraform ç”¨æ¥è·Ÿè¸ªå’Œç®¡ç†åŸºç¡€è®¾æ–½èµ„æºçš„æ–‡ä»¶ã€‚å®ƒå­˜å‚¨äº† Terraform ç®¡ç†çš„æ‰€æœ‰èµ„æºçš„å½“å‰çŠ¶æ€ï¼Œå¹¶åœ¨ `terraform apply` è¿è¡Œæ—¶ç”¨äºŽæ¯”è¾ƒå’Œå†³å®šå“ªäº›æ›´æ”¹éœ€è¦æ‰§è¡Œã€‚
>
> State æ–‡ä»¶æ˜¯ä¸€ä¸ª **JSON æ ¼å¼** çš„æ–‡ä»¶ï¼ŒåŒ…å« Terraform è¿½è¸ªçš„æ‰€æœ‰èµ„æºã€‚ä¾‹å¦‚ï¼š
>
> ```json
> {
>   "version": 4,
>   "terraform_version": "1.5.0",
>   "serial": 1,
>   "resources": [
>     {
>       "mode": "managed",
>       "type": "aws_instance",
>       "name": "web",
>       "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
>       "instances": [
>         {
>           "schema_version": 1,
>           "attributes": {
>             "id": "i-1234567890abcdef0",
>             "ami": "ami-0abcdef1234567890",
>             "instance_type": "t2.micro",
>             "private_ip": "10.0.1.25",
>             "public_ip": "34.203.120.12"
>           }
>         }
>       ]
>     }
>   ]
> }
> 
> ```
>
> é»˜è®¤æƒ…å†µä¸‹ï¼ŒTerraform å°† `terraform.tfstate` å­˜å‚¨åœ¨ **æœ¬åœ°ç›®å½•**ï¼ˆå³æ‰§è¡Œ `terraform apply` çš„ç›®å½•ï¼‰ã€‚ä½†å¯¹äºŽå›¢é˜Ÿåä½œï¼Œå»ºè®®ä½¿ç”¨ **è¿œç¨‹å­˜å‚¨**ï¼Œå¦‚ï¼šAWS S3 + DynamoDB

#### HCLè¯­è¨€ 20250220

> HCLï¼ˆHashiCorp Configuration Languageï¼‰æ˜¯ä¸€ç§ä¸“ä¸ºåŸºç¡€è®¾æ–½å³ä»£ç ï¼ˆInfrastructure as Code, IaCï¼‰è®¾è®¡çš„å£°æ˜Žå¼é…ç½®è¯­è¨€ï¼Œç”± HashiCorp å¼€å‘ã€‚å®ƒä¸»è¦ç”¨äºŽ HashiCorp çš„å·¥å…·ï¼Œå¦‚ **Terraform**ã€**Consul** å’Œ **Nomad**ï¼Œç”¨äºŽå®šä¹‰å’Œç®¡ç†äº‘åŸºç¡€è®¾æ–½ã€æœåŠ¡å‘çŽ°å’Œç¼–æŽ’ä»»åŠ¡ã€‚
>
> **å£°æ˜Žå¼è¯­æ³•**ï¼šHCL é‡‡ç”¨ç±»ä¼¼ JSON çš„ç»“æž„ï¼Œä½†æ¯” JSON æ›´å…·å¯è¯»æ€§ï¼ŒåŒæ—¶æ”¯æŒåµŒå¥—å’Œå¤æ‚é…ç½®ã€‚

ä»‹ç»äº†HCLè¯­è¨€ä¸­çš„Variable Typesï¼šInput Variables, Local Variables, Output Variables

tfé‡‡ç”¨çš„HCLè¯­è¨€è¿˜æ˜¯æœ‰è®¸å¤šå†…å®¹çš„...

å¯ä»¥æŠŠSensitive Dataå­˜å‚¨åœ¨ä¸€ä¸ªå•ç‹¬çš„tfvarsæ–‡ä»¶ä¸­ï¼Œé€šè¿‡passçš„æ‰‹æ®µä¼ é€’ï¼Œè¿™è¿˜æœ‰å¦å¤–çš„å¥½å¤„ï¼Œtfæ–‡ä»¶ç›¸å½“äºŽä¸€ä¸ªå‡½æ•°ï¼Œæ ¹æ®ä¸åŒçš„å‚æ•°å¯ä»¥deployåˆ°ä¸åŒçš„äº‘è®¾æ–½ä¸­åŽ»

Meta-Arguments:

> åœ¨ Terraform çš„ HCL è¯­è¨€ä¸­ï¼Œ**Meta-Argumentsï¼ˆå…ƒå‚æ•°ï¼‰** æ˜¯ç‰¹æ®Šçš„å‚æ•°ï¼Œå®ƒä»¬å¯ä»¥ç”¨äºŽ **æŽ§åˆ¶èµ„æºçš„åˆ›å»ºã€ä¾èµ–å…³ç³»å’Œå¾ªçŽ¯é€»è¾‘**ï¼Œä»Žè€Œå¢žå¼º Terraform é…ç½®çš„çµæ´»æ€§å’Œå¯å¤ç”¨æ€§ã€‚
>
> Terraform ä¸­çš„ Meta-Arguments ä¸»è¦åŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªï¼š
>
> | Meta-Argument | ä½œç”¨                                      |
> | ------------- | ----------------------------------------- |
> | `count`       | **åˆ›å»ºå¤šä¸ªç›¸åŒèµ„æº**ï¼ˆåŸºäºŽæ•´æ•°å€¼ï¼‰        |
> | `for_each`    | **åŸºäºŽ map æˆ– set è¿­ä»£åˆ›å»ºå¤šä¸ªèµ„æº**      |
> | `depends_on`  | **æ˜¾å¼å®šä¹‰èµ„æºä¹‹é—´çš„ä¾èµ–å…³ç³»**            |
> | `provider`    | **æŒ‡å®šç‰¹å®šçš„ providerï¼ˆäº‘æä¾›å•†ï¼‰**       |
> | `lifecycle`   | **æŽ§åˆ¶èµ„æºçš„ç”Ÿå‘½å‘¨æœŸï¼ˆé˜²æ­¢åˆ é™¤/æ›´æ–°ç­‰ï¼‰** |
>
> å¦‚æžœä½ åœ¨ CI/CD å’Œ Cloud é¢†åŸŸå·¥ä½œï¼ŒMeta-Arguments åœ¨ **è‡ªåŠ¨åŒ–åŸºç¡€è®¾æ–½ç®¡ç†** é‡Œéžå¸¸é‡è¦ï¼š
>
> - `count` å’Œ `for_each` é€‚ç”¨äºŽ **æ‰¹é‡éƒ¨ç½² Kubernetesã€Lambdaã€VM**
> - `depends_on` ç¡®ä¿ **CI/CD è¿è¡Œé¡ºåºæ­£ç¡®**
> - `provider` é€‚ç”¨äºŽ **å¤šäº‘çŽ¯å¢ƒ**
> - `lifecycle` å¯ä»¥é˜²æ­¢ **æ„å¤–ç ´åç”Ÿäº§çŽ¯å¢ƒ**

ç›¸å½“äºŽHCLè¯­å¥ä¸­çš„å…³é”®å­—

Provisionersï¼š

> `Provisioners`ï¼ˆä¾›åº”å™¨ï¼‰æ˜¯ Terraform ç”¨äºŽåœ¨ **èµ„æºåˆ›å»ºåŽ** æˆ– **é”€æ¯å‰** æ‰§è¡Œæœ¬åœ°æˆ–è¿œç¨‹å‘½ä»¤çš„åŠŸèƒ½ã€‚å®ƒä»¬é€šå¸¸ç”¨äºŽï¼š
>
> - **é…ç½®æœåŠ¡å™¨**ï¼ˆå¦‚å®‰è£…è½¯ä»¶ã€ä¿®æ”¹ç³»ç»Ÿè®¾ç½®ï¼‰
> - **æ‰§è¡Œè„šæœ¬**ï¼ˆå¦‚ Bashã€PowerShellï¼‰
> - **æ–‡ä»¶ä¼ è¾“**ï¼ˆå¦‚ä¸Šä¼ é…ç½®æ–‡ä»¶ï¼‰
> - **å¤„ç†èµ„æºåˆ é™¤é€»è¾‘**ï¼ˆå¦‚è¿è¡Œæ¸…ç†è„šæœ¬ï¼‰
>
>  **å¸¸è§çš„ Provisioners**
>
> | Provisioner ç±»åž‹ | ä½œç”¨                                 |
> | ---------------- | ------------------------------------ |
> | `local-exec`     | åœ¨ **æœ¬åœ°ä¸»æœº** ä¸Šæ‰§è¡Œ Shell å‘½ä»¤    |
> | `remote-exec`    | åœ¨ **è¿œç¨‹ä¸»æœº** ä¸Šæ‰§è¡Œ Shell å‘½ä»¤    |
> | `file`           | å°† **æœ¬åœ°æ–‡ä»¶æˆ–ç›®å½•** å¤åˆ¶åˆ°è¿œç¨‹ä¸»æœº |
> | `chef`           | è¿è¡Œ Chef å®¢æˆ·ç«¯è¿›è¡Œé…ç½®ç®¡ç†         |
> | `puppet`         | è¿è¡Œ Puppet å®¢æˆ·ç«¯è¿›è¡Œé…ç½®ç®¡ç†       |
>
> ### **ç¤ºä¾‹ï¼šTerraform éƒ¨ç½²åŽå‘é€ Slack é€šçŸ¥**
>
> ```
> hCopyEditresource "aws_instance" "example" {
>   ami           = "ami-12345678"
>   instance_type = "t2.micro"
> 
>   provisioner "local-exec" {
>     command = "curl -X POST -H 'Content-type: application/json' --data '{\"text\":\"EC2 å·²åˆ›å»º!\"}' https://hooks.slack.com/services/xxx"
>   }
> }
> ```
>
> ðŸ”¹ **ä½œç”¨**ï¼šTerraform åˆ›å»º EC2 ä¹‹åŽï¼Œå‘é€ Slack é€šçŸ¥ã€‚
>
> **å®˜æ–¹ä¸æŽ¨èä½¿ç”¨ Provisioners**ï¼Œå› ä¸º Terraform æ›´å€¾å‘äºŽå£°æ˜Žå¼é…ç½®ï¼Œè€Œ Provisioners å±žäºŽå‘½ä»¤å¼é…ç½®ã€‚å¦‚æžœå¯ä»¥ï¼Œå»ºè®®ç”¨ Ansibleã€Cloud-Initã€User Data ç­‰æ›¿ä»£ã€‚



#### Terraform Module

Why Modules? 

Infrastructure Speclialists + Applicaiton Developers

> **Moduleï¼ˆæ¨¡å—ï¼‰** æ˜¯ Terraform é‡Œçš„ **å¯å¤ç”¨ä»£ç å•å…ƒ**ï¼Œå¯ä»¥ç”¨æ¥ç»„ç»‡ã€ç®¡ç†å’Œå¤ç”¨ Terraform é…ç½®ã€‚ä½ å¯ä»¥æŠŠ Terraform Module ç†è§£ä¸º **å‡½æ•°æˆ–åº“**ï¼Œå®ƒèƒ½ï¼š
>
> - **å°è£…** å¤æ‚èµ„æºï¼Œæä¾›ç®€å•çš„æŽ¥å£
> - **æé«˜ä»£ç å¤ç”¨æ€§**ï¼Œé¿å…é‡å¤å†™ç›¸åŒé…ç½®
> - **ç®€åŒ–ç»´æŠ¤**ï¼Œè®©åŸºç¡€è®¾æ–½æ›´æ˜“ç®¡ç†
> - **æ”¯æŒå‚æ•°åŒ–**ï¼Œé€šè¿‡å˜é‡è‡ªå®šä¹‰èµ„æºè¡Œä¸º
>
> ### **Module çš„åŸºæœ¬ç»“æž„**
>
> ä¸€ä¸ª Terraform Module å…¶å®žå°±æ˜¯ **ä¸€ä¸ªåŒ…å« `.tf` é…ç½®æ–‡ä»¶çš„ç›®å½•**ã€‚æ¯”å¦‚ï¼Œä¸‹é¢çš„ç›®å½•ç»“æž„å°±æ˜¯ä¸€ä¸ª Moduleï¼š
>
> ```
> perlCopyEditmy-module/
> â”‚â”€â”€ main.tf      # æ ¸å¿ƒèµ„æºå®šä¹‰
> â”‚â”€â”€ variables.tf # å®šä¹‰è¾“å…¥å˜é‡
> â”‚â”€â”€ outputs.tf   # å®šä¹‰è¾“å‡ºå˜é‡
> ```
>
> åœ¨ Terraform é…ç½®ä¸­ï¼Œä½ å¯ä»¥ **è°ƒç”¨** è¿™ä¸ª Moduleï¼Œå¹¶ä¼ é€’å‚æ•°æ¥åˆ›å»ºèµ„æºã€‚
>
> ## **ä»€ä¹ˆæ—¶å€™ä½¿ç”¨ Moduleï¼Ÿ**
>
> | åœºæ™¯                                  | é€‚åˆä½¿ç”¨ Moduleï¼Ÿ            |
> | ------------------------------------- | ---------------------------- |
> | **å¤šä¸ªçŽ¯å¢ƒï¼ˆdev/prodï¼‰**              | âœ… æ˜¯ï¼Œå°è£…åŽåªéœ€æ”¹å˜é‡       |
> | **é‡å¤ä½¿ç”¨ç›¸åŒèµ„æºï¼ˆVPC, EC2, RDSï¼‰** | âœ… æ˜¯ï¼Œæé«˜å¤ç”¨æ€§             |
> | **å›¢é˜Ÿåä½œ**                          | âœ… æ˜¯ï¼Œæ¨¡å—åŒ–ç»“æž„æ›´æ¸…æ™°       |
> | **ç®€å•å•ä¸€çš„èµ„æº**                    | âŒ å¦ï¼Œå¯ä»¥ç›´æŽ¥å†™åœ¨ `main.tf` |

å¯ä»¥è‡ªå·±å†™Moduleï¼Œç„¶åŽåœ¨ä¸»è¦tfä¸­å¼•ç”¨ï¼Œä¹Ÿå¯ä»¥ç›´æŽ¥å¼•ç”¨è¿œç¨‹ä»“åº“ä¸­çš„module

è®¾è®¡Moduleå°±åƒè®¾è®¡è½¯ä»¶å¼€å‘ä¸­å„ç§ç±»å¯¹å§ï¼Œéœ€è¦å¥½å¥½æ€è€ƒ

> Terraform Registry æ˜¯ Terraform å®˜æ–¹æä¾›çš„ **æ¨¡å—å’Œæä¾›å•†ï¼ˆProvidersï¼‰ä»“åº“**ï¼Œä½ å¯ä»¥ä»Žè¿™é‡Œä¸‹è½½å’Œä½¿ç”¨çŽ°æˆçš„ Terraform èµ„æºã€‚
>
> Terraform Registry ä¸»è¦åŒ…å«ä¸¤å¤§ç±»ï¼š
>
> 1. **Providersï¼ˆæä¾›å•†ï¼‰**ï¼šAWSã€Azureã€GCPã€Kubernetes ç­‰
> 2. **Modulesï¼ˆæ¨¡å—ï¼‰**ï¼šVPCã€EC2ã€EKSã€RDS ç­‰

ä½ å¯ä»¥åŽ»ä¸‹è½½Providersï¼Œä¹Ÿå¯ä»¥è¿›ä¸€æ­¥ä¸‹è½½ç›¸åº”çš„æ¨¡å—ï¼Œä½ è¿˜å¯ä»¥è‡ªå·±ä¸Šä¼ Moduleåˆ°è¿œç«¯ä»“åº“



#### Terraform Workspaces

> **Terraform Workspaces** å…è®¸ä½ åœ¨ **åŒä¸€å¥— Terraform é…ç½®** ä¸‹ç®¡ç†å¤šä¸ªç‹¬ç«‹çš„çŽ¯å¢ƒï¼ˆå¦‚ `dev`ã€`staging`ã€`prod`ï¼‰ã€‚å®ƒçš„ä½œç”¨ç±»ä¼¼äºŽ **å‘½åç©ºé—´**ï¼Œå¯ä»¥ç”¨æ¥ç®¡ç†å¤šä¸ªä¸åŒçš„ **çŠ¶æ€ï¼ˆstateï¼‰**ã€‚
>
> åœ¨ Terraform ä¸­ï¼Œé»˜è®¤çš„çŠ¶æ€æ–‡ä»¶ï¼ˆ`terraform.tfstate`ï¼‰å­˜å‚¨èµ„æºä¿¡æ¯ã€‚å¦‚æžœä½ éœ€è¦å¤šä¸ªçŽ¯å¢ƒï¼ˆå¦‚ `dev` å’Œ `prod`ï¼‰ï¼Œç›´æŽ¥ä½¿ç”¨ `terraform.tfstate` å¯èƒ½ä¼šå¯¼è‡´çŽ¯å¢ƒæ··ä¹±ã€‚
>
> **Workspaces è®©ä½ å¯ä»¥åœ¨åŒä¸€ä»½é…ç½®ä»£ç ä¸‹ï¼Œåˆ›å»ºå¤šä¸ªçŠ¶æ€æ–‡ä»¶ï¼Œåˆ†åˆ«ç®¡ç†ä¸åŒçš„çŽ¯å¢ƒã€‚**
>
> **æ¯ä¸ª Workspace éƒ½æœ‰ç‹¬ç«‹çš„ `terraform.tfstate` æ–‡ä»¶**ï¼Œä¸ä¼šäº’ç›¸è¦†ç›–ã€‚

å¯ä»¥é€šè¿‡åƒgité‚£æ ·åˆ‡æ¢ä¸åŒçš„çŽ¯å¢ƒ

> ## **Workspaces vs. å˜é‡æ–‡ä»¶ï¼ˆtfvarsï¼‰**
>
> | æ–¹å¼                     | é€‚ç”¨åœºæ™¯                                            | ä¼˜åŠ¿                       | ç¼ºç‚¹                           |
> | ------------------------ | --------------------------------------------------- | -------------------------- | ------------------------------ |
> | **Terraform Workspaces** | ç®¡ç†å¤šä¸ªçŽ¯å¢ƒï¼ˆdev, staging, prodï¼‰                  | åŒä¸€ä»½ä»£ç ï¼Œå¤šçŽ¯å¢ƒç‹¬ç«‹ç®¡ç† | åœ¨å¤æ‚é¡¹ç›®ä¸­å¯èƒ½éš¾ä»¥ç®¡ç†       |
> | **å˜é‡æ–‡ä»¶ï¼ˆtfvarsï¼‰**   | é€šè¿‡ `terraform apply -var-file` ä¼ é€’ä¸åŒçŽ¯å¢ƒçš„å˜é‡ | çµæ´»æŽ§åˆ¶å˜é‡               | éœ€è¦é¢å¤–ç»´æŠ¤å¤šä¸ª `tfvars` æ–‡ä»¶ |
>
> å¯¹äºŽå°åž‹é¡¹ç›®ï¼Œ**Workspaces æ›´æ–¹ä¾¿**ã€‚
> å¯¹äºŽå¤§åž‹é¡¹ç›®ï¼ŒæŽ¨è **ç”¨ `tfvars` æ–‡ä»¶ç®¡ç†çŽ¯å¢ƒ**ï¼Œå¦‚ï¼š



> [Terragrunt](https://github.com/gruntwork-io/terragrunt) æ˜¯ Terraform çš„ä¸€ä¸ª **è¾…åŠ©å·¥å…·**ï¼Œå®ƒå¸®åŠ©ç®¡ç† **å¤šçŽ¯å¢ƒï¼ˆmulti-environmentï¼‰åŸºç¡€è®¾æ–½**ï¼Œè§£å†³ Terraform **ä»£ç é‡å¤** å’Œ **State ç®¡ç†** çš„é—®é¢˜ã€‚
>
> ðŸ‘‰ **ç®€å•æ¥è¯´ï¼ŒTerragrunt æ˜¯ Terraform çš„ä¸€ä¸ª Wrapperï¼Œå¸®ä½ ä¼˜åŒ–ä»£ç ç»“æž„å’Œç®¡ç†è¿œç¨‹çŠ¶æ€ï¼**

ç”¨äº†å¾ˆå¤§ç¯‡å¹…è®²file structureï¼Œç›¸å½“äºŽC#è®¾è®¡å„ç§ç±»ï¼Œè®©é¡¹ç›®æ›´å®¹æ˜“ç®¡ç†

#### Test and Develop 20250221

**Code Rot**ï¼ˆä»£ç è…çƒ‚ï¼‰ï¼šæŒ‡çš„æ˜¯**ä»£ç è´¨é‡éšç€æ—¶é—´çš„æŽ¨ç§»é€æ¸æ¶åŒ–ï¼Œå˜å¾—éš¾ä»¥ç†è§£ã€ç»´æŠ¤æˆ–æ‰©å±•**ï¼Œæœ€ç»ˆå½±å“è½¯ä»¶çš„ç¨³å®šæ€§å’Œå¼€å‘æ•ˆçŽ‡ã€‚

Static Checkï¼šæ¯”å¦‚ç”¨terraform fmt -checkè¿™ä¸ªå‘½ä»¤æ¥æ£€æŸ¥

Manual Testing

Automated Testing: å¯ä»¥ç”¨goè¯­è¨€å†™è„šæœ¬æµ‹è¯•..å¯ä»¥åœ¨è„šæœ¬ä¸­æ¨¡æ‹Ÿå‘é€HTTPï¼Œå°±åœ¨ä¸å®žé™…æ“ä½œserverçš„æƒ…å†µä¸‹å®Œæˆå•ä½“æµ‹è¯•ï¼Ÿ

è‡³äºŽå¼€å‘ï¼Œå¯ä»¥ç”¨Github Actionï¼ŒGitLabçš„CICDåŠŸèƒ½

Cloud Nuke: ä¸€æ¬¡æ€§æ¸…é™¤å•ä¸€è´¦å·çš„æ‰€æœ‰äº‘ä¸Šèµ„æºçš„å·¥å…·ï¼Œé¿å…è¢«è®¡è´¹



ä½ å¯ä»¥ç”¨Github Action

1. å†™ä¸ªterraform.yml
2. è®¾ç½®è¿žæŽ¥AWSä¸Šçš„æœåŠ¡å™¨æµ‹è¯•
3. åœ¨è¿™ä¸ªæœåŠ¡å™¨ä¸Šæ“ä½œå„ç§Terraformå‘½ä»¤
4. ç”šè‡³è¿˜è¦è°ƒç”¨goæ¥æµ‹è¯•



### Learn Terraform with Azure by Building a Dev Environment 20250331

[Link](https://www.youtube.com/watch?v=V53AHWun17s)

Install Azure CLI on Windows  => reopen vscode å°±å¯ä»¥åœ¨terminal è¿è¡Œ `az login` ç­‰Azureçš„å‘½ä»¤

æŸ¥é˜…Azure Providerï¼Œç”¨äºŽTerraformè°ƒç”¨

Terminal Command:

```shell
terraform fmt
terraform plan

terraform plan -destroy   #é€‚ç”¨äºŽæ£€æŸ¥é”€æ¯å‰çš„å½±å“  
terraform apply -auto-approve #é€‚ç”¨äºŽè‡ªåŠ¨åŒ–çŽ¯å¢ƒï¼ˆå¦‚ CI/CDï¼‰ï¼Œä½†åœ¨ç”Ÿäº§çŽ¯å¢ƒè¦è°¨æ…Žä½¿ç”¨
terraform state list
terraform apply -refresh-only
terraform output
terraform console
```

main.tf:

```terraform 
terraform {
  required_providers {
    azurerm = {
      source  = "hashicorp/azurerm"
      version = "~> 3.0"
    }
  }
  required_version = ">= 1.0"
}

provider "azurerm" {
  features {}
}

resource "azurerm_resource_group" "example" {
  name     = "example-resources"
  location = "East US"
}

resource "azurerm_virtual_network" "example" {
  name                = "example-network"
  location            = azurerm_resource_group.example.location
  resource_group_name = azurerm_resource_group.example.name
  address_space       = ["10.0.0.0/16"]
}

resource "azurerm_subnet" "example" {
  name                 = "example-subnet"
  resource_group_name  = azurerm_resource_group.example.name
  virtual_network_name = azurerm_virtual_network.example.name
  address_prefixes     = ["10.0.1.0/24"]
}

resource "azurerm_network_security_group" "example" {
  name                = "example-nsg"
  location            = azurerm_resource_group.example.location
  resource_group_name = azurerm_resource_group.example.name

  security_rule {
    name                       = "allow-ssh"
    priority                   = 1001
    direction                  = "Inbound"
    access                     = "Allow"
    protocol                   = "Tcp"
    source_port_range          = "*"
    destination_port_range     = "22"
    source_address_prefix      = "*"
    destination_address_prefix = "*"
  }
}

resource "azurerm_public_ip" "example" {
  name                = "example-public-ip"
  location            = azurerm_resource_group.example.location
  resource_group_name = azurerm_resource_group.example.name
  allocation_method   = "Dynamic"
}

resource "azurerm_network_interface" "example" {
  name                = "example-nic"
  location            = azurerm_resource_group.example.location
  resource_group_name = azurerm_resource_group.example.name

  ip_configuration {
    name                          = "internal"
    subnet_id                     = azurerm_subnet.example.id
    private_ip_address_allocation = "Dynamic"
    public_ip_address_id          = azurerm_public_ip.example.id
  }
}

resource "azurerm_virtual_machine" "example" {
  name                  = "example-vm"
  location              = azurerm_resource_group.example.location
  resource_group_name   = azurerm_resource_group.example.name
  network_interface_ids = [azurerm_network_interface.example.id]
  vm_size               = "Standard_DS1_v2"

  storage_image_reference {
    publisher = "Canonical"
    offer     = "UbuntuServer"
    sku       = "18.04-LTS"
    version   = "latest"
  }

  storage_os_disk {
    name              = "example-os-disk"
    caching           = "ReadWrite"
    create_option     = "FromImage"
    managed_disk_type = "Standard_LRS"
  }

  os_profile {
    computer_name  = "example-vm"
    admin_username = "adminuser"
  }
}
```

ä½ å¯ä»¥å¯¹tfæ–‡ä»¶åšä¸€äº›ä¿®æ”¹ï¼Œå¢žåŠ SSHç™»å½•åŠŸèƒ½ï¼Œç„¶åŽä¸ºVScodeå¢žåŠ remote-SSHçš„æ‰©å±•ï¼Œä½ å¯ä»¥ç›´æŽ¥ç™»å½•èµ„æºä¸­çš„VM,æ˜¯é‚£ç§å·¦ä¾§éƒ½ä¼šå‡ºçŽ°Linuxç›®å½•çš„é‚£ç§æ·±åº¦ç™»å½•å“¦ã€‚

> Terraform `.tpl` æ–‡ä»¶é€šå¸¸ç”¨äºŽ `templatefile()` æˆ– `data "template_file"` æ–¹å¼ï¼Œæ¥åŠ¨æ€å¡«å……å˜é‡ã€‚
>
> `.tpl` æ–‡ä»¶æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ï¼Œå…¶ä¸­å¯ä»¥ä½¿ç”¨ `${}` è¯­æ³•æ¥æ’å…¥å˜é‡ã€‚
>
> ```shell
> Hello, ${name}! Welcome to ${company}.
> ```

> å¦‚æžœä½ éœ€è¦åœ¨ VM å¯åŠ¨æ—¶æ‰§è¡ŒæŸäº›åˆå§‹åŒ–ä»»åŠ¡ï¼ˆå¦‚å®‰è£…è½¯ä»¶ã€é…ç½®ç”¨æˆ·ï¼‰ï¼Œå¯ä»¥ä½¿ç”¨ `.tpl` æ–‡ä»¶æ¥åŠ¨æ€ç”Ÿæˆ `cloud-init` é…ç½®

ä½ å¯ä»¥åœ¨ main.tfä¸­ä½¿ç”¨ provisioneråŽ»è°ƒç”¨tplæ–‡ä»¶æ¥ä¸ºVMé¢„ç½®Dockerç­‰å…¶å®ƒæ“ä½œã€‚

=>ä¸å¤ªæŽ¨èprovisionerï¼Œæ›´å¤šåº”è¯¥æ˜¯Ansibleçš„å·¥ä½œï¼Œå› ä¸ºTerraformæ— æ³•æŽ¢çŸ¥provisioneræ‰€å¸¦æ¥çš„çŠ¶æ€å˜åŒ–ï¼Œä½ éœ€è¦ `terraform apply -replace resource_name`æ¥ä½¿å…¶provisionerç”Ÿæ•ˆ





# Jenkins

[Jenkinsè‡ªåŠ¨åŒ–éƒ¨ç½²å…¥é—¨è¯¦ç»†æ•™ç¨‹](https://www.cnblogs.com/wfd360/p/11314697.html)

## å°šç¡…è°·Jenkinsæ•™ç¨‹

[link](https://www.bilibili.com/video/BV1bS4y1471A?spm_id_from=333.788.videopod.episodes&vd_source=c13700902d2c98df282b6f1f2889c0cb&p=4)

### GitLabä»‹ç»åŠå®‰è£…å‡†å¤‡20241202

GitLabæ‰€åœ¨çš„æœåŠ¡å™¨è‡³å°‘16Gå†…å­˜

> GitHub æœ¬èº«æ˜¯ä¸€ä¸ªç”± GitHub å…¬å¸æ‰˜ç®¡çš„ **äº‘æœåŠ¡**ï¼Œå¹¶æ²¡æœ‰å¼€æ”¾å®Œæ•´çš„è‡ªæ‰˜ç®¡ç‰ˆæœ¬ã€‚GitHub ä¸»è¦æ˜¯æä¾›äº‘æ‰˜ç®¡æœåŠ¡çš„ï¼Œå› æ­¤å®ƒä¸èƒ½åƒ GitLab é‚£æ ·ç›´æŽ¥åœ¨è‡ªå·±çš„æœåŠ¡å™¨ä¸Šæ­å»ºå’Œè¿è¡Œã€‚
>
> ç„¶è€Œï¼Œ**GitHub æä¾›äº† GitHub Enterprise**ï¼Œè¿™æ˜¯ä¸€æ¬¾é’ˆå¯¹ä¼ä¸šçš„ç§æœ‰éƒ¨ç½²ç‰ˆæœ¬ï¼Œå…è®¸ä¼ä¸šåœ¨è‡ªå·±çš„æœåŠ¡å™¨ä¸Šè¿è¡Œ GitHubã€‚

> **GitLab.com** æ˜¯ GitLab æä¾›çš„äº‘æ‰˜ç®¡å¹³å°ï¼Œç±»ä¼¼äºŽ GitHub.comï¼Œæä¾›å…è´¹çš„åŸºç¡€åŠŸèƒ½å’Œæ”¶è´¹çš„ä¼ä¸šçº§åŠŸèƒ½ï¼Œé€‚ç”¨äºŽä¸ªäººã€å°åž‹å›¢é˜Ÿåˆ°å¤§åž‹ä¼ä¸šã€‚
>
> ä¸Ž GitHub ç›¸æ¯”ï¼ŒGitLab åœ¨ **DevOps** é›†æˆæ–¹é¢æä¾›äº†æ›´å¤šåŠŸèƒ½ï¼Œå°¤å…¶åœ¨ **CI/CD** å’Œ **è‡ªåŠ¨åŒ–ç®¡ç†** ä¸Šæ›´ä¸ºå¼ºå¤§ï¼Œé€‚åˆéœ€è¦å…¨æµç¨‹é›†æˆçš„å›¢é˜Ÿ

=>Githubåå‘äºŽ äº‘æœåŠ¡æ‰˜ç®¡ä»£ç ï¼Œ GitLabåå‘äºŽç»™ä¼ä¸šæä¾›ä¸€ä¸ªDevOpsè§£å†³æ–¹æ¡ˆ

ä¸ä»…å¯ä»¥ç”¨yumç›´æŽ¥å®‰è£…åœ¨linuxä¸Šï¼Œè¿˜å¯ä»¥åˆ©ç”¨dockerå®‰è£…GitLabï¼š

> **å¿«é€Ÿéƒ¨ç½²**ï¼šDocker æä¾›äº† GitLab å®˜æ–¹çš„é•œåƒï¼Œä½¿ç”¨ Docker å®‰è£… GitLab æ— éœ€ç¹ççš„æ‰‹åŠ¨é…ç½®å’Œä¾èµ–ç®¡ç†ã€‚åªéœ€å‡ ä¸ªå‘½ä»¤å°±å¯ä»¥å¯åŠ¨ GitLab å®žä¾‹ï¼Œå¤§å¤§ç®€åŒ–äº†å®‰è£…è¿‡ç¨‹ã€‚
>
> **é¢„é…ç½®çŽ¯å¢ƒ**ï¼šDocker é•œåƒå·²ç»åŒ…å«äº†æ‰€æœ‰ GitLab è¿è¡Œæ‰€éœ€çš„ç»„ä»¶ï¼ˆå¦‚æ•°æ®åº“ã€Redis ç­‰ï¼‰ï¼Œæ— éœ€é¢å¤–é…ç½®ã€‚
>
> **è·¨å¹³å°å…¼å®¹æ€§**ï¼šDocker å¯ä»¥åœ¨å¤šç§æ“ä½œç³»ç»Ÿä¸Šè¿è¡Œï¼ŒåŒ…æ‹¬ Linuxã€Windows å’Œ macOSï¼Œå› æ­¤ä¸éœ€è¦æ‹…å¿ƒæ“ä½œç³»ç»Ÿçš„å…¼å®¹æ€§é—®é¢˜ã€‚
>
> æ€»çš„æ¥è¯´ï¼Œä½¿ç”¨ Docker éƒ¨ç½² GitLab ä¸ä»…èƒ½å‡å°‘å®‰è£…ã€é…ç½®å’Œç»´æŠ¤çš„éš¾åº¦ï¼Œè¿˜èƒ½æé«˜çµæ´»æ€§å’Œå¯æ‰©å±•æ€§ï¼Œç‰¹åˆ«é€‚åˆåœ¨ DevOps æˆ–å¤§è§„æ¨¡å¼€å‘çŽ¯å¢ƒä¸­ä½¿ç”¨ã€‚

=>GItLabèŠ±é’±çš„è¯å¯ä»¥ç›´æŽ¥CICDæµç¨‹ï¼Œè€Œä¸ç”¨åŽ»é¢å¤–ç”¨Jenkins

### Jenkinså®‰è£… åŠç®€å•é…ç½® 20241204

éœ€è¦JAVAå®‰è£…çŽ¯å¢ƒ Java8(JREæˆ–è€…JDKéƒ½è¡Œ)

åœ¨ä¸€ä¸ªlinuxä¸Šå®‰è£…å¥½ï¼ŒæŒ‡å®šç«¯å£ï¼Œå°±å¯ä»¥é€šè¿‡æµè§ˆå™¨ç™»å½•Jenkinsç•Œé¢äº†

åŒä¸€å°æœåŠ¡å™¨å†è£…ä¸ªMavenä¾¿äºŽä¹‹åŽç¼–è¯‘Javaé¡¹ç›®ä»£ç 



åœ¨Jenkinsç•Œé¢ è¾“å…¥ Repository URL ï¼ˆè®°å¾—æœåŠ¡å™¨ä¸Šæå‰å®‰è£…gitå“ˆï¼‰

Java ç”¨Mavenï¼Œå¦‚æžœæ˜¯C/C++é¡¹ç›®è¿˜å¯ä»¥æœ‰ CMakeçš„æ’ä»¶é…ç½® æ¥æž„å»ºé¡¹ç›®



å®‰è£…ä¸€ä¸ª Publish over SSHæ’ä»¶, æ·»åŠ ä¸€å°ç›®æ ‡æœåŠ¡å™¨ç”¨æ¥è¿è¡Œæž„å»ºå¥½çš„ é¡¹ç›®

=> è¿ž Exec command è¿™æ ·çš„ä¹Ÿå¯ä»¥åœ¨ Jenkinsç•Œé¢ ä¸Šç›´æŽ¥å¡«... è¿˜æœ‰ Remote Directory



æ€»ç»“è€Œè¨€æœ‰è¿™ä¹ˆå‡ å¤©æœåŠ¡å™¨ï¼š è‡ªå·±çš„localï¼ŒgitlabæœåŠ¡å™¨ï¼ŒJenkinsæœåŠ¡å™¨è‡ªåŠ¨ç¼–è¯‘å¥½ï¼Œå‘é€åˆ°test serverç”¨æ¥å¯åŠ¨

æœ€ç®€é™‹çš„CICDå°±æž„å»ºå¥½äº†ï¼Œä½†æ˜¯æ€Žä¹ˆé…ç½®ä¸€pushå°±è¿è¡Œå‘¢ï¼Ÿ





### Pre Steps 20241206

DashBoard

General,æºç ç®¡ç†ï¼Œæž„å»ºè§¦å‘å™¨ï¼ŒPre Stepsï¼ŒBuild,Post Steps,æž„å»ºè®¾ç½®ï¼Œæž„å»ºåŽæ“ä½œ



Pre Stepséƒ¨åˆ† å¯ä»¥å¯¹ ç›®æ ‡æœåŠ¡å™¨ï¼ˆæµ‹è¯•ç”¨ï¼‰è¿›è¡Œä¸€äº›æ“ä½œï¼Œé€šå¸¸å°±åœ¨ç›®æ ‡æœåŠ¡å™¨ä¸Šå†™ä¸ªè„šæœ¬,æŠŠå ç”¨ç€çš„ç«¯å£çš„è¿›ç¨‹killæŽ‰ä¸€ç±»çš„ï¼Œç”±Jenkinsè¿›è¡Œè°ƒç”¨ï¼ˆSend file or execute commands over SSHï¼‰

### æž„å»ºè§¦å‘å™¨  20241208

åœ¨Jenkinsæž„å»ºè§¦å‘å™¨ä¸‹ åˆ›é€ ä¸€ä¸ª URLï¼Œç„¶åŽgitlabå¯ä»¥é€šè¿‡è¿™ä¸ªURLæ¥è°ƒç”¨Jenkinsæ¥è§¦å‘è‡ªåŠ¨æž„å»ºï¼Œç›¸å½“äºŽåœ¨Jenkinsä¸Šæ‰‹åŠ¨æŒ‰ä¸‹æž„å»ºæŒ‰é’®

ï¼ˆæœ‰å¯èƒ½è¦å®‰è£… Plugin Managerçš„æ’ä»¶æ¥è§£å†³éªŒè¯é—®é¢˜ï¼‰



æäº¤ä»£ç å°±è‡ªåŠ¨æž„å»ºè¿‡äºŽé¢‘ç¹ï¼Œç”±äºŽå¯¹äºŽå¤§é¡¹ç›®è€Œè¨€ï¼Œä¸€èˆ¬æ˜¯åœ¨GitLabç•Œé¢ä¸Šåˆå¹¶åˆ†æ”¯åŽ è‡ªåŠ¨æž„å»º

 åˆ©ç”¨GitLab WebhooksåŽ»è§‰å¯Ÿåˆ° åˆå¹¶åˆ†æ”¯ è¿™ä¸€äº‹ä»¶ ç„¶åŽå›žè°ƒ Jenkinsæä¾›çš„URL è¿›è¡Œå®žçŽ°

GitLabï¼šè®¾ç½®->Webhook => æœ‰è®¸å¤šå‡ºå‘æ¥æºï¼ŒåŒ…æ‹¬ pushï¼Œmergeç­‰äº‹ä»¶



ç»“è®ºæ˜¯ ä¸€pushå°±è¿è¡Œçš„è¯ Jenkinså¿…é¡»ç»“åˆGitLabæ¥å®Œæˆ



ä¸Šé¢æ‰€è¯´çš„è¿™ç§æž„å»ºæ–¹å¼ å…¶å®žæ˜¯ Jenkins çš„ è§¦å‘è¿œç¨‹æž„å»ºï¼ˆå°±æ˜¯jenkinsæœ¬èº«åªæä¾›ä¸€ä¸ªAPIå‡ºåŽ»ï¼‰ï¼Œæ­¤å¤–è¿˜æœ‰å…¶ä»–æž„å»ºæ–¹å¼ï¼Œæ¯”å¦‚è·Ÿå…¶ä»–é¡¹ç›®ç›¸å…³è”ï¼Œæ¯”å¦‚ Build after other projexts are built, å®šæœŸæž„å»º(Build periodically)ï¼Œ ä»¥åŠJenkinsä¸»åŠ¨åŽ»æŸ¥çœ‹gitåœ°å€æœ‰æ²¡æœ‰å˜åŒ–è¿›è¡Œæž„å»º(Poll SCM) ç­‰



å®šæ—¶æ‰§è¡Œä»»åŠ¡ï¼šJenkinsæœ‰å»ºç«‹åœ¨åŸºæœ¬çš„cronè¡¨è¾¾å¼ä¸ŠåŠ äº†Hashå€¼çš„ä¸“ç”¨è¡¨è¾¾å¼ï¼Œcronè¡¨è¾¾å¼å°±æ˜¯å¹´æœˆæ—¥æ—¶åˆ†

åœ¨Jenkinsç•Œé¢ä¸Š(Build periodically)æ‰“å‹¾ï¼Œæ—¥ç¨‹è¡¨ä¸­å¡«å…¥cronè¡¨è¾¾å¼



Poll SCMï¼šä¹Ÿéœ€è¦è¾“å…¥ä¸€ä¸ªcronè¡¨è¾¾å¼ åŽ»æŽ¢æµ‹ GitLabä¸ŠæŽ¢æµ‹ä»£ç æ˜¯å¦æœ‰å˜åŒ–



æœ€åŽè¿˜å¯ä»¥åœ¨ DashBoard->Configure Systemä¸­é…ç½®é‚®ç®±æŽ¥å—æž„å»ºé€šçŸ¥ï¼Œæ¯”å¦‚ä»Žä½ çš„ä¸€ä¸ª163é‚®ç®±å‘é€åˆ°ä½ çš„QQé‚®ç®±

### å®¹å™¨åŒ–æž„å»º 20241209

ä¸‰ç§æ–¹å¼ï¼š

1. å¤–æŒ‚ç›®å½•
2. jaråŒ…ç›´æŽ¥æ‰“åŒ…åˆ°é•œåƒé‡Œï¼šå¯åŠ¨ä¸€ä¸ªè™šæ‹Ÿæœºæµ‹è¯•dockerï¼›åŽ»dockerå®˜æ–¹å¸‚åœºé‡Œç›´æŽ¥æ‰¾æ”¯æŒjdkçš„é•œåƒï¼Œåœ¨è™šæ‹ŸæœºæŸä¸€è·¯å¾„åˆ›é€ dockerfileï¼›åœ¨dockerfileä¸­åŠ å…¥ jaråŒ…è·¯å¾„ ç„¶åŽå¯åŠ¨docker
3. åœ¨2çš„åŸºç¡€ä¸Šç”Ÿæˆæ–°é•œåƒï¼ŒæŽ¨é€åˆ°dockerç§æœä¸­ï¼Œæ¯”å¦‚Harborï¼Œç„¶åŽå†ç”±k8sé›†ç¾¤è‡ªåŠ¨ç®¡ç†éƒ¨ç½²å®¹å™¨ã€‚å¤§åž‹é¡¹ç›®åŸºæœ¬é‡‡ç”¨è¿™ä¸ªæ¨¡å¼ï¼Œæ˜¯ä¸»æµã€‚å°åž‹é¡¹ç›®è¯´å®žè¯ä¹Ÿä¸å¤ªç”¨1ä¸Ž2ï¼Œç›´æŽ¥å°±ä¸ç”¨å®¹å™¨äº†å“ˆå“ˆ

dockerfileå¯ä»¥ä½œä¸ºä»£ç ä¸€éƒ¨åˆ†æŽ¨é€åˆ°gitä¸Š

åœ¨Jenkinsä¸­çš„Pre stepsä¸ŽPost Stepsä¸­ç›¸åº”æ”¹æˆåœæ­¢ä»¥åŠå¯åŠ¨dockerç­‰çš„è®¾ç½®

### Jenkinsé›†ç¾¤å¹¶å‘æž„å»º

é›†ç¾¤åŒ–æž„å»ºå¯ä»¥æœ‰æ•ˆæå‡æž„å»ºæ•ˆçŽ‡ï¼Œå°¤å…¶æ˜¯å›¢é˜Ÿé¡¹ç›®æ¯”è¾ƒå¤šæˆ–æ˜¯å­é¡¹ç›®æ¯”è¾ƒå¤šçš„æ—¶å€™ï¼Œå¯ä»¥å¹¶å‘åœ¨å¤šå°æœºå™¨ä¸Šæ‰§è¡Œæž„å»º

JenkinsæœåŠ¡å™¨å¤šå¯åŠ¨ä¸¤å°

åœ¨ç¬¬ä¸€å°Jenkinsæ‰¾åˆ° Manage nodes and cloudè¿™ä¸ªç•Œé¢ï¼Œå¢žåŠ å…¶ä»–JenkinsæœåŠ¡å™¨çš„èŠ‚ç‚¹ï¼›ç„¶åŽåˆ°Generalä¸­æ‰¾åˆ° å¹¶å‘æž„å»º æŒ‰é’®

### æµæ°´çº¿ pipeline 20241210

Jenkinsçš„æµæ°´çº¿é…ç½®æ–‡ä»¶Jenkinsfileå°±åƒdockerçš„dockerfile

Dashboard->mypipeline: General,æž„å»ºè§¦å‘å™¨ï¼Œé«˜çº§é¡¹ç›®é€‰é¡¹ï¼Œæµæ°´çº¿

æµæ°´çº¿é…ç½®æ–‡ä»¶ æ˜¯ä¸€ä¸ªç”±ç‰¹æ®Šè¯­æ³•ç»“æž„çš„è¿è¡ŒäºŽ JenkinsæœåŠ¡å™¨ä¸Šçš„ è„šæœ¬

ä¸¾ä¾‹ï¼š

```json
pipeline {
    agent any  // å®šä¹‰æµæ°´çº¿çš„æ‰§è¡ŒçŽ¯å¢ƒï¼Œanyè¡¨ç¤ºå¯ä»¥åœ¨ä»»ä½•å¯ç”¨çš„ä»£ç†ä¸Šè¿è¡Œ

    environment {
        // å®šä¹‰çŽ¯å¢ƒå˜é‡
        CC = 'gcc'  // C ç¼–è¯‘å™¨ï¼Œè®¾ç½®ä¸º GCC
        BUILD_DIR = 'build'  // å­˜æ”¾æž„å»ºäº§ç‰©çš„ç›®å½•
    }

    stages {
        // é˜¶æ®µï¼šå‡†å¤‡çŽ¯å¢ƒ
        stage('Prepare') {
            steps {
                echo 'Preparing environment...'
                script {
                    // æ¸…ç†æ—§çš„æž„å»ºæ–‡ä»¶
                    sh 'rm -rf ${BUILD_DIR}'  // åˆ é™¤æ—§çš„ build ç›®å½•
                    sh 'mkdir ${BUILD_DIR}'  // åˆ›å»ºæ–°çš„ build ç›®å½•
                }
            }
        }

        // é˜¶æ®µï¼šæž„å»º
        stage('Build') {
            steps {
                echo 'Building the project...'
                script {
                    // ç¼–è¯‘ C é¡¹ç›®
                    sh '${CC} -o ${BUILD_DIR}/my_program src/*.c'  // ä½¿ç”¨ GCC ç¼–è¯‘ C æºæ–‡ä»¶
                }
            }
        }

        // é˜¶æ®µï¼šæµ‹è¯•
        stage('Test') {
            steps {
                echo 'Running tests...'
                script {
                    // å‡è®¾æœ‰ä¸€ä¸ªæµ‹è¯•å¯æ‰§è¡Œæ–‡ä»¶ï¼Œè¿è¡Œæµ‹è¯•
                    sh './${BUILD_DIR}/my_program --test'  // è¿è¡Œæµ‹è¯•å‘½ä»¤
                }
            }
        }

        // é˜¶æ®µï¼šéƒ¨ç½²
        stage('Deploy') {
            steps {
                echo 'Deploying the application...'
                script {
                    // å‡è®¾éƒ¨ç½²æ˜¯å°†å¯æ‰§è¡Œæ–‡ä»¶ä¸Šä¼ åˆ°è¿œç¨‹æœåŠ¡å™¨
                    sh 'scp ${BUILD_DIR}/my_program user@server:/path/to/deploy'  // ä½¿ç”¨ SCP ä¸Šä¼ ç¨‹åº
                }
            }
        }
    }

    post {
        success {
            echo 'The build and deploy process succeeded!'  // æˆåŠŸæ—¶è¾“å‡º
        }
        failure {
            echo 'The build or deploy process failed.'  // å¤±è´¥æ—¶è¾“å‡º
        }
    }
}
```

> **Jenkins Pipeline**ï¼š
>
> - **Jenkins Pipeline** æ˜¯ Jenkins æä¾›çš„ä¸€ç§è‡ªåŠ¨åŒ–æž„å»ºå’Œéƒ¨ç½²çš„æ–¹å¼ï¼Œæ—¨åœ¨å¸®åŠ©å¼€å‘å›¢é˜Ÿå®šä¹‰ã€æ‰§è¡Œã€è‡ªåŠ¨åŒ–æ•´ä¸ª CI/CD æµç¨‹ã€‚
> - å®ƒä½¿ç”¨ **Jenkinsfile** æ¥å®šä¹‰å·¥ä½œæµï¼Œæ”¯æŒæ›´å¤æ‚çš„ä»»åŠ¡ï¼Œä¾‹å¦‚æž„å»ºã€æµ‹è¯•ã€éƒ¨ç½²ã€é›†æˆç­‰ï¼Œå¹¶ä¸”æ”¯æŒé˜¶æ®µæ€§æŽ§åˆ¶ã€å¹¶è¡Œæ‰§è¡Œã€æ¡ä»¶æ‰§è¡Œç­‰ç‰¹æ€§ã€‚
>
> **ä¸€èˆ¬çš„æž„å»º**ï¼š
>
> - **ä¸€èˆ¬çš„æž„å»º** é€šå¸¸æ˜¯é€šè¿‡ç®€å•çš„ **Jenkins æž„å»ºä»»åŠ¡** æ¥å®žçŽ°çš„ã€‚å®ƒé€šå¸¸ç”±ä¸€ç³»åˆ—é¢„å®šä¹‰çš„æ­¥éª¤ç»„æˆï¼Œç›´æŽ¥åœ¨ Jenkins UI ä¸­é…ç½®ï¼Œä¸ä¸€å®šä¾èµ–äºŽè„šæœ¬æˆ–ä»£ç æ–‡ä»¶ï¼ˆä¾‹å¦‚ `Jenkinsfile`ï¼‰ã€‚
> - è¿™ç§æ–¹å¼é€‚ç”¨äºŽç®€å•çš„æž„å»ºæµç¨‹ï¼Œé€šå¸¸ç”¨äºŽæ²¡æœ‰å¤æ‚æµç¨‹æŽ§åˆ¶çš„åœºæ™¯ã€‚

=>Pipeline åœ¨ ä»»åŠ¡å¹¶è¡Œï¼Œå¯è§†åŒ–(ä¸ŽBlue Ocean UIç»“åˆ)ï¼Œç‰ˆæœ¬æŽ§åˆ¶ç­‰æ–¹é¢æ›´æœ‰ä¼˜åŠ¿

è„šæœ¬å¯ä»¥ç”±UIé…ç½®ä¿¡æ¯è‡ªåŠ¨ç”Ÿæˆã€‚ è¿˜æœ‰å£°æ˜Žå¼æµæ°´çº¿ä¸Žè„šæœ¬å¼æµæ°´çº¿çš„åŒºåˆ«ï¼ŒåŽè€…ç”¨ Groovy è„šæœ¬æ¥ç¼–å†™ï¼Œç»“æž„ä¸Šå¯ä»¥æ›´è‡ªç”±

Gitä¸Šæœ‰å¤šåˆ†æ”¯ï¼Œå¯ä»¥ä¸ºå¤šä¸ªåˆ†æ”¯ä¸Šä¼ ä¸åŒçš„ Jenkinsfileï¼Œè¾¾æˆå¯ä»¥ä¸ºå¤šåˆ†æ”¯å¹¶è¡Œæž„å»ºçš„æ•ˆæžœ 

## Github Action 20241231

CIä¸­è¿˜å¯ä»¥æœ‰ ä»£ç é£Žæ ¼ check

åœ¨ä»£ç é‡Œ .github/workflows/æ–‡ä»¶å¤¹ä¸‹åˆ›å»ºä¸€ä¸ª ymlæ–‡ä»¶å°±è¡Œ

```yaml
#.github/workflows/ci.yml
name: C Project CI

on:
  # å½“æŽ¨é€æˆ–åˆ›å»º PR åˆ° main åˆ†æ”¯æ—¶è§¦å‘å·¥ä½œæµ
  push:
    branches:
      - main
  pull_request:
    branches:
      - main

jobs:
  build-and-check:
    runs-on: ubuntu-latest # ä½¿ç”¨ Ubuntu æœ€æ–°ç‰ˆæœ¬ä½œä¸ºè¿è¡ŒçŽ¯å¢ƒ

    steps:
      # æ­¥éª¤ 1: æ£€å‡ºä»£ç ä»“åº“
      - name: Checkout code
        uses: actions/checkout@v3

      # æ­¥éª¤ 2: å®‰è£…å¿…è¦å·¥å…·ï¼ŒåŒ…æ‹¬æž„å»ºå·¥å…·å’Œ MISRA æ£€æŸ¥å·¥å…· (Cppcheck)
      - name: Install build tools and MISRA check tool
        run: sudo apt-get update && sudo apt-get install -y build-essential cppcheck

      # æ­¥éª¤ 3: ç¼–è¯‘é¡¹ç›®
      - name: Build project
        run: make

      # æ­¥éª¤ 4: è¿è¡Œæµ‹è¯•
      - name: Run tests
        run: ./build/project

      # æ­¥éª¤ 5: æ‰§è¡Œ MISRA æ£€æŸ¥
      - name: Run MISRA check
        run: cppcheck --enable=all --std=c99 --suppress=missingIncludeSystem --error-exitcode=1 src/ > cppcheck-report.txt

      # æ­¥éª¤ 6: ä¸Šä¼  MISRA æ£€æŸ¥æŠ¥å‘Š
      - name: Upload MISRA report
        uses: actions/upload-artifact@v3
        with:
          name: cppcheck-report
          path: cppcheck-report.txt
```



**GitHub Actions** æä¾›è‡ªå·±çš„ **äº‘æœåŠ¡å™¨**ï¼ˆä¹Ÿç§°ä¸º **runner**ï¼‰æ¥è¿è¡Œå·¥ä½œæµä»»åŠ¡ã€‚

(å¦‚æžœéœ€è¦æ›´é«˜çš„çµæ´»æ€§ï¼Œå¯ä»¥è®¾ç½®è‡ªæ‰˜ç®¡æœåŠ¡å™¨ï¼ˆå¦‚ä¼ä¸šå†…éƒ¨æœåŠ¡å™¨æˆ–ä¸“ç”¨äº‘å®žä¾‹ï¼‰)

## GitLab CICD 20250120

> ## **1. GitLab CI/CD çš„æ ¸å¿ƒæ¦‚å¿µ**
>
> ### **1.1. GitLab Runner**
>
> GitLab CI/CD ä¾èµ– **GitLab Runner** æ¥æ‰§è¡Œ CI/CD ä»»åŠ¡ã€‚Runner æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„è¿›ç¨‹ï¼Œå¯ä»¥è¿è¡Œåœ¨æœ¬åœ°æœºå™¨ã€æœåŠ¡å™¨æˆ– Kubernetes é›†ç¾¤ä¸Šï¼Œæ”¯æŒå¤šç§æ‰§è¡ŒçŽ¯å¢ƒï¼ˆDockerã€Shellã€Kubernetes ç­‰ï¼‰ã€‚
>
> ### **1.2. `.gitlab-ci.yml` é…ç½®æ–‡ä»¶**
>
> æ‰€æœ‰ CI/CD æµç¨‹éƒ½ç”± `.gitlab-ci.yml` æ–‡ä»¶æŽ§åˆ¶ï¼Œå­˜æ”¾åœ¨é¡¹ç›®æ ¹ç›®å½•ã€‚å®ƒç”¨äºŽå®šä¹‰ **pipeline**ï¼ˆæµæ°´çº¿ï¼‰ã€**stages**ï¼ˆé˜¶æ®µï¼‰ã€**jobs**ï¼ˆä½œä¸šï¼‰ç­‰å†…å®¹ã€‚
>
> **ç¤ºä¾‹ï¼š**
>
> ```yaml
> yamlCopyEditstages:
>   - build
>   - test
>   - deploy
> 
> build-job:
>   stage: build
>   script:
>     - echo "Building project..."
>     - make build
> 
> test-job:
>   stage: test
>   script:
>     - echo "Running tests..."
>     - make test
> 
> deploy-job:
>   stage: deploy
>   script:
>     - echo "Deploying..."
>     - make deploy
>   only:
>     - main
> ```
>
> - **stages**ï¼šå®šä¹‰æµæ°´çº¿çš„ä¸åŒé˜¶æ®µï¼ˆå¦‚ `build`ã€`test`ã€`deploy`ï¼‰ã€‚
> - **jobs**ï¼šæ¯ä¸ª `job` ä»£è¡¨ä¸€ä¸ªä»»åŠ¡ï¼Œå±žäºŽæŸä¸ª `stage`ï¼Œå¯ä»¥æ‰§è¡Œ shell å‘½ä»¤ã€‚
> - **only**ï¼šæŒ‡å®šåœ¨å“ªäº›åˆ†æ”¯è§¦å‘æ­¤ä»»åŠ¡ï¼ˆå¦‚ `only: - main` è¡¨ç¤ºä»…åœ¨ `main` åˆ†æ”¯è§¦å‘ï¼‰ã€‚
>
> ------
>
> ## **2. GitLab CI/CD å·¥ä½œæµç¨‹**
>
> GitLab CI/CD é€šè¿‡ä»¥ä¸‹æµç¨‹æ¥è‡ªåŠ¨åŒ–å¼€å‘å’Œéƒ¨ç½²ï¼š
>
> 1. **å¼€å‘äººå‘˜æäº¤ä»£ç ** åˆ° GitLab ä»“åº“ã€‚
> 2. **GitLab è‡ªåŠ¨è§¦å‘ Pipeline**ï¼Œè¯»å– `.gitlab-ci.yml` è¿›è¡Œæž„å»ºã€æµ‹è¯•å’Œéƒ¨ç½²ã€‚
> 3. **GitLab Runner è¿è¡Œ CI/CD ä½œä¸š**ï¼Œæ‰§è¡Œ `build`ã€`test`ã€`deploy` ç­‰ä»»åŠ¡ã€‚
> 4. **æµ‹è¯•é€šè¿‡åŽ**ï¼Œå¯ä»¥è‡ªåŠ¨æˆ–æ‰‹åŠ¨éƒ¨ç½²åˆ°æµ‹è¯•/ç”Ÿäº§çŽ¯å¢ƒã€‚
> 5. **GitLab æä¾› CI/CD å¯è§†åŒ–ç•Œé¢**ï¼Œå¯ä»¥æŸ¥çœ‹ Pipeline è¿è¡ŒçŠ¶æ€ã€æ—¥å¿—ç­‰ã€‚

 =>åœ¨GitLabç•Œé¢ä¸­ç‚¹å‡»settingå°±å¯ä»¥çœ‹åˆ°Runneræ äº†ï¼Œå¯ä»¥è®¾ç½®ä¸€ä¸ªRunnerï¼Œå¹¶ä¸ºå…¶è®¾å®štarget serverçš„IPï¼Œæ‰€ä»¥ç•Œé¢ä¸­çš„Runnerå¹¶ä¸æ˜¯æ­£çœŸçš„è¿è¡Œç¨‹åºï¼Œåªæ˜¯ä¸€ä¸ªæŒ‡å‘æ€§çš„è®¾ç½®ï¼Œæœ€ç»ˆè¦åŽ»target serveré‡Œå®‰è£…è¿™ä¸ªrunneræ‰èƒ½è¿è¡Œ

> ## **1. æœåŠ¡å™¨ä¸Šçš„åŸºæœ¬é…ç½®**
>
> å‡è®¾ä½ è¦åœ¨æœåŠ¡å™¨ `192.168.1.100` ä¸Šè¿è¡Œ GitLab Runnerï¼Œéœ€è¦è¿›è¡Œä»¥ä¸‹è®¾ç½®ï¼š
>
> ### **1.1. å®‰è£… GitLab Runner**
>
> å¦‚æžœè¯¥æœåŠ¡å™¨å°šæœªå®‰è£… GitLab Runnerï¼Œéœ€è¦å…ˆå®‰è£…ï¼š
>
> ```
> bashCopyEdit# æ·»åŠ  GitLab Runner ä»“åº“
> curl -L https://packages.gitlab.com/install/repositories/runner/gitlab-runner/script.deb.sh | sudo bash
> 
> # å®‰è£… GitLab Runner
> sudo apt-get install gitlab-runner -y   # Ubuntu/Debian
> # sudo yum install gitlab-runner -y     # CentOS/RHEL
> ```

=>é…ç½®release/gitlab-runner/config/config.tomlï¼Œæ¯”å¦‚

```toml
[[runners]]
  name = "docker-runner"  # Runner çš„åç§°ï¼Œåœ¨ GitLab CI/CD ç•Œé¢ä¸­å¯è§
  url = "https://gitlab.example.com/"  # GitLab æœåŠ¡å™¨åœ°å€
  token = "your-runner-token"  # è¯¥ Runner è¿žæŽ¥åˆ° GitLab æ‰€éœ€çš„ Token
  executor = "docker"  # è®¾å®š Runner ä»¥ Docker æ¨¡å¼æ‰§è¡Œ CI/CD ä»»åŠ¡

  # è‡ªå®šä¹‰æž„å»ºç›®å½•ï¼ˆé»˜è®¤æƒ…å†µä¸‹ï¼ŒRunner åœ¨ `/builds/` ç›®å½•æ‰§è¡Œ CI ä»»åŠ¡ï¼‰
  [runners.custom_build_dir]
  # å¦‚æžœå¯ç”¨ `custom_build_dir`, å¯ä»¥æŒ‡å®šä¸åŒçš„è·¯å¾„æ¥å­˜æ”¾ CI/CD ä»»åŠ¡çš„æž„å»ºç›®å½•
  # ä¾‹å¦‚:
  # enabled = true
  # build_dir = "/my/custom/path"
  # ä½†ä¸€èˆ¬æƒ…å†µä¸‹ä¿æŒé»˜è®¤å³å¯ï¼Œä¸éœ€è¦ä¿®æ”¹
  

  [runners.docker]
    tls_verify = false  # æ˜¯å¦å¼€å¯ TLS éªŒè¯ï¼ˆä¸€èˆ¬ç”¨äºŽç§æœ‰ Docker Registryï¼Œé»˜è®¤ falseï¼‰
    image = "python:3.9"  # è¿è¡Œ CI/CD ä»»åŠ¡æ—¶é»˜è®¤ä½¿ç”¨çš„ Docker é•œåƒ
    privileged = true  # å…è®¸ `privileged` æ¨¡å¼ï¼ˆè‹¥éœ€è¦åœ¨ CI/CD ä»»åŠ¡ä¸­è¿è¡Œ Docker in Dockerï¼Œå¿…é¡»è®¾ä¸º trueï¼‰
    disable_entrypoint_overwrite = false  # å…è®¸è¦†ç›– Docker é•œåƒçš„ Entrypointï¼Œé€šå¸¸ä¿æŒé»˜è®¤å³å¯
    oom_kill_disable = false  # æ˜¯å¦ç¦ç”¨ OOMï¼ˆå†…å­˜ä¸è¶³ï¼‰è‡ªåŠ¨ç»ˆæ­¢ï¼Œé»˜è®¤ falseï¼Œå»ºè®®ä¸ä¿®æ”¹
    disable_cache = false  # æ˜¯å¦ç¦ç”¨æž„å»ºç¼“å­˜ï¼Œé»˜è®¤ falseï¼ˆå¼€å¯ç¼“å­˜èƒ½åŠ é€Ÿä»»åŠ¡ï¼‰
    
    # æŒ‚è½½å·ï¼ˆvolumesï¼‰
    volumes = [
      "/cache",  # GitLab Runner çš„ç¼“å­˜ç›®å½•ï¼Œä¿å­˜æž„å»ºä¸­é—´ç»“æžœï¼ŒåŠ å¿«åŽç»­ä»»åŠ¡
      "/var/run/docker.sock:/var/run/docker.sock"  # å…è®¸ Runner è®¿é—®å®¿ä¸»æœº Dockerï¼ˆç”¨äºŽ `docker build`ï¼‰
    ]
    
    shm_size = "256m"  # å…±äº«å†…å­˜å¤§å°ï¼Œé¿å…æŸäº›ç¨‹åºå› å…±äº«å†…å­˜ä¸è¶³å´©æºƒï¼ˆé»˜è®¤ 64MBï¼Œå»ºè®®è®¾ä¸ºè‡³å°‘ 256MBï¼‰

  [runners.cache]  # ç¼“å­˜é…ç½®
    [runners.cache.s3]  # S3 è¿œç¨‹ç¼“å­˜ï¼ˆå¦‚æžœä½¿ç”¨ AWS S3 ä½œä¸ºæž„å»ºç¼“å­˜ï¼Œå¯ä»¥åœ¨è¿™é‡Œé…ç½®ï¼‰
    [runners.cache.gcs]  # Google Cloud Storage ç¼“å­˜ï¼ˆå¦‚æžœä½¿ç”¨ GCS å­˜å‚¨ CI ä»»åŠ¡çš„ç¼“å­˜ï¼Œå¯ä»¥é…ç½®æ­¤é¡¹ï¼‰

```

=>ä¸Šé¢è¿™ä¸ªtokenå°±æ˜¯è¦åŽ»GitLabç•Œé¢æ³¨å†Œçš„Runneré‡ŒåŽ»å¯»æ‰¾ï¼Œè¿™æ ·çš„è¯ä¸¤è€…å°±è”ç³»èµ·æ¥äº†

# Kubernetes

## å°šç¡…è°·Kubernetesæ•™ç¨‹

[Link](https://www.bilibili.com/video/BV1w4411y7Go/?p=2&spm_id_from=pageDriver&vd_source=6fc477a8e79179a3fd30bed2e2ba5fbe)

2015å¹´Googleç”¨Goè¯­è¨€å¼€å‘äº†Kubernetesæ¡†æž¶

Kuberneteså±žäºŽPaaS

è½»é‡çº§ï¼Œå¼€æºï¼Œå¼¹æ€§æ”¶ç¼©ï¼Œè´Ÿè½½å‡è¡¡

Podæ˜¯Kubernetesç®¡ç†ä¸Šçš„æœ€å°å•ä½ï¼Œç®¡ç†ä¸€å®šæ•°é‡çš„Docker



### çŸ¥è¯†å›¾è°± 20240920

1. ä»‹ç»è¯´æ˜Žï¼šKubernetesçš„å‰ç”Ÿä»Šä¸–
2. åŸºç¡€æ¦‚å¿µï¼šä»€ä¹ˆæ˜¯Pod æŽ§åˆ¶å™¨ç±»åž‹ ç½‘ç»œé€šè®¯æ¨¡å¼
3. æž„å»ºK8Sé›†ç¾¤
4. èµ„æºæ¸…å•ï¼š èµ„æºæ¸…å•çš„è¯­æ³• ç¼–å†™Pod æŽŒæ¡Podçš„ç”Ÿå‘½å‘¨æœŸ(**important**)
5. PodæŽ§åˆ¶å™¨ï¼šæŽŒæ¡å„ç§æŽ§åˆ¶å™¨çš„ç‰¹ç‚¹ä»¥åŠä½¿ç”¨æ–¹å¼å®šä¹‰
6. ServiceåŽŸç†ï¼šç»™é¡¾å®¢ä¸€ä¸ªè®¿é—®æŽ¥å£ï¼ŒæŽŒæ¡ServiceåŽŸç†åŠå…¶æž„æž¶æ–¹å¼
7. å­˜å‚¨ï¼šæŽŒæ¡å¤šç§å­˜å‚¨ç±»åž‹çš„ç‰¹ç‚¹
8. è°ƒåº¦å™¨ï¼šèƒ½å¤Ÿæ ¹æ®è¦æ±‚æŠŠPodå®šä¹‰åˆ°æƒ³è¦çš„èŠ‚ç‚¹è¿è¡Œ
9. é›†ç¾¤å®‰å…¨æœºåˆ¶ï¼šé›†ç¾¤çš„è®¤è¯ï¼Œé‰´æƒï¼Œè®¿é—®æŽ§åˆ¶ åŽŸç†åŠå…¶æµç¨‹
10. HELMï¼šç±»ä¼¼Linuxä¸­yumï¼Œåªæ˜¯ä¸å®‰è£…åŒ…è€Œæ˜¯æŸä¸ªåŠŸèƒ½çš„é›†ç¾¤
11. è¿ç»´ï¼šä¿®æ”¹Kuberadm è¾¾åˆ°è¯ä¹¦å¯ç”¨æœŸé™ä¸º10å¹´ï¼Œæž„å»ºé«˜å¯ç”¨Kubernetes

### ç»„ä»¶è¯´æ˜Ž 20241102

å‰èº« Borg ï¼š paxosæ˜¯åˆ†å¸ƒå¼ä¸€è‡´æ€§ç®—æ³•

K8Sæž¶æž„ï¼š

master èŠ‚ç‚¹ï¼šscheduler,replication controller,api server,kubectl,etcd =>è¿™äº›æ¨¡å—å…¨éƒ¨åœ¨åŒä¸€ä¸ªç‰©ç†æœåŠ¡å™¨ä¸Š

kubectlï¼š å‘½ä»¤è¡Œ

api serverï¼š master èŠ‚ç‚¹çš„ä¸­å¿ƒç»„ä»¶ï¼Œæ‰€æœ‰æœåŠ¡è®¿é—®çš„ç»Ÿä¸€å…¥å£

replication controller: ç»´æŒå‰¯æœ¬æœŸæœ›æ•°ç›®

scheduler:è´Ÿè´£ç»™Dockerä»‹ç»ä»»åŠ¡ï¼Œé€‰æ‹©åˆé€‚çš„èŠ‚ç‚¹è¿›è¡Œåˆ†é…ä»»åŠ¡

etcd ï¼š åˆ†å¸ƒå¼é”®å€¼å­˜å‚¨æ•°æ®åº“ï¼Œä¸ºæ•´ä¸ªé›†ç¾¤å­˜å‚¨ä¸€äº›å…³é”®æ•°æ®(æŒä¹…åŒ–)ã€‚å¯ä»¥å€ŸåŠ©etcdè¿›è¡Œæ•°æ®æ¢å¤ï¼Œé‡‡ç”¨HTTPåè®®



node èŠ‚ç‚¹ï¼škubeletï¼Œ kube proxy, node(å¯ä»¥çœ‹æˆDocker(æœ€ä¸»æµ) )

Kubeletï¼šç›´æŽ¥è·Ÿå®¹å™¨å¼•æ“Žäº¤äº’å®žçŽ°å®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†

Kube proxy: è´Ÿè´£å†™å…¥è§„åˆ™è‡³ IPTABLES, IPVSå®žçŽ°æœåŠ¡æ˜ å°„ç®¡ç†



å…¶ä»–æ’ä»¶ï¼šCoreDNSï¼ŒDashboard(ç»™K8Sé›†ç¾¤æä¾›B/Sæž¶æž„)...

### Podæ¦‚å¿µ

åœ¨åŒä¸€ä¸ªPodä¸­ è®¸å¤šå®¹å™¨ å…±äº«ç½‘ç»œä¸Žå­˜å‚¨å·ï¼Œäº’ç›¸ä¹‹é—´æ— éœ€é…ç½®IPç›´æŽ¥é€šä¿¡

> åœ¨ Kubernetesï¼ˆK8sï¼‰ä¸­ï¼ŒPod æ˜¯ä¸€ä¸ªåŸºæœ¬çš„è°ƒåº¦å•ä½ï¼Œç”¨äºŽéƒ¨ç½²å’Œç®¡ç†å®¹å™¨åŒ–åº”ç”¨ã€‚Pod çš„æ¦‚å¿µå¯ä»¥ç†è§£ä¸ºä¸€ç»„å…±äº«èµ„æºå’Œç½‘ç»œçš„å®¹å™¨ã€‚ä»¥ä¸‹æ˜¯ Pod çš„ä¸€äº›å…³é”®ç‰¹ç‚¹å’Œæ¦‚å¿µï¼š
>
> ### 1. **å•ä¸ªæˆ–å¤šä¸ªå®¹å™¨**
>
> - ä¸€ä¸ª Pod å¯ä»¥åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªå®¹å™¨ï¼Œè¿™äº›å®¹å™¨å…±äº«ç›¸åŒçš„ç½‘ç»œå‘½åç©ºé—´å’Œå­˜å‚¨å·ã€‚å®ƒä»¬é€šå¸¸ä¸€èµ·å·¥ä½œï¼Œä»¥å®žçŽ°ç‰¹å®šçš„åŠŸèƒ½ã€‚
>
> ### 2. **å…±äº«ç½‘ç»œ**
>
> - æ‰€æœ‰åœ¨åŒä¸€ Pod ä¸­çš„å®¹å™¨å…±äº«ä¸€ä¸ª IP åœ°å€å’Œç«¯å£ç©ºé—´ã€‚è¿™æ„å‘³ç€å®ƒä»¬å¯ä»¥é€šè¿‡ `localhost` ç›´æŽ¥äº’ç›¸é€šä¿¡ï¼Œè€Œä¸éœ€è¦é€šè¿‡ç½‘ç»œè¿›è¡Œè·¯ç”±ã€‚
>
> ### 3. **å­˜å‚¨å·**
>
> - Pod å¯ä»¥æŒ‚è½½ä¸€ä¸ªæˆ–å¤šä¸ªå­˜å‚¨å·ï¼Œä»¥ä¾¿å®¹å™¨å¯ä»¥å…±äº«æ•°æ®ã€‚è¿™ä½¿å¾—æ•°æ®åœ¨å®¹å™¨é‡å¯æˆ–æ›¿æ¢æ—¶å¾—ä»¥æŒä¹…åŒ–ã€‚
>
> ### 4. **ç”Ÿå‘½å‘¨æœŸç®¡ç†**
>
> - Kubernetes ç®¡ç† Pod çš„ç”Ÿå‘½å‘¨æœŸï¼ŒåŒ…æ‹¬åˆ›å»ºã€è°ƒåº¦ã€å¥åº·æ£€æŸ¥ã€é‡å¯ç­‰ã€‚Kubernetes ä¼šæ ¹æ®é…ç½®è‡ªåŠ¨å¤„ç† Pod çš„çŠ¶æ€ã€‚
>
> ### 5. **è´Ÿè½½å‡è¡¡**
>
> - åœ¨ä½¿ç”¨æœåŠ¡ï¼ˆServiceï¼‰æ—¶ï¼ŒKubernetes å¯ä»¥è‡ªåŠ¨ä¸º Pod æä¾›è´Ÿè½½å‡è¡¡ï¼Œä½¿æµé‡å‡åŒ€åˆ†é…åˆ°å¤šä¸ª Pod å®žä¾‹ä¸Šã€‚
>
> ### 6. **è°ƒåº¦**
>
> - Kubernetes çš„è°ƒåº¦å™¨è´Ÿè´£å°† Pod åˆ†é…åˆ°åˆé€‚çš„èŠ‚ç‚¹ä¸Šï¼Œä»¥ç¡®ä¿èµ„æºçš„é«˜æ•ˆåˆ©ç”¨å’ŒæœåŠ¡çš„å¯ç”¨æ€§ã€‚
>
> ### 7. **æ ‡ç­¾å’Œé€‰æ‹©å™¨**
>
> - Pod å¯ä»¥ä½¿ç”¨æ ‡ç­¾ï¼ˆLabelsï¼‰æ¥æ ‡è¯†å’Œç»„ç»‡ã€‚é€šè¿‡é€‰æ‹©å™¨ï¼ˆSelectorsï¼‰ï¼Œå¯ä»¥æ–¹ä¾¿åœ°ç®¡ç†å’Œé€‰æ‹©ç‰¹å®šçš„ Pod è¿›è¡Œæ“ä½œã€‚
>
> ### 8. **ç”¨é€”**
>
> - Pod é€šå¸¸ç”¨äºŽè¿è¡Œå¾®æœåŠ¡ã€ä»»åŠ¡é˜Ÿåˆ—ã€æ•°æ®å¤„ç†ä½œä¸šç­‰ã€‚å®ƒä»¬æ˜¯æž„å»ºåº”ç”¨ç¨‹åºçš„åŸºæœ¬å•å…ƒï¼Œå…è®¸å°†å¤šä¸ªç›¸å…³å®¹å™¨ç»„åˆåœ¨ä¸€èµ·ã€‚
>
> ### æ€»ç»“
>
> Pod æ˜¯ Kubernetes çš„æ ¸å¿ƒæ¦‚å¿µä¹‹ä¸€ï¼Œæä¾›äº†ä¸€ç§çµæ´»çš„æ–¹å¼æ¥ç®¡ç†å’Œåè°ƒå¤šä¸ªå®¹å™¨çš„è¿è¡Œã€‚ç†è§£ Pod çš„å·¥ä½œåŽŸç†æœ‰åŠ©äºŽæ›´å¥½åœ°åˆ©ç”¨ Kubernetes æ¥éƒ¨ç½²å’Œç®¡ç†å®¹å™¨åŒ–åº”ç”¨ã€‚

=> æ¯ä¸ªPod ä¸€ä¸ªIPï¼ŒPodå†…éƒ¨çš„å®¹å™¨é€šä¿¡é€šè¿‡ localhost+ç«¯å£é€šä¿¡

> å‡è®¾ä¸€ä¸ª Pod å†…æœ‰ä¸¤ä¸ªå®¹å™¨ï¼š`web` å’Œ `app`ï¼Œ`web` å®¹å™¨éœ€è¦è°ƒç”¨ `app` å®¹å™¨æä¾›çš„æœåŠ¡ã€‚å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼è¿›è¡Œé€šä¿¡ï¼š
>
> 1. **åœ¨ `app` å®¹å™¨ä¸­å¯åŠ¨ä¸€ä¸ªæœåŠ¡**ï¼Œç›‘å¬æŸä¸ªç«¯å£ï¼ˆä¾‹å¦‚ 8080ï¼‰ã€‚
> 2. **åœ¨ `web` å®¹å™¨ä¸­é€šè¿‡ `localhost:8080`** å‘é€è¯·æ±‚ï¼š
>
> ```shell
> #localhost å°±æ˜¯ 127.0.0.1
> curl http://localhost:8080
> ```

### é›†ç¾¤å®‰è£…

> ### **é›†ç¾¤ï¼ˆClusterï¼‰**
>
> - **å®šä¹‰**ï¼šKubernetes é›†ç¾¤æ˜¯ç”±ä¸€ç»„è®¡ç®—èµ„æºï¼ˆèŠ‚ç‚¹ï¼‰ç»„æˆçš„é›†åˆï¼Œè¿™äº›èŠ‚ç‚¹å¯ä»¥æ˜¯ç‰©ç†æœåŠ¡å™¨æˆ–è™šæ‹Ÿæœºã€‚é›†ç¾¤è¿è¡Œ Kubernetes æŽ§åˆ¶å¹³é¢å’Œåº”ç”¨ç¨‹åºçš„å·¥ä½œè´Ÿè½½ï¼ˆå³ Podï¼‰ã€‚
>
> - ç»„æˆ
>
>   ï¼š
>
>   - **æŽ§åˆ¶å¹³é¢**ï¼šè´Ÿè´£ç®¡ç†é›†ç¾¤çŠ¶æ€ï¼Œè°ƒåº¦ Podï¼Œå¤„ç† API è¯·æ±‚ç­‰ã€‚ä¸»è¦ç»„ä»¶åŒ…æ‹¬ API Serverã€etcdã€Controller Manager å’Œ Schedulerã€‚
>   - **å·¥ä½œèŠ‚ç‚¹ï¼ˆWorker Nodesï¼‰**ï¼šè¿è¡Œå®žé™…çš„å®¹å™¨åŒ–åº”ç”¨ï¼ˆPodï¼‰ã€‚æ¯ä¸ªèŠ‚ç‚¹éƒ½åŒ…å«è¿è¡Œå®¹å™¨çš„å¿…è¦ç»„ä»¶ï¼Œå¦‚ kubeletã€kube-proxy å’Œå®¹å™¨è¿è¡Œæ—¶ï¼ˆå¦‚ Docker æˆ– containerdï¼‰ã€‚

=>Clusteråˆ†ä¸ºæŽ§åˆ¶å¹³é¢å’Œå·¥ä½œè´Ÿè½½ï¼ŒåŽè€…çš„ä¸»ä½“å°±æ˜¯Pod

k8sé›†ç¾¤ä¸¾ä¾‹: master01 node01 node02 Router Harbour

ç”¨VMWareåˆ›å»º5ä¸ªè™šæ‹Ÿæœº

åœ¨master01é‡Œè¿›è¡Œå¦‚ä¸‹æ“ä½œï¼š

1. é¦–å…ˆæŒ‡å®šä¸»æœºåï¼Œç›´æŽ¥æ”¹hostsæ–‡ä»¶å°±è¡Œï¼Œå®‰è£…ä¾èµ–åŒ…
2. è®¾ç½®é˜²ç«å¢™ä¸ºIptableså¹¶è®¾ç½®ç©ºè§„åˆ™ï¼Œå…³é—­SE Linuxï¼Œé˜²æ­¢å…¶å½±å“k8sçš„è¿è¡Œæ•ˆçŽ‡
3. è°ƒæ•´å†…æ ¸å‚æ•°ï¼Œå¯¹äºŽK8S. å…³é—­ç³»ç»Ÿä¸éœ€è¦çš„æœåŠ¡ï¼Œé…ç½®æ—¥å¿—æœåŠ¡
4. kube-proxy å¼€å¯ipvsçš„å‰ç½®æ¡ä»¶
5. å®‰è£…Docker è½¯ä»¶
6. å®‰è£…kubeadm ï¼ˆ`kubeadm` æ˜¯ Kubernetes æä¾›çš„ä¸€ä¸ªå·¥å…·ï¼Œç”¨äºŽç®€åŒ– Kubernetes é›†ç¾¤çš„å®‰è£…å’Œç®¡ç†ã€‚ï¼‰
7. åˆå§‹åŒ–ä¸»èŠ‚ç‚¹, åŠ å…¥å·¥ä½œèŠ‚ç‚¹ï¼Œéƒ¨ç½²ç½‘ç»œ

å†æž„å»ºç§æœ‰ä»“åº“Harbour

> Harbor æä¾›äº†ä¸€ä¸ªé›†ä¸­å¼çš„åœ°æ–¹æ¥å­˜å‚¨å’Œç®¡ç† Docker å®¹å™¨é•œåƒï¼Œä½¿å¾—åœ¨ Kubernetes ä¸­éƒ¨ç½²å’Œæ›´æ–°åº”ç”¨æ—¶å¯ä»¥æ›´åŠ æ–¹ä¾¿ã€‚æŒå¯¹é•œåƒè¿›è¡Œç‰ˆæœ¬ç®¡ç†ï¼Œå¯ä»¥è½»æ¾å›žæ»šåˆ°ä¹‹å‰çš„ç‰ˆæœ¬ï¼Œæé«˜åº”ç”¨çš„å¯ç»´æŠ¤æ€§ã€‚å¯ä»¥æ–¹ä¾¿åœ°ä¸Ž CI/CD å·¥å…·é“¾ï¼ˆå¦‚ Jenkinsã€GitLab CI ç­‰ï¼‰é›†æˆï¼Œå®žçŽ°æŒç»­é›†æˆå’ŒæŒç»­éƒ¨ç½²çš„è‡ªåŠ¨åŒ–æµç¨‹ã€‚Harbor æä¾›äº†ä¸€ä¸ªç”¨æˆ·å‹å¥½çš„ Web ç•Œé¢.

### èµ„æºæ¸…å•(manifest) 20241106

> Kubernetesï¼ˆç®€ç§°K8sï¼‰çš„èµ„æºæ¸…å•ï¼ˆmanifestï¼‰æ˜¯ç”¨äºŽå®šä¹‰å’Œæè¿°Kubernetesé›†ç¾¤ä¸­èµ„æºå¯¹è±¡çš„é…ç½®æ–‡ä»¶ï¼Œé€šå¸¸æ˜¯ä¸€ä¸ªæˆ–å¤šä¸ªYAMLæˆ–JSONæ–‡ä»¶ã€‚è¿™äº›èµ„æºå¯¹è±¡å¯ä»¥åŒ…æ‹¬Podã€Deploymentã€Serviceã€ConfigMapã€Secretç­‰ï¼Œå‡ ä¹Žæ‰€æœ‰åœ¨K8sä¸­è¿è¡Œçš„åº”ç”¨å’ŒæœåŠ¡éƒ½éœ€è¦åœ¨èµ„æºæ¸…å•ä¸­è¿›è¡Œæè¿°ã€‚

#### YAMLçš„åŸºæœ¬è¯­æ³•

YAMLé‡‡ç”¨ç¼©è¿›è¡¨ç¤ºå±‚çº§å…³ç³»ï¼Œ**é€šå¸¸ä½¿ç”¨ç©ºæ ¼**ï¼ˆè€Œä¸æ˜¯Tabï¼‰è¿›è¡Œç¼©è¿›ã€‚æ¯ä¸€çº§ç¼©è¿›é€šå¸¸ä¸ºä¸¤ä¸ªç©ºæ ¼ã€‚

æ”¯æŒçš„æ•°æ®ç»“æž„ï¼šå¯¹è±¡(é”®å€¼å¯¹)ï¼Œæ•°ç»„ï¼Œçº¯é‡(scalars)->ä¸å¯å†åˆ†å‰²çš„é‡

> ### YAMLçš„åŸºæœ¬è¯­æ³•
>
> YAMLçš„æ ¸å¿ƒåŽŸåˆ™æ˜¯ç®€å•ã€ç›´è§‚å’Œæ˜“äºŽç†è§£ï¼Œä¸‹é¢æ˜¯ä¸€äº›åŸºæœ¬è¯­æ³•è§„åˆ™å’Œç¤ºä¾‹ï¼š
>
> #### 1. **åŸºæœ¬ç»“æž„**
>
> YAMLé‡‡ç”¨ç¼©è¿›è¡¨ç¤ºå±‚çº§å…³ç³»ï¼Œé€šå¸¸ä½¿ç”¨ç©ºæ ¼ï¼ˆè€Œä¸æ˜¯Tabï¼‰è¿›è¡Œç¼©è¿›ã€‚æ¯ä¸€çº§ç¼©è¿›é€šå¸¸ä¸ºä¸¤ä¸ªç©ºæ ¼ã€‚
>
> ```yaml
> key: value
> ```
>
> åœ¨YAMLä¸­ï¼Œæ•°æ®ç”±é”®ï¼ˆkeyï¼‰å’Œå€¼ï¼ˆvalueï¼‰ç»„æˆã€‚é”®å€¼ä¹‹é—´ä½¿ç”¨å†’å·`:`åˆ†éš”ã€‚
>
> #### 2. **é”®å€¼å¯¹**
>
> æœ€ç®€å•çš„å½¢å¼æ˜¯é”®å€¼å¯¹ï¼Œæ¯ä¸ªé”®åŽè·Ÿä¸€ä¸ªå†’å·å’Œä¸€ä¸ªå€¼ï¼š
>
> ```yaml
> codename: Alice
> age: 30
> ```
>
> #### 3. **å¤šè¡Œå­—ç¬¦ä¸²**
>
> YAMLå…è®¸ç”¨`|`å’Œ`>`æ¥è¡¨ç¤ºå¤šè¡Œå­—ç¬¦ä¸²ï¼Œ`|`ä¿æŒæ¢è¡Œï¼Œè€Œ`>`å°†æ¢è¡Œç¬¦è½¬æ¢ä¸ºç©ºæ ¼ã€‚
>
> ```yaml
> address: |
>   123 Main St
>   Apt 4B
>   Springfield, IL
> ```
>
> æˆ–è€…ï¼Œä½¿ç”¨`>`æ¥æŠŠæ¢è¡Œåˆå¹¶ä¸ºå•ä¸ªç©ºæ ¼ï¼š
>
> ```yaml
> description: >
>   This is a very long description
>   that will be wrapped into a single line.
> ```
>
> #### 4. **æ•°ç»„**
>
> YAMLä¸­çš„æ•°ç»„ï¼ˆåˆ—è¡¨ï¼‰é€šè¿‡åœ¨æ¯ä¸ªå…ƒç´ å‰é¢åŠ ä¸Šç ´æŠ˜å·ï¼ˆ`-`ï¼‰è¡¨ç¤ºï¼š
>
> ```yaml
> fruits:
>   - Apple
>   - Banana
>   - Orange
> ```
>
> #### 5. **å­—å…¸ï¼ˆMapï¼‰**
>
> å­—å…¸æ˜¯ç”±å¤šä¸ªé”®å€¼å¯¹ç»„æˆçš„ï¼Œ**é”®å€¼å¯¹ä¹‹é—´ç”¨æ¢è¡Œåˆ†éš”**ã€‚å­—å…¸åµŒå¥—ä¹Ÿæ˜¯å¸¸è§çš„ç”¨æ³•ã€‚
>
> ```yaml
> person:
>   name: Alice
>   age: 30
>   address:
>     street: 123 Main St
>     city: Springfield
>     zip: 62701
> ```
>
> #### 6. **å¼•ç”¨**
>
> YAMLæ”¯æŒå¼•ç”¨å’Œé”šç‚¹ã€‚é€šè¿‡`&`åˆ›å»ºä¸€ä¸ªé”šç‚¹ï¼Œå†é€šè¿‡`*`å¼•ç”¨å®ƒã€‚
>
> ```yaml
> defaults: &defaults
>   name: Alice
>   age: 30
> 
> user1:
>   <<: *defaults
>   city: New York
> 
> user2:
>   <<: *defaults
>   city: Chicago
> ```
>
> åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œ`user1`å’Œ`user2`å¼•ç”¨äº†`defaults`ä¸­çš„æ•°æ®ï¼Œä½†å¯ä»¥è¦†ç›–æˆ–æ·»åŠ æ–°çš„é”®å€¼å¯¹ã€‚
>
> #### 7. **æ³¨é‡Š**
>
> YAMLä¸­çš„æ³¨é‡Šä½¿ç”¨ `#` ç¬¦å·ã€‚æ³¨é‡Šä»Ž `#` å¼€å§‹ï¼Œç›´åˆ°è¡Œæœ«ä¸ºæ­¢ï¼š
>
> ```yaml
> # This is a comment
> name: Alice  # This is also a comment
> ```

> ### YAMLä¸ŽJSONçš„å¯¹æ¯”
>
> YAMLä¸ŽJSONéžå¸¸ç›¸ä¼¼ï¼Œéƒ½å¯ä»¥ç”¨æ¥è¡¨ç¤ºç»“æž„åŒ–æ•°æ®ã€‚YAMLç›¸è¾ƒäºŽJSONçš„ä¸»è¦ä¼˜ç‚¹æ˜¯ï¼š
>
> - **æ›´ç®€æ´**ï¼šYAMLåŽ»é™¤äº†JSONä¸­çš„èŠ±æ‹¬å·ã€å¼•å·ã€é€—å·ç­‰ç¬¦å·ï¼Œä½¿å¾—æ ¼å¼æ›´åŠ ç®€æ´ã€‚
> - **å¯è¯»æ€§æ›´å¼º**ï¼šYAMLæ›´æŽ¥è¿‘è‡ªç„¶è¯­è¨€ï¼Œä¾¿äºŽæ‰‹åŠ¨ç¼–è¾‘å’Œé˜…è¯»ã€‚
> - **ä¸éœ€è¦å¼•å·**ï¼šYAMLä¸­ï¼Œå­—ç¬¦ä¸²å€¼é€šå¸¸ä¸éœ€è¦ç”¨å¼•å·åŒ…è£¹ï¼Œé™¤éžå­—ç¬¦ä¸²æœ¬èº«åŒ…å«ç‰¹æ®Šå­—ç¬¦ã€‚
>
> ç„¶è€Œï¼ŒJSONæ›´ä¸¥æ ¼ï¼Œé€šå¸¸ç”¨äºŽæ•°æ®ä¼ è¾“å’ŒAPIä¸­ï¼Œè€ŒYAMLæ›´é€‚åˆé…ç½®æ–‡ä»¶ã€æ—¥å¿—ç­‰åœºæ™¯ã€‚





ä¸€ä¸ªç®€å•çš„K8s Deploymentèµ„æºæ¸…å•

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: my-simple-pod
spec:
  containers:
  - name: my-container
    image: nginx:latest
    ports:
    - containerPort: 80
```

åœ¨masterä¸»æœºä¸­å¯ä»¥è¿›è¡Œéƒ¨ç½²

```shell
kubectl apply -f my-simple-pod.yaml
```



**Podç”Ÿå‘½å‘¨æœŸ**ä¸­åœ¨ Main Containerå¯åŠ¨ä¹‹å‰ æœ‰æ—¶ä¼šé¢„å…ˆå¯åŠ¨ä¸€äº› init ContaineråŽ»æ£€éªŒè¿è¡ŒçŽ¯å¢ƒä»¥åŠé…ç½®ä¸€äº›æ–‡ä»¶

> åœ¨ Kubernetes ä¸­ï¼Œ**æŽ¢é’ˆï¼ˆProbeï¼‰** æ˜¯ä¸€ç§ç”¨äºŽç›‘æŽ§å’Œç®¡ç†å®¹å™¨å¥åº·çŠ¶æ€çš„æœºåˆ¶ã€‚æŽ¢é’ˆé€šè¿‡å‘¨æœŸæ€§åœ°æ£€æŸ¥å®¹å™¨çš„å¥åº·çŠ¶å†µï¼ˆå¦‚æ˜¯å¦æ­£åœ¨æ­£å¸¸è¿è¡Œï¼‰ï¼Œå¸®åŠ© Kubernetes ç¡®å®šå®¹å™¨æ˜¯å¦å¥åº·ã€æ˜¯å¦å°±ç»ªï¼Œä»¥åŠæ˜¯å¦éœ€è¦é‡å¯ã€‚
>
> Kubernetes ä¸­æœ‰ä¸‰ç§ç±»åž‹çš„æŽ¢é’ˆï¼Œåˆ†åˆ«æ˜¯ï¼š
>
> 1. **Liveness Probeï¼ˆå­˜æ´»æŽ¢é’ˆï¼‰**
> 2. **Readiness Probeï¼ˆå°±ç»ªæŽ¢é’ˆï¼‰**
> 3. **Startup Probeï¼ˆå¯åŠ¨æŽ¢é’ˆï¼‰**

ç”±kubeletåŽ»è°ƒç”¨æ‰§è¡ŒProbe

 Kubernetes Pod ç¤ºä¾‹ï¼Œå…¶ä¸­åŒ…æ‹¬äº† **Init Containers**ã€ä¸»å®¹å™¨ã€**æŽ¢é’ˆï¼ˆProbesï¼‰** ä»¥åŠå¯åŠ¨å’Œé€€å‡ºçš„é€»è¾‘ï¼š

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: web-app-pod
spec:
  initContainers:
    - name: init-db
      image: busybox
      command: ['sh', '-c', 'echo "Initializing database..."; sleep 10']
      volumeMounts:
        - name: app-data
          mountPath: /data

  containers:
    - name: web-app
      image: my-web-app:latest
      ports:
        - containerPort: 80
      volumeMounts:
        - name: app-data
          mountPath: /app/data
      livenessProbe:
        httpGet:
          path: /healthz
          port: 80
        initialDelaySeconds: 10
        periodSeconds: 5
        failureThreshold: 3
        timeoutSeconds: 2
      readinessProbe:
        httpGet:
          path: /readiness
          port: 80
        initialDelaySeconds: 5
        periodSeconds: 5
        failureThreshold: 3
        timeoutSeconds: 2
      startupProbe:
        httpGet:
          path: /start
          port: 80
        initialDelaySeconds: 15
        periodSeconds: 5
        failureThreshold: 10

  volumes:
    - name: app-data
      emptyDir: {}
  
  restartPolicy: Always
```

> é€šå¸¸æƒ…å†µä¸‹ï¼Œä½ å¯èƒ½ä¼šç”¨ `kind: Pod` æ¥å®šä¹‰å•ä¸ªå®¹å™¨çš„å·¥ä½œè´Ÿè½½ï¼Œä¾‹å¦‚ï¼š
>
> - ç”¨äºŽå¿«é€Ÿéƒ¨ç½²æˆ–æµ‹è¯•å®¹å™¨åŒ–åº”ç”¨ã€‚
> - ç”¨äºŽè¿è¡Œä¸éœ€è¦æ‰©ç¼©å®¹çš„å•ä¸€åº”ç”¨ã€‚
>
> ç„¶è€Œï¼ŒKubernetes ä¸­æ›´å¤šçš„åœºæ™¯æ˜¯ä½¿ç”¨ **æŽ§åˆ¶å™¨**ï¼ˆå¦‚ **Deployment**ã€**StatefulSet**ã€**DaemonSet** ç­‰ï¼‰æ¥ç®¡ç† Podã€‚æŽ§åˆ¶å™¨æä¾›äº†æ›´å¤šçš„åŠŸèƒ½ï¼Œæ¯”å¦‚è‡ªåŠ¨æ‰©å±•ã€æ»šåŠ¨æ›´æ–°ç­‰ã€‚å› æ­¤ï¼Œè™½ç„¶ä½ å¯ä»¥ç›´æŽ¥ä½¿ç”¨ `Pod` æ¥è¿è¡Œåº”ç”¨ï¼Œä½†åœ¨ç”Ÿäº§çŽ¯å¢ƒä¸­ï¼Œé€šå¸¸æŽ¨èä½¿ç”¨ Deployment æˆ–å…¶ä»–æŽ§åˆ¶å™¨æ¥ç®¡ç† Podã€‚

=>å³ä¸å¸¸ç”¨ kind ï¼šPodï¼Œ è€Œæ˜¯ç±»ä¼¼ kind:Deployment

### Pod æŽ§åˆ¶å™¨ 20241107

> **Pod æŽ§åˆ¶å™¨**ï¼ˆPod Controllerï¼‰æ˜¯ Kubernetes ä¸­ä¸€ç§ç”¨äºŽç®¡ç†å’ŒæŽ§åˆ¶ **Pod** ç”Ÿå‘½å‘¨æœŸçš„æŽ§åˆ¶å™¨ã€‚
>
> ### å¸¸è§çš„ Pod æŽ§åˆ¶å™¨ç±»åž‹
>
> 1. **ReplicaSet**
>    - **åŠŸèƒ½**ï¼šç¡®ä¿æŒ‡å®šæ•°é‡çš„ Pod å‰¯æœ¬å§‹ç»ˆåœ¨é›†ç¾¤ä¸­è¿è¡Œã€‚å¦‚æžœæŸä¸ª Pod å‡ºçŽ°æ•…éšœæˆ–è¢«åˆ é™¤ï¼ŒReplicaSet ä¼šè‡ªåŠ¨åˆ›å»ºæ–°çš„ Pod ä»¥ä¿æŒå‰¯æœ¬æ•°ã€‚
>    - **åº”ç”¨åœºæ™¯**ï¼šç”¨äºŽä¿è¯æŸä¸€åº”ç”¨çš„ Pod æ•°é‡å’Œå¥åº·çŠ¶æ€ä¸€è‡´ã€‚
> 2. **Deployment**
>    - **åŠŸèƒ½**ï¼šDeployment æ˜¯ ReplicaSet çš„é«˜çº§æŠ½è±¡ï¼Œå®ƒä¸ä»…ç®¡ç† Pod å‰¯æœ¬ï¼Œè¿˜æä¾›äº†æ»šåŠ¨æ›´æ–°ã€å›žæ»šç­‰åŠŸèƒ½ã€‚å®ƒåœ¨è‡ªåŠ¨åŒ–éƒ¨ç½²ã€ç‰ˆæœ¬æŽ§åˆ¶å’Œç³»ç»Ÿæ›´æ–°ä¸­éžå¸¸æœ‰ç”¨ã€‚
>    - **åº”ç”¨åœºæ™¯**ï¼šç”¨äºŽç®¡ç†æ— çŠ¶æ€çš„åº”ç”¨ï¼Œæä¾›ç‰ˆæœ¬æŽ§åˆ¶å’Œå¯æ‰©å±•æ€§ã€‚
> 3. **StatefulSet**
>    - **åŠŸèƒ½**ï¼šç”¨äºŽç®¡ç†æœ‰çŠ¶æ€çš„åº”ç”¨ã€‚å®ƒç¡®ä¿æ¯ä¸ª Pod éƒ½æœ‰ä¸€ä¸ªç¨³å®šçš„æ ‡è¯†ç¬¦ï¼Œå¹¶ä¸”åœ¨æ›´æ–°æ—¶ä¿è¯ Pod çš„é¡ºåºæ€§å’Œç¨³å®šæ€§ã€‚StatefulSet è¿˜ç¡®ä¿åº”ç”¨ä¸­çš„æ¯ä¸ª Pod åœ¨é‡æ–°è°ƒåº¦æ—¶ä¼šä¿ç•™æŒä¹…åŒ–å­˜å‚¨ã€‚
>    - **åº”ç”¨åœºæ™¯**ï¼šé€‚ç”¨äºŽæœ‰çŠ¶æ€æœåŠ¡ï¼Œæ¯”å¦‚æ•°æ®åº“ã€ç¼“å­˜ã€é˜Ÿåˆ—ç­‰ã€‚
> 4. **DaemonSet**
>    - **åŠŸèƒ½**ï¼šDaemonSet ç¡®ä¿åœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šéƒ½è¿è¡Œä¸€ä¸ª Pod å‰¯æœ¬ã€‚å¦‚æžœæ·»åŠ äº†æ–°èŠ‚ç‚¹ï¼ŒDaemonSet ä¼šè‡ªåŠ¨åœ¨æ–°èŠ‚ç‚¹ä¸Šå¯åŠ¨ä¸€ä¸ª Pod å‰¯æœ¬ã€‚
>    - **åº”ç”¨åœºæ™¯**ï¼šç”¨äºŽèŠ‚ç‚¹çº§åˆ«çš„æœåŠ¡ï¼Œå¦‚æ—¥å¿—æ”¶é›†ã€ç›‘æŽ§ä»£ç†ã€ç½‘ç»œæ’ä»¶ç­‰ã€‚
> 5. **Job**
>    - **åŠŸèƒ½**ï¼šJob æŽ§åˆ¶å™¨è´Ÿè´£ä¸€æ¬¡æ€§ä»»åŠ¡ï¼ˆå¦‚æ‰¹å¤„ç†ä»»åŠ¡ï¼‰çš„ç®¡ç†ã€‚å®ƒç¡®ä¿ä»»åŠ¡å®ŒæˆæŒ‡å®šæ¬¡æ•°ï¼Œä¸”æ‰€æœ‰ Pod å¿…é¡»æˆåŠŸè¿è¡Œå®Œä»»åŠ¡ã€‚
>    - **åº”ç”¨åœºæ™¯**ï¼šç”¨äºŽå¤„ç†å®šæ—¶ä»»åŠ¡ã€æ‰¹å¤„ç†ã€æ•°æ®è¿ç§»ç­‰ä»»åŠ¡ã€‚
> 6. **CronJob**
>    - **åŠŸèƒ½**ï¼šCronJob æ˜¯ Job æŽ§åˆ¶å™¨çš„æ‰©å±•ï¼Œå…è®¸ç”¨æˆ·æŒ‰ç…§æŒ‡å®šçš„æ—¶é—´è®¡åˆ’å‘¨æœŸæ€§åœ°è¿è¡Œä½œä¸šã€‚å®ƒç±»ä¼¼äºŽ Linux ä¸­çš„ cron ä½œä¸šã€‚
>    - **åº”ç”¨åœºæ™¯**ï¼šç”¨äºŽå®šæœŸæ‰§è¡Œä»»åŠ¡ï¼Œå¦‚å®šæ—¶å¤‡ä»½ã€å®šæ—¶æ•°æ®åŒæ­¥ç­‰ã€‚

å‘½ä»¤å¼ç¼–ç¨‹ ä¸Ž å£°æ˜Žå¼ç¼–ç¨‹

> **å£°æ˜Žå¼ç¼–ç¨‹**ï¼ˆDeclarative Programmingï¼‰æ˜¯ä¸€ç§ç¼–ç¨‹èŒƒå¼ï¼Œå…¶ä¸­ç¨‹åºå‘˜æè¿°æœŸæœ›çš„â€œ**åšä»€ä¹ˆ**â€è€Œä¸æ˜¯â€œ**æ€Žä¹ˆåš**â€ã€‚ä¸Žå‘½ä»¤å¼ç¼–ç¨‹ï¼ˆImperative Programmingï¼‰ä¸åŒï¼Œå£°æ˜Žå¼ç¼–ç¨‹ä¸“æ³¨äºŽè¡¨è¾¾è®¡ç®—çš„ç»“æžœæˆ–ç›®æ ‡ï¼Œè€Œä¸æ˜¯æè¿°å¦‚ä½•ä¸€æ­¥ä¸€æ­¥å®žçŽ°è¿™ä¸ªç›®æ ‡çš„å…·ä½“è¿‡ç¨‹ã€‚
>
> **é…ç½®è¯­è¨€ï¼ˆå¦‚ JSONã€YAMLã€Terraform ç­‰ï¼‰**ï¼š
>
> - é…ç½®æ–‡ä»¶é€šå¸¸ç”¨äºŽå£°æ˜Žæ€§ç¼–ç¨‹ï¼Œæè¿°å¸Œæœ›ç³»ç»Ÿè¾¾åˆ°çš„ç›®æ ‡çŠ¶æ€ï¼Œè€Œä¸æ¶‰åŠå¦‚ä½•ä¸€æ­¥æ­¥å®žçŽ°ã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨ `YAML` æˆ– `JSON` å®šä¹‰ Kubernetes çš„ Podã€æœåŠ¡æˆ–è™šæ‹Ÿæœºçš„é…ç½®ï¼ŒKubernetes ç³»ç»Ÿä¼šè´Ÿè´£æ ¹æ®è¿™äº›é…ç½®ç®¡ç†èµ„æºã€‚

**å¤§å¤šæ•°æƒ…å†µä¸‹**ï¼Œ**ä¸€ä¸ªå®¹å™¨åªæœ‰ä¸€ä¸ªä¸»è¿›ç¨‹**ï¼Œå¹¶ä¸”è¯¥å®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸå’Œè¯¥ä¸»è¿›ç¨‹æ˜¯ç´§å¯†ç›¸å…³çš„ã€‚Docker å¼ºè°ƒ **ä¸€ä¸ªè¿›ç¨‹ä¸€ä¸ªå®¹å™¨** çš„ç†å¿µï¼ŒæŽ¨èå°†åº”ç”¨æ‹†åˆ†æˆå¤šä¸ªå®¹å™¨ï¼Œæ¯ä¸ªå®¹å™¨è¿è¡Œä¸€ä¸ªå•ç‹¬çš„è¿›ç¨‹æˆ–æœåŠ¡ã€‚

=>æ‰€ä»¥æ‰€è°“çš„PodæŽ§åˆ¶å™¨ï¼Œæ¯”å¦‚DaemonSetï¼Œå¯ä»¥è·Ÿå•ä¸ªçš„å®ˆæŠ¤è¿›ç¨‹è”ç³»èµ·æ¥ï¼Œå³ PodæŽ§åˆ¶å™¨=>è¿›ç¨‹å±žæ€§

=>éƒ¨ç½²å®ŒPodä¹‹åŽï¼ŒæŽ§åˆ¶å™¨è®¾ç½®ä¸ºDeployment, è¿˜å¯ä»¥åœ¨masterä¸­è¿›è¡Œæ‰©å®¹ï¼Œå›žæ»šï¼Œæ›´æ–°é•œåƒç­‰å‘½ä»¤è¡Œæ“ä½œ

Job æŽ§åˆ¶å™¨ç¤ºä¾‹ï¼š

```yaml
apiVersion: batch/v1
kind: Job
metadata:
  name: example-job
spec:
  completions: 1          # ä»»åŠ¡æˆåŠŸæ‰§è¡Œçš„æ¬¡æ•°ï¼Œé»˜è®¤å€¼æ˜¯ 1
  parallelism: 1          # åŒæ—¶è¿è¡Œçš„ Pod æ•°é‡ï¼Œé»˜è®¤å€¼æ˜¯ 1
  backoffLimit: 4         # æœ€å¤§é‡è¯•æ¬¡æ•°ï¼Œå¤±è´¥åŽé‡è¯•çš„æœ€å¤§æ¬¡æ•°
  activeDeadlineSeconds: 3600  # Job è¿è¡Œçš„æœ€å¤§æ—¶é—´ï¼ˆç§’ï¼‰ï¼Œè¶…è¿‡æ­¤æ—¶é—´ä»»åŠ¡å°†è¢«ç»ˆæ­¢
  template:
    spec:
      containers:
      - name: example-container
        image: busybox:1.35
        command: ["sh", "-c", "echo Hello World; sleep 30"]  # æ‰§è¡Œçš„ä»»åŠ¡
      restartPolicy: Never  # è¡¨ç¤º Job ä¸­çš„ Pod å¤±è´¥åŽä¸ä¼šé‡å¯
```

=>ä¸Šé¢å°±æ˜¯å¯åŠ¨ä¸€ä¸ªPodè¿è¡Œ Hello Worldï¼Œåœ¨masteré‡Œå†æ‰“ä¸€ä¸ª kubectl log xxxå°±èƒ½ä»ŽPodé‚£è¾¹å¾—åˆ°ç»“æžœ

### Service 20241108

> åœ¨ **Kubernetes** ä¸­ï¼Œ`Service` æ˜¯ä¸€ç§æŠ½è±¡çš„èµ„æºï¼Œå®ƒå®šä¹‰äº†ä¸€ç§è®¿é—®å’Œæš´éœ²ä¸€ç»„ **Pod** çš„æ–¹æ³•ã€‚Kubernetes çš„ `Service` ä½¿å¾—å®¢æˆ·ç«¯å¯ä»¥è®¿é—®åŽç«¯çš„ Podï¼Œè€Œæ— éœ€å…³å¿ƒ Pod çš„åŠ¨æ€å˜åŒ–å’Œ IP åœ°å€çš„æ”¹å˜ã€‚
>
> ### `Service` çš„ä½œç”¨
>
> - **è´Ÿè½½å‡è¡¡**ï¼šä¸€ä¸ª `Service` å¯ä»¥é€šè¿‡è´Ÿè½½å‡è¡¡çš„æ–¹å¼å°†è¯·æ±‚åˆ†å‘åˆ°ä¸€ç»„ Pod ä¸Šã€‚å³ä½¿ Pod çš„ IP åœ°å€å˜åŒ–ï¼Œ`Service` ä¹Ÿä¼šä¿æŒå¯¹è¿™äº› Pod çš„è®¿é—®èƒ½åŠ›ã€‚
> - **æŠ½è±¡ä¸Žç¨³å®šæ€§**ï¼š`Service` æä¾›äº†ä¸€ä¸ªç¨³å®šçš„è®¿é—®å…¥å£ã€‚Pod å¯èƒ½ä¼šè¢«æ›¿æ¢ã€é‡æ–°è°ƒåº¦æˆ–é”€æ¯ï¼Œä½† `Service` çš„è®¿é—®åœ°å€ï¼ˆå³ DNS åç§°æˆ– IPï¼‰æ˜¯å›ºå®šçš„ï¼Œä¸ä¼šæ”¹å˜ã€‚
> - **ç®€åŒ–æœåŠ¡å‘çŽ°**ï¼šé€šè¿‡ `Service`ï¼Œå¯ä»¥å¾ˆå®¹æ˜“åœ°è¿›è¡ŒæœåŠ¡å‘çŽ°å’Œè®¿é—® Kubernetes é›†ç¾¤å†…éƒ¨æˆ–å¤–éƒ¨çš„æœåŠ¡ã€‚
>
> ### `Service` çš„ç±»åž‹
>
> åœ¨ Kubernetes ä¸­ï¼Œ`Service` æœ‰ä¸åŒçš„ç±»åž‹ï¼Œæ¯ç§ç±»åž‹å®šä¹‰äº†ä¸åŒçš„æš´éœ²æ–¹å¼ã€‚å¸¸è§çš„ `Service` ç±»åž‹åŒ…æ‹¬ï¼š
>
> 1. **ClusterIP**ï¼ˆé»˜è®¤ç±»åž‹ï¼‰
>    `ClusterIP` ç±»åž‹çš„ `Service` åªåœ¨ Kubernetes é›†ç¾¤å†…éƒ¨å¯è®¿é—®ã€‚å®ƒä¸º Pod æä¾›äº†ä¸€ä¸ªé›†ç¾¤å†…éƒ¨çš„ IP åœ°å€ï¼Œå¹¶é€šè¿‡è¯¥ IP åœ°å€è¿›è¡Œè´Ÿè½½å‡è¡¡ã€‚
> 2. **NodePort**
>    `NodePort` ç±»åž‹çš„ `Service` ä¼šå°†æœåŠ¡æš´éœ²åˆ°æ¯ä¸ª Node ä¸Šçš„ä¸€ä¸ªç«¯å£ä¸Šã€‚é€šè¿‡è®¿é—® `NodeIP:NodePort`ï¼Œå¯ä»¥ä»Žå¤–éƒ¨è®¿é—®è¯¥æœåŠ¡ã€‚
> 3. **LoadBalancer**
>    `LoadBalancer` ç±»åž‹çš„ `Service` ä¼šä¸ºæœåŠ¡åˆ›å»ºä¸€ä¸ªå¤–éƒ¨è´Ÿè½½å‡è¡¡å™¨ï¼ˆé€šå¸¸æ˜¯äº‘æä¾›å•†çš„è´Ÿè½½å‡è¡¡æœåŠ¡ï¼Œå¦‚ AWS ELB æˆ– GCP çš„è´Ÿè½½å‡è¡¡å™¨ï¼‰ã€‚å®ƒå…è®¸å¤–éƒ¨æµé‡é€šè¿‡è´Ÿè½½å‡è¡¡å™¨è®¿é—® Kubernetes é›†ç¾¤ä¸­çš„æœåŠ¡ã€‚
> 4. **ExternalName**
>    `ExternalName` ç±»åž‹çš„ `Service` ä¸ä¼šç›´æŽ¥å°†è¯·æ±‚è·¯ç”±åˆ° Kubernetes é›†ç¾¤å†…éƒ¨çš„ Podã€‚ç›¸åï¼Œå®ƒä¼šå°†è¯·æ±‚é‡å®šå‘åˆ°å¤–éƒ¨ DNS åç§°ã€‚é€‚ç”¨äºŽå°† Kubernetes å†…éƒ¨æœåŠ¡ä¸Žå¤–éƒ¨æœåŠ¡è¿›è¡Œé›†æˆçš„åœºæ™¯ã€‚

=>Serviceä¸æ˜¯ä¸€ä¸ªå…·ä½“çš„æœåŠ¡å™¨ï¼Œå®ƒæ˜¯é€šè¿‡apiserver ä¸Ž Kube-proxy ä¸ŽClientæ‰€è®¿é—®çš„iptablesçš„ äº¤äº’ è€Œç»„æˆçš„ ä¸€å¥—æœºåˆ¶ã€‚ Serviceæ˜¯ OSIç¬¬å››å±‚çš„ æœåŠ¡ï¼Œæœ‰Kube-proxy æä¾›è™šæ‹ŸIPï¼Œæ®è¯´ç”¨Ingresså¯ä»¥æä¾›ç¬¬7å±‚çš„HTTPæœåŠ¡

> ä¸¾ä¾‹å®žçŽ° **ClusterIP** çš„è¿‡ç¨‹ä¸­ï¼Œ`apiserver`ã€`kube-proxy` å’Œ `iptables`ï¼ˆæˆ– `IPVS`ï¼‰èµ·åˆ°äº†å…³é”®ä½œç”¨
>
> **API Server (`apiserver`)**ï¼šKubernetes API Server æ˜¯é›†ç¾¤çš„æ ¸å¿ƒç»„ä»¶ä¹‹ä¸€ï¼Œè´Ÿè´£æŽ¥æ”¶å¹¶å¤„ç†æ‰€æœ‰é›†ç¾¤çš„ REST è¯·æ±‚ï¼Œå¹¶ä¸Žå…¶å®ƒ Kubernetes ç»„ä»¶è¿›è¡Œé€šä¿¡ã€‚
>
> **kube-proxy**ï¼šæ¯ä¸ª Kubernetes èŠ‚ç‚¹ä¸Šéƒ½ä¼šè¿è¡Œ `kube-proxy`ï¼Œå®ƒè´Ÿè´£åœ¨èŠ‚ç‚¹ä¸Šè®¾ç½®ç½‘ç»œè·¯ç”±è§„åˆ™ï¼Œç¡®ä¿æ¥è‡ªå®¢æˆ·ç«¯ï¼ˆä¾‹å¦‚ï¼ŒPodã€Serviceï¼‰è¯·æ±‚çš„æµé‡èƒ½å¤Ÿæ­£ç¡®åœ°è½¬å‘åˆ°ç›®æ ‡ Podã€‚
>
> **iptables**ï¼š`iptables` æ˜¯ Linux ç³»ç»Ÿä¸­ç”¨äºŽç®¡ç†ç½‘ç»œæµé‡çš„å·¥å…·ï¼ŒKubernetes ä½¿ç”¨å®ƒæ¥åˆ›å»ºè§„åˆ™ï¼Œå®žçŽ°æµé‡è½¬å‘å’Œè´Ÿè½½å‡è¡¡ã€‚

ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„ `NodePort` æœåŠ¡çš„ YAML ç¤ºä¾‹ï¼š

```
apiVersion: v1
kind: Service
metadata:
  name: my-nodeport-service
spec:
  selector:
    app: my-app
  ports:
    - protocol: TCP
      port: 80        # é›†ç¾¤å†…çš„æœåŠ¡ç«¯å£
      targetPort: 8080 # åŽç«¯ Pod ä¸Šçš„ç«¯å£ï¼ˆå®¹å™¨å®žé™…ç›‘å¬çš„ç«¯å£ï¼‰
      nodePort: 30007  # æš´éœ²ç»™å¤–éƒ¨å®¢æˆ·ç«¯è®¿é—®çš„ç«¯å£
  type: NodePort
```

> Ingress ä¸»è¦æ˜¯å¤„ç† HTTP å’Œ HTTPS æµé‡çš„è·¯ç”±å’Œè´Ÿè½½å‡è¡¡ã€‚å®ƒé€šè¿‡å®šä¹‰ä¸€äº›è·¯ç”±è§„åˆ™ï¼Œå°†å¤–éƒ¨è¯·æ±‚è½¬å‘åˆ°é›†ç¾¤å†…éƒ¨çš„æœåŠ¡ã€‚Ingress å……å½“äº†ä¸€ä¸ª**åå‘ä»£ç†**ï¼Œé€šè¿‡å®ƒä½ å¯ä»¥è®¾ç½® URL è·¯ç”±ã€SSL ç»ˆæ­¢ã€é‡å®šå‘ç­‰åŠŸèƒ½ã€‚
>
> Ingress æ˜¯ç”±ä¸€ä¸ªæŽ§åˆ¶å™¨ï¼ˆ**Ingress Controller**ï¼‰æ¥å®žçŽ°çš„ã€‚æ¯”å¦‚**NGINX Ingress Controller**(åŸºäºŽ NGINX çš„åå‘ä»£ç†å’Œè´Ÿè½½å‡è¡¡å™¨å®žçŽ°)
>
> **Ingress Controller** æ˜¯ä¸€ä¸ªè¿è¡Œåœ¨ Kubernetes é›†ç¾¤ä¸­çš„ **è¿›ç¨‹**ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„æœåŠ¡å™¨ã€‚å®ƒè´Ÿè´£å®žçŽ°å’Œç®¡ç† **Ingress èµ„æº** ä¸­å®šä¹‰çš„è·¯ç”±è§„åˆ™ï¼Œå¹¶å°†å¤–éƒ¨ HTTP/HTTPS æµé‡è·¯ç”±åˆ°é›†ç¾¤å†…éƒ¨çš„æœåŠ¡ã€‚

=>åŒæ ·æœ‰é…ç½®Ingress çš„YAML

### å­˜å‚¨ 20241111

> åœ¨ Kubernetes ä¸­ï¼Œ**å®¹å™¨æœ¬èº«æ²¡æœ‰æŒä¹…åŒ–å­˜å‚¨**ã€‚å®¹å™¨æ˜¯ä¸´æ—¶çš„ã€å¯æ›¿æ¢çš„çŽ¯å¢ƒï¼Œä¸€æ—¦å®¹å™¨åœæ­¢æˆ–è¢«åˆ é™¤ï¼Œå®¹å™¨ä¸­çš„æ‰€æœ‰æ•°æ®éƒ½ä¼šä¸¢å¤±ã€‚å› æ­¤ï¼Œå®¹å™¨ä¸­çš„æ•°æ®ä¸€èˆ¬æ˜¯**çŸ­æš‚çš„**ï¼Œé€šå¸¸æˆ‘ä»¬éœ€è¦ä¾èµ–å¤–éƒ¨å­˜å‚¨æ¥æŒä¹…åŒ–æ•°æ®ã€‚

configMapï¼šé…ç½®æ–‡ä»¶

> `ConfigMap` æ˜¯ Kubernetes ç”¨äºŽå­˜å‚¨é…ç½®ä¿¡æ¯çš„èµ„æºå¯¹è±¡ï¼Œå®ƒå…è®¸ä½ å­˜å‚¨ä¸€äº›ä¸åŒ…å«æ•æ„Ÿæ•°æ®çš„é…ç½®æ–‡ä»¶ï¼Œå¦‚ JSONã€YAML æˆ–æ™®é€šçš„æ–‡æœ¬é…ç½®æ–‡ä»¶ã€‚
>
> ```shell
> #å‘½ä»¤è¡Œåˆ›å»º
> kubectl create configmap my-config --from-file=path/to/your/config/file
> ```
>
> å¦‚æžœä½ çš„åº”ç”¨ç¨‹åºçš„é…ç½®æœ¬èº«å°±æ˜¯ YAML æˆ– JSON æ ¼å¼ï¼Œä½ å¯ä»¥ç›´æŽ¥å°†è¿™äº›æ ¼å¼çš„å†…å®¹å­˜å‚¨åœ¨ `ConfigMap` ä¸­:
>
> ```yaml
> apiVersion: v1
> kind: ConfigMap
> metadata:
>   name: config-with-files
> data:
>   config.json: |
>     {
>       "database": "postgresql",
>       "host": "localhost",
>       "port": 5432
>     }
>   app.properties: |
>     server.port=8080
>     database.name=mydb
> ```
>
> æŽ¥ç€å°† ConfigMap æŒ‚è½½åˆ° Podä¸Šï¼š
>
> ```yaml
> apiVersion: v1
> kind: Pod
> metadata:
>   name: example-pod
> spec:
>   containers:
>   - name: example-container
>     image: nginx
>     volumeMounts:
>     - name: config-volume
>       mountPath: /etc/config
>       readOnly: true
>   volumes:
>   - name: config-volume
>     configMap:
>       name: my-config
> ```

> `ConfigMap` æ•°æ®å¹¶ä¸å­˜å‚¨åœ¨æŸä¸ªå•ç‹¬çš„ç‰©ç†æœåŠ¡å™¨ä¸Šï¼Œè€Œæ˜¯å­˜åœ¨äºŽ Kubernetes **æŽ§åˆ¶å¹³é¢ï¼ˆControl Planeï¼‰** çš„ **etcd** æ•°æ®åº“ä¸­ã€‚



Secretï¼š`Secret` å’Œ `ConfigMap` éƒ½æ˜¯ç”¨äºŽå­˜å‚¨é…ç½®ä¿¡æ¯çš„èµ„æºå¯¹è±¡ï¼Œå®ƒä»¬çš„ä¸»è¦åŒºåˆ«åœ¨äºŽå­˜å‚¨çš„æ•°æ®ç±»åž‹å’Œç”¨é€”ã€‚Secretå­˜å‚¨æ•æ„Ÿæ•°æ®ï¼Œå¦‚å¯†ç ã€API å¯†é’¥ã€ä»¤ç‰Œç­‰ã€‚æ•°æ®åœ¨ etcd ä¸­å­˜å‚¨æ—¶é€šå¸¸æ˜¯ç»è¿‡ base64 ç¼–ç çš„ï¼Œä¸”å¯ä»¥ä¸Žå¤–éƒ¨åŠ å¯†å·¥å…·ï¼ˆå¦‚ Vaultï¼‰é…åˆä½¿ç”¨ï¼Œä»¥å¢žå¼ºå®‰å…¨æ€§ã€‚



Volume: ç”¨äºŽæŒä¹…åŒ–æ•°æ®å’Œå®¹å™¨ä¹‹é—´å…±äº«æ•°æ®çš„æœºåˆ¶ã€‚å®¹å™¨æœ¬èº«æ˜¯çŸ­æš‚çš„ï¼Œé‡å¯æˆ–é‡æ–°è°ƒåº¦æ—¶ï¼Œå®¹å™¨å†…çš„æ•°æ®å¯èƒ½ä¼šä¸¢å¤±ã€‚å› æ­¤ï¼ŒKubernetes å¼•å…¥äº† `Volume` æœºåˆ¶ï¼Œä»¥ç¡®ä¿æ•°æ®åœ¨å®¹å™¨ç”Ÿå‘½å‘¨æœŸä¹‹å¤–ä¾ç„¶å­˜åœ¨ï¼Œä¸”å¯ä»¥åœ¨å¤šä¸ªå®¹å™¨ä¹‹é—´å…±äº«ã€‚

=>ç§ç±»å¾ˆå¤šå•Šï¼Œæœ‰PersistentVolume (PV) å’Œ PersistentVolumeClaim (PVC)ï¼Œæœ‰NFS (Network File System)ï¼Œè¿˜æœ‰AWS EBS (Elastic Block Store)ï¼ŒAzure Disk...

> Kubernetes ä¸­çš„ `Volume` æ˜¯å®¹å™¨æŒä¹…åŒ–æ•°æ®å’Œå…±äº«æ•°æ®çš„é‡è¦æœºåˆ¶ã€‚å®ƒä¸ºå®¹å™¨åŒ–åº”ç”¨æä¾›äº†å¤šç§å­˜å‚¨é€‰é¡¹ï¼ŒåŒ…æ‹¬æœ¬åœ°å­˜å‚¨ã€äº‘å­˜å‚¨å’Œåˆ†å¸ƒå¼å­˜å‚¨ç­‰ã€‚é€šè¿‡ä¸åŒç±»åž‹çš„ `Volume`ï¼Œç”¨æˆ·å¯ä»¥æ ¹æ®éœ€æ±‚é€‰æ‹©é€‚åˆçš„å­˜å‚¨æ–¹æ¡ˆã€‚
>
> å¸¸è§çš„ä½¿ç”¨åœºæ™¯åŒ…æ‹¬ï¼š
>
> - ä¸´æ—¶å­˜å‚¨ï¼šä½¿ç”¨ `emptyDir`ã€‚
> - æŒä¹…åŒ–å­˜å‚¨ï¼šä½¿ç”¨ `PersistentVolume` å’Œ `PersistentVolumeClaim`ã€‚
> - è·¨èŠ‚ç‚¹å…±äº«æ•°æ®ï¼šä½¿ç”¨ `NFS` æˆ– `GlusterFS`ã€‚
> - äº‘å­˜å‚¨ï¼šä½¿ç”¨ `AWS EBS`ã€`Azure Disk` ç­‰ã€‚



PersistentVolumeï¼ˆPVï¼‰: PV æ˜¯é›†ç¾¤ä¸­çš„å­˜å‚¨èµ„æºï¼Œå®ƒå¯ä»¥æ˜¯ä¸€ä¸ªäº‘å­˜å‚¨å·ï¼ˆå¦‚ AWS EBSã€Azure Diskï¼‰æˆ–ç½‘ç»œå­˜å‚¨å·ï¼ˆå¦‚ NFSã€GlusterFSï¼‰ã€‚PV æ˜¯ä¸€ä¸ªæŒä¹…åŒ–çš„èµ„æºï¼Œç”Ÿå‘½å‘¨æœŸç‹¬ç«‹äºŽ Podã€‚å®ƒä¸ä¼šéšç€ Pod çš„åˆ é™¤è€Œåˆ é™¤ï¼Œé™¤éžè®¾ç½®äº†å›žæ”¶ç­–ç•¥ã€‚

PersistentVolumeClaimï¼ˆPVCï¼‰:`PersistentVolumeClaim` æ˜¯å¯¹å­˜å‚¨èµ„æºçš„è¯·æ±‚ï¼Œå®ƒç”±ç”¨æˆ·æˆ–åº”ç”¨ç¨‹åºåˆ›å»ºã€‚PVC è¯·æ±‚å­˜å‚¨èµ„æºçš„å¤§å°ã€è®¿é—®æ¨¡å¼ç­‰å±žæ€§ï¼ŒKubernetes ä¼šæ ¹æ® PVC çš„éœ€æ±‚æ‰¾åˆ°ä¸€ä¸ªåˆé€‚çš„ PVã€‚PVC çš„ç”Ÿå‘½å‘¨æœŸä¸Ž Pod ç»‘å®šï¼ŒPVC å¯ä»¥åœ¨ Pod çš„å£°æ˜Žä¸­æŒ‡å®šï¼ŒKubernetes ä¼šè‡ªåŠ¨å°†ä¸€ä¸ªåˆé€‚çš„ PV ç»‘å®šåˆ° PVC ä¸Šã€‚

> ### **PV å’Œ PVC çš„å·¥ä½œåŽŸç†**
>
> 1. **åˆ›å»º PV**ï¼š ç®¡ç†å‘˜åˆ›å»º `PersistentVolume`ï¼Œå®šä¹‰å…·ä½“çš„å­˜å‚¨åŽç«¯ï¼ˆä¾‹å¦‚ï¼Œæœ¬åœ°å­˜å‚¨ã€ç½‘ç»œå­˜å‚¨ã€äº‘å­˜å‚¨ï¼‰ï¼Œå¹¶è®¾ç½®å…¶å¤§å°ã€è®¿é—®æ¨¡å¼ç­‰å±žæ€§ã€‚
> 2. **åˆ›å»º PVC**ï¼š ç”¨æˆ·åˆ›å»º `PersistentVolumeClaim`ï¼Œå¹¶å£°æ˜Žæ‰€éœ€çš„å­˜å‚¨å¤§å°å’Œè®¿é—®æ¨¡å¼ï¼ˆä¾‹å¦‚ `ReadWriteOnce` æˆ– `ReadWriteMany`ï¼‰ã€‚PVC ä¼šæ ¹æ®è¿™äº›éœ€æ±‚è¯·æ±‚åˆé€‚çš„ PVã€‚
> 3. **PV å’Œ PVC ç»‘å®š**ï¼š
>    - Kubernetes ä¼šæ ¹æ® PVC çš„è¯·æ±‚æ‰¾åˆ°ä¸€ä¸ªç¬¦åˆæ¡ä»¶çš„ PVï¼Œå¹¶å°†å…¶ä¸Ž PVC ç»‘å®šã€‚
>    - ä¸€æ—¦ PV å’Œ PVC è¢«ç»‘å®šï¼ŒPVC çš„ç”Ÿå‘½å‘¨æœŸå°±ä¸Žç»‘å®šçš„ PV ç»‘å®šï¼ŒPVC çš„ç”Ÿå‘½å‘¨æœŸå°†åœ¨ Pod è¢«åˆ é™¤æ—¶ç»“æŸã€‚
> 4. **è®¿é—®å­˜å‚¨**ï¼š
>    - ç»‘å®šåŽï¼Œç”¨æˆ·å¯ä»¥åœ¨ Pod ä¸­é€šè¿‡ `PVC` æ¥è®¿é—® PVã€‚Kubernetes ä¼šè‡ªåŠ¨æŠŠ PVC æŒ‚è½½åˆ°å®¹å™¨çš„æ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œå®¹å™¨å¯ä»¥é€šè¿‡ `PVC` ä½¿ç”¨å¯¹åº”çš„å­˜å‚¨ã€‚

=>è®¾è®¡å‡ºè¿™ä¸¤ä¸ªæ¦‚å¿µå°±æ˜¯ä¸ºäº†Podä¸Žå…·ä½“çš„å­˜å‚¨ è§£è€¦å•Šï¼ŒPVä¸ŽPVCä¹Ÿæ˜¯ç”¨YAMLæ ¼å¼æ¥å®šä¹‰ï¼Œå¹¶ä¸”è”ç³»çš„ï¼Œä¸¤è€…ä¸€å¯¹ä¸€æ˜ å°„, PVC å’Œ PV æ ¹æ®ä¸€äº›åŽŸåˆ™è‡ªåŠ¨ç»‘å®š.

> ### **å¸¸è§çš„ PV å’Œ PVC ä½¿ç”¨åœºæ™¯**
>
> 1. **Cloud Storage**ï¼šä¾‹å¦‚ä½¿ç”¨ `AWS EBS` æˆ– `Azure Disk`ï¼Œä¸ºæ¯ä¸ª Pod æä¾›ç‹¬ç«‹çš„å­˜å‚¨ã€‚
> 2. **Network Storage**ï¼šä¾‹å¦‚ä½¿ç”¨ `NFS` æˆ– `CephFS`ï¼Œä¸ºå¤šä¸ª Pod æä¾›å…±äº«çš„å­˜å‚¨ã€‚
> 3. **Local Storage**ï¼šä½¿ç”¨èŠ‚ç‚¹æœ¬åœ°å­˜å‚¨ï¼Œä¾‹å¦‚ `hostPath` æˆ– `local` å·ï¼Œç”¨äºŽéœ€è¦å­˜å‚¨åœ¨ç‰¹å®šèŠ‚ç‚¹ä¸Šçš„æ•°æ®ã€‚
> 4. **Stateful Applications**ï¼šåƒæ•°æ®åº“ï¼ˆMySQLã€PostgreSQLï¼‰è¿™ç±»æœ‰çŠ¶æ€åº”ç”¨ï¼Œé€šå¸¸éœ€è¦æŒä¹…åŒ–å­˜å‚¨ï¼Œå¯ä»¥ä½¿ç”¨ PVC ç»‘å®šåˆ° PVã€‚

> ### **å®Œæ•´ç¤ºä¾‹**
>
> å‡è®¾æˆ‘ä»¬å·²ç»æœ‰äº† EBS å·ï¼Œä»¥ä¸‹æ˜¯åˆ›å»º EBS å­˜å‚¨å·å¹¶å°†å…¶æŒ‚è½½åˆ° Pod çš„å®Œæ•´æµç¨‹ã€‚
>
> 1.**åˆ›å»º PersistentVolumeï¼ˆPVï¼‰**ï¼š
>
> ```yaml
> apiVersion: v1
> kind: PersistentVolume
> metadata:
>   name: ebs-pv
> spec:
>   capacity:
>     storage: 10Gi   # éœ€è¦ä¸Ž EBS å·å¤§å°åŒ¹é…
>   accessModes:
>     - ReadWriteOnce   # EBS å·é€šå¸¸ä»…èƒ½åœ¨å•ä¸€èŠ‚ç‚¹ä¸Šä»¥ ReadWriteOnce æ¨¡å¼æŒ‚è½½
>   persistentVolumeReclaimPolicy: Retain   # PV ä¿ç•™ç­–ç•¥ï¼Œå½“ PVC åˆ é™¤æ—¶ä¿ç•™è¯¥ PV
>   awsElasticBlockStore:
>     volumeID: vol-xxxxxxxx   # æ›¿æ¢ä¸ºå®žé™…çš„ EBS å· ID
>     fsType: ext4   # æ–‡ä»¶ç³»ç»Ÿç±»åž‹ï¼Œé€šå¸¸ä¸º ext4 æˆ– xfs
> ```
>
> 2.**åˆ›å»º PersistentVolumeClaimï¼ˆPVCï¼‰**ï¼š
>
> ```yaml
> apiVersion: v1
> kind: PersistentVolumeClaim
> metadata:
>   name: ebs-pvc
> spec:
>   accessModes:
>     - ReadWriteOnce  # è¦æ±‚å•ä¸€èŠ‚ç‚¹å¯ä»¥è¯»å†™
>   resources:
>     requests:
>       storage: 10Gi  # éœ€è¦ä¸Ž PV çš„å¤§å°ä¸€è‡´
> ```
>
> 3.åˆ›å»º Podï¼Œå¹¶æŒ‚è½½ PVC:
>
> ```yaml
> apiVersion: v1
> kind: Pod
> metadata:
>   name: ebs-pod
> spec:
>   containers:
>   - name: nginx-container
>     image: nginx
>     volumeMounts:
>     - name: ebs-storage
>       mountPath: /data  # å°† EBS å·æŒ‚è½½åˆ°å®¹å™¨å†…çš„ /data è·¯å¾„
>   volumes:
>   - name: ebs-storage
>     persistentVolumeClaim:
>       claimName: ebs-pvc  # PVC çš„åç§°
> ```

### é›†ç¾¤è°ƒåº¦ 20241112

> åœ¨ Kubernetes ä¸­ï¼Œé›†ç¾¤è°ƒåº¦ï¼ˆ**Kubernetes Scheduling**ï¼‰æ˜¯æŒ‡å¦‚ä½•å°†ä¸€ä¸ª Pod å®‰æŽ’åˆ°é›†ç¾¤ä¸­çš„èŠ‚ç‚¹ä¸Šè¿è¡Œçš„è¿‡ç¨‹ã€‚è°ƒåº¦è¿‡ç¨‹ä¸ä»…è¦è€ƒè™‘èµ„æºçš„å¯ç”¨æ€§ï¼Œè¿˜è¦è€ƒè™‘èŠ‚ç‚¹çš„å¥åº·çŠ¶æ€ã€æ‹“æ‰‘ç»“æž„ã€ç­–ç•¥è¦æ±‚ã€è°ƒåº¦çº¦æŸç­‰å› ç´ ã€‚Kubernetes çš„è°ƒåº¦å™¨ï¼ˆ**kube-scheduler**ï¼‰è´Ÿè´£æ ¹æ®ä¸€ç³»åˆ—è§„åˆ™ï¼ˆå¦‚èµ„æºéœ€æ±‚ã€èŠ‚ç‚¹äº²å’Œæ€§ã€æ±¡ç‚¹å’Œå®¹å¿åº¦ç­‰ï¼‰å†³å®šå°† Pod éƒ¨ç½²åˆ°å“ªä¸ªèŠ‚ç‚¹ä¸Šã€‚
>
> ### **Kubernetes è°ƒåº¦è¿‡ç¨‹æ¦‚è¿°**
>
> 1. **Pod æäº¤åˆ° API æœåŠ¡å™¨**ï¼š å½“ç”¨æˆ·åˆ›å»º Pod æ—¶ï¼ŒPod å¯¹è±¡ä¼šè¢«æäº¤åˆ° Kubernetes API æœåŠ¡å™¨ã€‚æ­¤æ—¶ï¼ŒPod å¹¶æœªç«‹å³è¿è¡Œï¼Œè€Œæ˜¯å¤„äºŽ `Pending` çŠ¶æ€ã€‚
> 2. **è°ƒåº¦å™¨è°ƒåº¦ Pod**ï¼š Kubernetes çš„è°ƒåº¦å™¨ï¼ˆ`kube-scheduler`ï¼‰ä¼šç›‘æŽ§ API æœåŠ¡å™¨çš„ Pod è°ƒåº¦é˜Ÿåˆ—ï¼ŒæŸ¥çœ‹å“ªäº› Pod å¤„äºŽ `Pending` çŠ¶æ€ï¼Œä¸”å°šæœªç»‘å®šåˆ°èŠ‚ç‚¹ã€‚è°ƒåº¦å™¨å°†æ ¹æ®è°ƒåº¦ç­–ç•¥é€‰æ‹©ä¸€ä¸ªé€‚åˆçš„èŠ‚ç‚¹æ¥è¿è¡Œ Podã€‚
> 3. **èŠ‚ç‚¹é€‰æ‹©**ï¼š è°ƒåº¦å™¨ä¼šæ ¹æ® Pod çš„èµ„æºéœ€æ±‚ã€èŠ‚ç‚¹çš„å¯ç”¨èµ„æºã€èŠ‚ç‚¹äº²å’Œæ€§ã€Pod çš„äº²å’Œæ€§ã€æ±¡ç‚¹ä¸Žå®¹å¿åº¦ç­‰å› ç´ æ¥é€‰æ‹©åˆé€‚çš„èŠ‚ç‚¹ã€‚
> 4. **ç»‘å®š Pod å’ŒèŠ‚ç‚¹**ï¼š ä¸€æ—¦è°ƒåº¦å™¨é€‰æ‹©äº†ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå®ƒä¼šå°† Pod ç»‘å®šåˆ°è¯¥èŠ‚ç‚¹ã€‚ç»‘å®šè¿‡ç¨‹ä¼šæ›´æ–° Pod å¯¹è±¡ï¼Œä½¿å…¶ä¸Žç‰¹å®šèŠ‚ç‚¹å…³è”ï¼ŒPod å°†è¢«åˆ†é…åˆ°è¯¥èŠ‚ç‚¹å¹¶å¼€å§‹è¿è¡Œã€‚
>
> ### **è°ƒåº¦è¿‡ç¨‹è¯¦ç»†æ­¥éª¤**
>
> #### 1. **é¢„é€‰é˜¶æ®µï¼ˆPredicatesï¼‰**
>
> åœ¨è¿™ä¸ªé˜¶æ®µï¼Œè°ƒåº¦å™¨ä¼šæ£€æŸ¥å“ªäº›èŠ‚ç‚¹ç¬¦åˆ Pod çš„åŸºæœ¬éœ€æ±‚ã€‚æ¯ä¸ªèŠ‚ç‚¹éƒ½ä¼šè¢«æ£€æŸ¥ä»¥ç¡®å®šå®ƒæ˜¯å¦èƒ½æ»¡è¶³ Pod çš„èµ„æºéœ€æ±‚å’Œå…¶ä»–çº¦æŸæ¡ä»¶ã€‚
>
> - **èµ„æºéœ€æ±‚**ï¼šæ£€æŸ¥èŠ‚ç‚¹ä¸Šæ˜¯å¦æœ‰è¶³å¤Ÿçš„ CPUã€å†…å­˜ã€å­˜å‚¨ç­‰èµ„æºæ¥æ»¡è¶³ Pod çš„è¦æ±‚ã€‚
> - **èŠ‚ç‚¹äº²å’Œæ€§**ï¼ˆNode Affinityï¼‰ï¼šå¦‚æžœ Pod æœ‰æŒ‡å®šçš„èŠ‚ç‚¹äº²å’Œæ€§ï¼ˆä¾‹å¦‚ï¼Œå¿…é¡»è¿è¡Œåœ¨æŸäº›æ ‡ç­¾çš„èŠ‚ç‚¹ä¸Šï¼‰ï¼Œåˆ™è°ƒåº¦å™¨ä¼šç­›é€‰ç¬¦åˆæ¡ä»¶çš„èŠ‚ç‚¹ã€‚
> - **æ±¡ç‚¹å’Œå®¹å¿åº¦**ï¼ˆTaints and Tolerationsï¼‰ï¼šå¦‚æžœèŠ‚ç‚¹ä¸Šæœ‰æ±¡ç‚¹ï¼ŒPod éœ€è¦æœ‰ç›¸åº”çš„å®¹å¿åº¦æ‰èƒ½è¢«è°ƒåº¦åˆ°è¯¥èŠ‚ç‚¹ã€‚å¦åˆ™ï¼Œè¯¥èŠ‚ç‚¹ä¼šè¢«æŽ’é™¤ã€‚
> - **Pod äº²å’Œæ€§**ï¼ˆPod Affinity/Anti-Affinityï¼‰ï¼šæŒ‡å®š Pod åº”è¯¥æˆ–ä¸åº”è¯¥ä¸Žå“ªäº›å…¶ä»– Pod ä¸€èµ·è¿è¡Œã€‚è°ƒåº¦å™¨ä¼šæ£€æŸ¥å½“å‰é›†ç¾¤ä¸­æ˜¯å¦æœ‰ç¬¦åˆæ¡ä»¶çš„å…¶ä»– Podã€‚
> - **èŠ‚ç‚¹çŠ¶æ€**ï¼šè°ƒåº¦å™¨è¿˜ä¼šæ£€æŸ¥èŠ‚ç‚¹çš„çŠ¶æ€ï¼Œä¾‹å¦‚æ˜¯å¦æ˜¯ `Ready` çŠ¶æ€ï¼ŒèŠ‚ç‚¹æ˜¯å¦è¢«æ ‡è®°ä¸ºä¸å¯è°ƒåº¦ï¼ˆ`NoSchedule`ï¼‰ã€‚
>
> #### 2. **ä¼˜é€‰é˜¶æ®µï¼ˆPrioritizationï¼‰**
>
> åœ¨è¿™ä¸ªé˜¶æ®µï¼Œè°ƒåº¦å™¨ä¼šå¯¹ç¬¦åˆæ¡ä»¶çš„èŠ‚ç‚¹è¿›è¡ŒæŽ’åºã€‚å®ƒæ ¹æ®é¢„å®šä¹‰çš„ä¼˜å…ˆçº§è§„åˆ™ä¸ºæ¯ä¸ªèŠ‚ç‚¹æ‰“åˆ†ï¼Œåˆ†æ•°è¾ƒé«˜çš„èŠ‚ç‚¹å°†è¢«ä¼˜å…ˆé€‰ä¸­ã€‚
>
> ä¸€äº›å¸¸è§çš„ä¼˜å…ˆçº§å› ç´ åŒ…æ‹¬ï¼š
>
> - **èµ„æºéœ€æ±‚ä¼˜å…ˆçº§**ï¼šå¦‚èŠ‚ç‚¹ä¸Šçš„èµ„æºä½¿ç”¨æƒ…å†µå’Œ Pod çš„èµ„æºè¯·æ±‚æ˜¯å¦åŒ¹é…ã€‚
> - **äº²å’Œæ€§ä¼˜å…ˆçº§**ï¼šä¾‹å¦‚ï¼ŒPod æ˜¯å¦åº”è¯¥è¿è¡Œåœ¨æŸä¸ªç‰¹å®šåŒºåŸŸçš„èŠ‚ç‚¹ä¸Šï¼Œæˆ–è€…ä¸Žå…¶ä»– Pod çš„ä½ç½®è¦æ±‚ã€‚
> - **è´Ÿè½½å‡è¡¡**ï¼šè°ƒåº¦å™¨ä¼šè€ƒè™‘å½“å‰èŠ‚ç‚¹ä¸Šçš„è´Ÿè½½ï¼Œé¿å…æŸäº›èŠ‚ç‚¹è¿‡è½½ã€‚
> - **è°ƒåº¦å»¶è¿Ÿ**ï¼šæŸäº›æƒ…å†µå¯èƒ½å¸Œæœ› Pod å°½æ—©è°ƒåº¦åˆ°èŠ‚ç‚¹ï¼Œè°ƒåº¦å™¨ä¼šå°½é‡å‡å°‘è°ƒåº¦å»¶è¿Ÿã€‚
>
> #### 3. **é€‰æ‹©èŠ‚ç‚¹å¹¶ç»‘å®š Pod**
>
> ç»è¿‡é¢„é€‰å’Œä¼˜é€‰åŽï¼Œè°ƒåº¦å™¨ä¼šé€‰æ‹©ä¸€ä¸ªæœ€é€‚åˆçš„èŠ‚ç‚¹ï¼Œå¹¶å°† Pod ç»‘å®šåˆ°è¯¥èŠ‚ç‚¹ã€‚æ­¤æ—¶ï¼ŒPod çŠ¶æ€å˜ä¸º `Running`ï¼Œå¹¶å¼€å§‹åœ¨èŠ‚ç‚¹ä¸Šå¯åŠ¨å®¹å™¨ã€‚
>
> ### **è°ƒåº¦å™¨çš„æ ¸å¿ƒåŠŸèƒ½**
>
> Kubernetes è°ƒåº¦å™¨ï¼ˆ`kube-scheduler`ï¼‰æ‰§è¡Œä»¥ä¸‹ä¸»è¦ä»»åŠ¡ï¼š
>
> - **èŠ‚ç‚¹é€‰æ‹©**ï¼šé€‰æ‹©åˆé€‚çš„èŠ‚ç‚¹ä»¥ç¡®ä¿ Pod åœ¨èµ„æºã€æ‹“æ‰‘ã€ç­–ç•¥ç­‰æ–¹é¢çš„éœ€æ±‚å¾—åˆ°æ»¡è¶³ã€‚
> - **Pod ç»‘å®š**ï¼šä¸€æ—¦é€‰å®šèŠ‚ç‚¹ï¼Œè°ƒåº¦å™¨å°† Pod ç»‘å®šåˆ°è¯¥èŠ‚ç‚¹ï¼Œå¹¶é€šè¿‡ API æœåŠ¡å™¨æ›´æ–° Pod å¯¹è±¡ã€‚
> - **è°ƒåº¦ç­–ç•¥å’Œæ’ä»¶**ï¼šè°ƒåº¦å™¨å¯ä»¥é€šè¿‡æ’ä»¶åŒ–çš„æ–¹å¼æ¥æ‰©å±•è°ƒåº¦ç­–ç•¥ï¼Œå…è®¸é›†ç¾¤ç®¡ç†å‘˜æ ¹æ®ä¸šåŠ¡éœ€æ±‚å®šåˆ¶è°ƒåº¦è¡Œä¸ºã€‚
> - **èµ„æºç®¡ç†**ï¼šè°ƒåº¦å™¨ä¼šç¡®ä¿ Pod çš„èµ„æºè¯·æ±‚ï¼ˆCPUã€å†…å­˜ã€å­˜å‚¨ç­‰ï¼‰ç¬¦åˆèŠ‚ç‚¹çš„èµ„æºæƒ…å†µï¼Œé¿å…èµ„æºäº‰æŠ¢ã€‚
>
> ### **è°ƒåº¦ç­–ç•¥**
>
> #### 1. **èŠ‚ç‚¹äº²å’Œæ€§ï¼ˆNode Affinityï¼‰**
>
> Kubernetes æä¾›äº†èŠ‚ç‚¹äº²å’Œæ€§ï¼ˆNode Affinityï¼‰ï¼Œè®©ç”¨æˆ·èƒ½å¤ŸæŒ‡å®š Pod åº”è¯¥åœ¨å“ªäº›èŠ‚ç‚¹ä¸Šè¿è¡Œã€‚Node Affinity æ˜¯ä¸€ä¸ªæ›´çµæ´»çš„æ–¹å¼ï¼Œç±»ä¼¼äºŽæ ‡ç­¾é€‰æ‹©å™¨ï¼Œä½†æ”¯æŒæ›´å¤æ‚çš„é€»è¾‘ã€‚
>
> - **requiredDuringSchedulingIgnoredDuringExecution**ï¼šè¡¨ç¤º Pod å¿…é¡»è¢«è°ƒåº¦åˆ°æ»¡è¶³æ¡ä»¶çš„èŠ‚ç‚¹ä¸Šã€‚=>ç¡¬ç­–ç•¥
> - **preferredDuringSchedulingIgnoredDuringExecution**ï¼šè¡¨ç¤º Pod ä¼šå°½é‡è¢«è°ƒåº¦åˆ°æ»¡è¶³æ¡ä»¶çš„èŠ‚ç‚¹ä¸Šï¼Œä½†ä¸æ˜¯å¼ºåˆ¶è¦æ±‚ã€‚=>è½¯ç­–ç•¥
>
> ä¾‹å¦‚ï¼Œè¦æ±‚ Pod åªåœ¨ `zone=us-west1` çš„èŠ‚ç‚¹ä¸Šè¿è¡Œï¼š
>
> ```yaml
> affinity:
>   nodeAffinity:
>     requiredDuringSchedulingIgnoredDuringExecution:
>       nodeSelectorTerms:
>         - matchExpressions:
>             - key: "zone"
>               operator: In
>               values:
>                 - "us-west1"
> ```
>
> #### 2. **Pod äº²å’Œæ€§ï¼ˆPod Affinityï¼‰ä¸Žåäº²å’Œæ€§ï¼ˆAnti-Affinityï¼‰**
>
> Pod äº²å’Œæ€§å’Œåäº²å’Œæ€§å…è®¸ä½ æŒ‡å®š Pod åœ¨é€‰æ‹©èŠ‚ç‚¹æ—¶ä¸Žå…¶ä»– Pod çš„ä½ç½®å…³ç³»ã€‚Pod äº²å’Œæ€§è¦æ±‚ Pod åœ¨æŸäº›ç‰¹å®šæ¡ä»¶ä¸‹è¢«è°ƒåº¦åˆ°ç¦»ç‰¹å®š Pod å¾ˆè¿‘çš„èŠ‚ç‚¹ä¸Šï¼Œè€Œåäº²å’Œæ€§åˆ™è¦æ±‚ Pod ä¸è¦ä¸ŽæŸäº› Pod æ”¾ç½®åœ¨åŒä¸€ä¸ªèŠ‚ç‚¹æˆ–ç›¸è¿‘çš„èŠ‚ç‚¹ã€‚
>
> ä¾‹å¦‚ï¼Œè¦æ±‚æŸä¸ª Pod åœ¨åŒä¸€ä¸ªèŠ‚ç‚¹ä¸Šä¸Žå¦ä¸€ä¸ªç‰¹å®šæ ‡ç­¾çš„ Pod ä¸€èµ·è°ƒåº¦ï¼š
>
> ```yaml
> affinity:
>   podAffinity:
>     requiredDuringSchedulingIgnoredDuringExecution:
>       - labelSelector:
>           matchExpressions:
>             - key: "app"
>               operator: In
>               values:
>                 - "frontend"
>         topologyKey: "kubernetes.io/hostname"
> ```
>
> =>Node Affinity æ˜¯è·ŸæŸä¸ªå…·ä½“èŠ‚ç‚¹ï¼ˆå³æœåŠ¡å™¨ï¼‰å…³è”ï¼ŒPod Affinityåˆ™æ˜¯è·Ÿå¦ä¸€ä¸ªå…·ä½“çš„Podç›¸å…³è”
>
> #### 3. **æ±¡ç‚¹å’Œå®¹å¿åº¦ï¼ˆTaints and Tolerationsï¼‰**
>
> æ±¡ç‚¹ï¼ˆTaintsï¼‰æ˜¯èŠ‚ç‚¹çš„ä¸€ç§å±žæ€§ï¼Œç”¨äºŽæ ‡è®°èŠ‚ç‚¹ä¸Šçš„é™åˆ¶ï¼Œä½¿å¾—åªæœ‰å…·æœ‰å®¹å¿åº¦ï¼ˆTolerationsï¼‰æ ‡ç­¾çš„ Pod å¯ä»¥è¢«è°ƒåº¦åˆ°è¿™äº›èŠ‚ç‚¹ä¸Šã€‚è¿™ä¸ªç‰¹æ€§æœ‰åŠ©äºŽå°†æŸäº› Pod è°ƒåº¦åˆ°ä¸“é—¨çš„èŠ‚ç‚¹ï¼ˆä¾‹å¦‚ï¼Œä¸´æ—¶èŠ‚ç‚¹ã€ç‰¹å®šç¡¬ä»¶çš„èŠ‚ç‚¹ç­‰ï¼‰ã€‚
>
> - **Taint**ï¼šæ±¡ç‚¹æ˜¯èŠ‚ç‚¹çš„ä¸€ä¸ªå±žæ€§ï¼Œé€šå¸¸ä¼šè¢«æ·»åŠ åˆ°èŠ‚ç‚¹ä¸Šï¼Œè¡¨ç¤ºè¯¥èŠ‚ç‚¹åªæŽ¥å—å…·æœ‰ç‰¹å®šå®¹å¿åº¦çš„ Podã€‚
> - **Toleration**ï¼šå®¹å¿åº¦æ˜¯ Pod çš„ä¸€ä¸ªå±žæ€§ï¼Œç”¨äºŽå£°æ˜Žè¯¥ Pod å¯ä»¥è¢«è°ƒåº¦åˆ°å¸¦æœ‰ç‰¹å®šæ±¡ç‚¹çš„èŠ‚ç‚¹ä¸Šã€‚
>
> ä¾‹å¦‚ï¼ŒæŸä¸ªèŠ‚ç‚¹æœ‰æ±¡ç‚¹ `key=value:NoSchedule`ï¼Œåªæœ‰å¸¦æœ‰ `key=value` å®¹å¿åº¦çš„ Pod å¯ä»¥è°ƒåº¦åˆ°è¯¥èŠ‚ç‚¹ä¸Šï¼š
>
> ```yaml
> tolerations:
> - key: "key"
>   operator: "Equal"
>   value: "value"
>   effect: "NoSchedule"
> ```
>
> =>åƒmasterèŠ‚ç‚¹å¤©ç”Ÿå°±æ‰“äº† NoSchedule æ±¡ç‚¹ï¼Œæ‰€ä»¥åˆ†é…Podå…¨åŽ»nodeèŠ‚ç‚¹è¿˜ä¸å›žæ¥masterèŠ‚ç‚¹
>
> =>é™¤ä»¥ä¸Šä¹‹å¤–ï¼Œè¿˜å¯ä»¥ä¸ºPodç›´æŽ¥æŒ‡å®šNode...å³å›ºå®šèŠ‚ç‚¹è°ƒåº¦
>
> ### **æ€»ç»“**
>
> Kubernetes é›†ç¾¤è°ƒåº¦çš„æ ¸å¿ƒä»»åŠ¡æ˜¯å°† Pod è°ƒåº¦åˆ°åˆé€‚çš„èŠ‚ç‚¹ä¸Šï¼Œä»¥ç¡®ä¿èµ„æºçš„é«˜æ•ˆåˆ©ç”¨ã€åº”ç”¨çš„é«˜å¯ç”¨æ€§å’ŒæœåŠ¡çš„ç¨³å®šæ€§ã€‚è°ƒåº¦å™¨é€šè¿‡ä»¥ä¸‹å‡ ä¸ªä¸»è¦é˜¶æ®µå®Œæˆä»»åŠ¡ï¼š
>
> - **é¢„é€‰é˜¶æ®µ**ï¼šæ£€æŸ¥èŠ‚ç‚¹æ˜¯å¦æ»¡è¶³ Pod çš„åŸºæœ¬éœ€æ±‚ã€‚
> - **ä¼˜é€‰é˜¶æ®µ**ï¼šå¯¹æ»¡è¶³æ¡ä»¶çš„èŠ‚ç‚¹è¿›è¡Œæ‰“åˆ†ï¼Œå¹¶é€‰æ‹©æœ€ä½³èŠ‚ç‚¹ã€‚
> - **Pod ç»‘å®š**ï¼šå°† Pod ç»‘å®šåˆ°é€‰æ‹©çš„èŠ‚ç‚¹ï¼Œå¹¶å¯åŠ¨ Podã€‚
>
> é€šè¿‡ä½¿ç”¨ **èŠ‚ç‚¹äº²å’Œæ€§**ã€**Pod äº²å’Œæ€§**ã€**æ±¡ç‚¹å’Œå®¹å¿åº¦**ç­‰é«˜çº§è°ƒåº¦ç­–ç•¥ï¼ŒKubernetes ä½¿å¾—è°ƒåº¦è¿‡ç¨‹æ›´åŠ çµæ´»ï¼Œèƒ½å¤Ÿæ ¹æ®ä¸åŒçš„ä¸šåŠ¡éœ€æ±‚è¿›è¡Œç²¾ç»†çš„èµ„æºåˆ†é…ã€‚

### å®‰å…¨ 20241113

Kubernetes API Serveræ˜¯æ‰€æœ‰è¯·æ±‚çš„å…¥å£ï¼ŒK8Sçš„å®‰å…¨æœºåˆ¶ä¹Ÿæ˜¯å›´ç»•æ­¤æ¥å±•å¼€çš„ã€‚

èº«ä»½éªŒè¯ï¼ˆAuthentication)ï¼š

> Kubernetesçš„APIæœåŠ¡å™¨ï¼ˆAPI Serverï¼‰æ˜¯æ•´ä¸ªé›†ç¾¤çš„æ ¸å¿ƒç»„ä»¶ï¼Œå®ƒè´Ÿè´£å¤„ç†å¤–éƒ¨å’Œå†…éƒ¨çš„æ‰€æœ‰è¯·æ±‚ã€‚ä¸ºäº†ç¡®ä¿å®¢æˆ·ç«¯ä¸ŽAPIæœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡æ˜¯å®‰å…¨çš„ï¼ŒKubernetesé»˜è®¤è¦æ±‚é€šè¿‡**HTTPS**ï¼ˆå³HTTP over TLSï¼‰æ¥è®¿é—®APIã€‚æ‰€æœ‰APIè¯·æ±‚ï¼ŒåŒ…æ‹¬èº«ä»½éªŒè¯è¯·æ±‚ï¼Œéƒ½ä¼šä½¿ç”¨HTTPSæ¥è¿›è¡ŒåŠ å¯†ã€‚

K8så†…éƒ¨ç»„ä»¶è®¿é—®API Serverä¹Ÿæœ‰ä¸¤ç§å¯èƒ½ï¼Œä¸€ç§æ˜¯æœ¬æœºè®¿é—®ï¼Œç¬¬äºŒç§ä¹Ÿæ˜¯éœ€è¦HTTPSåŒå‘è®¤è¯çš„

æŽˆæƒï¼ˆAuthorizationï¼‰ï¼š

Authenticationåªæ˜¯ç¡®å®šé€šä¿¡åŒæ–¹æ˜¯å¯ä¿¡çš„ï¼Œè‡³äºŽè¯·æ±‚æ–¹æœ‰å“ªäº›èµ„æºçš„æƒé™åˆ™å–å†³äºŽAuthorization é‰´æƒã€‚

> Kubernetesçš„æŽˆæƒæœºåˆ¶ç”¨äºŽæŽ§åˆ¶ç”¨æˆ·æˆ–æœåŠ¡å¸æˆ·å¯¹èµ„æºçš„è®¿é—®æƒé™ï¼Œç¡®ä¿åªæœ‰è¢«æŽˆæƒçš„å®žä½“èƒ½å¤Ÿæ‰§è¡Œç‰¹å®šçš„æ“ä½œã€‚
>
> - **RBACï¼ˆRole-Based Access Controlï¼‰**ï¼šRBACæ˜¯Kubernetesçš„ä¸»è¦æŽˆæƒæœºåˆ¶ï¼Œå®ƒæ ¹æ®è§’è‰²ï¼ˆRoleï¼‰å’Œè§’è‰²ç»‘å®šï¼ˆRoleBindingï¼‰æ¥å®šä¹‰ç”¨æˆ·å¯¹èµ„æºçš„è®¿é—®æƒé™ã€‚é€šè¿‡RBACï¼Œå¯ä»¥ç»†ç²’åº¦åœ°æŽ§åˆ¶ç”¨æˆ·ã€æœåŠ¡å¸æˆ·ã€ç”šè‡³å¤–éƒ¨ç³»ç»Ÿå¯¹K8sèµ„æºçš„è®¿é—®ã€‚
> - **ABACï¼ˆAttribute-Based Access Controlï¼‰**ï¼šåŸºäºŽå±žæ€§çš„è®¿é—®æŽ§åˆ¶ï¼Œå…è®¸é€šè¿‡ç”¨æˆ·å±žæ€§ï¼ˆå¦‚éƒ¨é—¨ã€çŽ¯å¢ƒï¼‰æ¥æŽˆæƒè®¿é—®ã€‚
> - **WebhookæŽˆæƒ**ï¼šå¯ä»¥é€šè¿‡Webhookså°†K8sçš„æŽˆæƒæœºåˆ¶æ‰©å±•åˆ°å¤–éƒ¨ç³»ç»Ÿï¼Œè¿›è¡Œè‡ªå®šä¹‰æŽˆæƒã€‚

Role-Based Access Controlæ˜¯æœ€ä¸ºæµè¡Œçš„ï¼Œä¹Ÿæ˜¯K8sçš„é»˜è®¤è®¾ç½®

> åœ¨ Kubernetes ä¸­ï¼Œ`Role` å’Œ `ClusterRole` éƒ½æ˜¯ **RBAC (Role-Based Access Control)** çš„æ ¸å¿ƒæ¦‚å¿µï¼Œå®ƒä»¬ç”¨äºŽå®šä¹‰åœ¨é›†ç¾¤ä¸­å¯¹ä¸åŒèµ„æºçš„è®¿é—®æƒé™ã€‚äºŒè€…çš„ä¸»è¦åŒºåˆ«åœ¨äºŽä½œç”¨åŸŸå’Œåº”ç”¨èŒƒå›´ã€‚
>
> `ClusterRole` çš„æƒé™æ˜¯**é›†ç¾¤çº§åˆ«**çš„ã€‚å®ƒå¯ä»¥è·¨æ‰€æœ‰å‘½åç©ºé—´ï¼Œæˆ–è€…æŒ‡å®šé›†ç¾¤èŒƒå›´çš„èµ„æºï¼ˆå¦‚ Nodeã€PersistentVolumeã€Namespace ç­‰ï¼‰ã€‚

=>éƒ½æ˜¯é€šè¿‡YAMLæ–‡ä»¶æ¥å®šä¹‰çš„

=>Role-Based Access Controlä¸ŽAWSçš„IAMæœºåˆ¶å·®ä¸å¤š

### Helm 20241115

> **Helm** æ˜¯ Kubernetesï¼ˆK8sï¼‰ä¸­çš„ä¸€ä¸ªåŒ…ç®¡ç†å·¥å…·ï¼Œå®ƒç®€åŒ–äº†åº”ç”¨çš„éƒ¨ç½²å’Œç®¡ç†è¿‡ç¨‹ã€‚ç±»ä¼¼äºŽ Linux ä¸­çš„åŒ…ç®¡ç†å™¨ï¼ˆå¦‚ apt æˆ– yumï¼‰ï¼ŒHelm è®©ä½ èƒ½å¤Ÿè½»æ¾åœ°å®‰è£…ã€å‡çº§ã€åˆ é™¤å’Œç®¡ç† Kubernetes åº”ç”¨ã€‚
>
> ### Helm çš„æ ¸å¿ƒåŠŸèƒ½ï¼š
>
> 1. **ç®€åŒ–éƒ¨ç½²ï¼š** Helm é€šè¿‡å°† Kubernetes èµ„æºï¼ˆå¦‚ Podsã€Servicesã€Deployments ç­‰ï¼‰æ‰“åŒ…æˆä¸€ä¸ªç§°ä¸º **Chart** çš„åŒ…ï¼Œç®€åŒ–äº†åº”ç”¨çš„éƒ¨ç½²è¿‡ç¨‹ã€‚ä½ åªéœ€è¦ä¸€ä¸ªå‘½ä»¤å°±å¯ä»¥éƒ¨ç½²ä¸€ä¸ªå¤æ‚çš„åº”ç”¨ï¼Œè€Œä¸éœ€è¦æ‰‹åŠ¨ç®¡ç†å¤§é‡çš„ YAML æ–‡ä»¶ã€‚
> 2. **åº”ç”¨ç‰ˆæœ¬ç®¡ç†ï¼š** Helm ä½¿å¾—åº”ç”¨çš„ç‰ˆæœ¬æŽ§åˆ¶å˜å¾—å®¹æ˜“ã€‚ä½ å¯ä»¥é€šè¿‡ Helm å®‰è£…åº”ç”¨ï¼Œå¹¶ä¸”èƒ½å¤Ÿè½»æ¾åœ°å‡çº§åˆ°æ–°ç‰ˆæœ¬ï¼Œæˆ–è€…å›žæ»šåˆ°æ—§ç‰ˆæœ¬ã€‚
> 3. **æ¨¡æ¿åŒ–é…ç½®ï¼š** Helm ä½¿ç”¨ Go æ¨¡æ¿æ¥ç”Ÿæˆ Kubernetes é…ç½®æ–‡ä»¶ï¼Œè¿™æ ·å°±å¯ä»¥æ ¹æ®ä¸åŒçš„çŽ¯å¢ƒéœ€æ±‚è°ƒæ•´é…ç½®ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼ŒåŒä¸€ä¸ª Helm Chart å¯ä»¥åœ¨å¤šä¸ªçŽ¯å¢ƒä¸­é‡å¤ä½¿ç”¨ï¼Œåªéœ€è¦ä¿®æ”¹é…ç½®æ–‡ä»¶ä¸­çš„ä¸€äº›å˜é‡ã€‚
> 4. **ä¾èµ–ç®¡ç†ï¼š** Helm æ”¯æŒåœ¨å®‰è£…ä¸€ä¸ªåº”ç”¨æ—¶è‡ªåŠ¨å®‰è£…å®ƒçš„ä¾èµ–ã€‚ä¾‹å¦‚ï¼Œå¦‚æžœä¸€ä¸ªåº”ç”¨éœ€è¦æ•°æ®åº“æˆ–ç¼“å­˜æœåŠ¡ï¼ŒHelm å¯ä»¥è‡ªåŠ¨å®‰è£…å¹¶é…ç½®è¿™äº›ä¾èµ–æœåŠ¡ã€‚
> 5. **æ–¹ä¾¿çš„å‘½ä»¤è¡Œå·¥å…·ï¼š** Helm æä¾›äº†ä¸€å¥—å‘½ä»¤è¡Œå·¥å…·æ¥å¸®åŠ©ç”¨æˆ·ç®¡ç† Kubernetes åº”ç”¨ï¼Œæ¯”å¦‚ `helm install`ã€`helm upgrade`ã€`helm uninstall` ç­‰ã€‚
>
> ### Helm çš„æ ¸å¿ƒæ¦‚å¿µï¼š
>
> - **Chartï¼š** Helm ä¸­çš„æ ¸å¿ƒæ¦‚å¿µæ˜¯ **Chart**ï¼Œå®ƒæ˜¯ä¸€ä¸ªåŒ…å« Kubernetes èµ„æºå®šä¹‰çš„åŒ…ã€‚æ¯ä¸ª Chart å¯ä»¥åŒ…å«å¤šä¸ª YAML æ–‡ä»¶ï¼Œæè¿°äº†ä¸€ä¸ªåº”ç”¨çš„ä¸åŒéƒ¨åˆ†ï¼ˆå¦‚ Deploymentã€Serviceã€Ingress ç­‰ï¼‰ã€‚
> - **Releaseï¼š** æ¯æ¬¡ä½¿ç”¨ Helm éƒ¨ç½²ä¸€ä¸ª Chart æ—¶ï¼Œä¼šåˆ›å»ºä¸€ä¸ª **Release**ã€‚æ¯ä¸ª Release éƒ½æœ‰ä¸€ä¸ªåç§°ï¼Œè¡¨ç¤ºè¿™ä¸ª Chart åœ¨ Kubernetes é›†ç¾¤ä¸­çš„ä¸€ä¸ªå…·ä½“å®žä¾‹ã€‚
> - **Repositoryï¼š** Helm Chart å¯ä»¥å­˜æ”¾åœ¨ä¸€ä¸ª Helm ä»“åº“ä¸­ï¼Œç”¨æˆ·å¯ä»¥ä»Žä»“åº“ä¸­ä¸‹è½½å¹¶å®‰è£…å…¬å¼€æˆ–ç§æœ‰çš„ Chartsã€‚
>
> ### Helm çš„å·¥ä½œæµç¨‹ï¼š
>
> 1. **å®‰è£… Helmï¼š**
>    é¦–å…ˆéœ€è¦å®‰è£… Helm å®¢æˆ·ç«¯ï¼Œå¯ä»¥åœ¨æœ¬åœ°æ‰§è¡Œ Helm å‘½ä»¤ã€‚
>
> 2. **æ·»åŠ  Helm ä»“åº“ï¼š**
>    å¯ä»¥æ·»åŠ å®˜æ–¹æˆ–ç§æœ‰ Helm ä»“åº“ï¼Œæ¥èŽ·å–å…¬å¼€çš„ Chartã€‚ä¾‹å¦‚ï¼š
>
>    ```bash
>    helm repo add stable https://charts.helm.sh/stable
>    ```
>
> 3. **å®‰è£…åº”ç”¨ï¼š**
>    ä½¿ç”¨ Helm å®‰è£…åº”ç”¨ã€‚ä¾‹å¦‚ï¼Œå®‰è£… Nginx Ingress Controllerï¼š
>
>    ```bash
>    helm install my-nginx stable/nginx-ingress
>    ```
>
> 4. **ç®¡ç†å’Œå‡çº§åº”ç”¨ï¼š**
>    å¯ä»¥ä½¿ç”¨ Helm æ¥æŸ¥çœ‹ã€å‡çº§æˆ–å›žæ»šå·²å®‰è£…çš„åº”ç”¨ã€‚ä¾‹å¦‚ï¼š
>
>    ```bash
>    helm list           # æŸ¥çœ‹å·²å®‰è£…çš„ Helm Releases
>    helm upgrade        # å‡çº§åº”ç”¨
>    helm rollback       # å›žæ»šåˆ°ä¸Šä¸€ä¸ªç‰ˆæœ¬
>    ```
>
> 5. **åˆ é™¤åº”ç”¨ï¼š**
>    ä½¿ç”¨ Helm åˆ é™¤å·²éƒ¨ç½²çš„åº”ç”¨ï¼š
>
>    ```
>    helm uninstall my-nginx
>    ```
>
> ### ä¸¾ä¸ªä¾‹å­ï¼š
>
> å‡è®¾ä½ æƒ³å®‰è£…ä¸€ä¸ª Nginx åº”ç”¨ï¼Œä½¿ç”¨ Helm å¯ä»¥è¿™æ ·æ“ä½œï¼š
>
> ```
> helm install my-nginx stable/nginx-ingress
> ```
>
> è¿™æ¡å‘½ä»¤ä¼šå°† Nginx Ingress Controller å®‰è£…åˆ° Kubernetes é›†ç¾¤ä¸­ï¼Œå¹¶è‡ªåŠ¨ä¸ºå®ƒåˆ›å»ºç›¸å…³èµ„æºï¼ˆå¦‚ Deploymentã€Service ç­‰ï¼‰ã€‚
>
> ### æ€»ç»“ï¼š
>
> Helm å¤§å¤§ç®€åŒ–äº† Kubernetes åº”ç”¨çš„éƒ¨ç½²å’Œç®¡ç†ï¼Œå°¤å…¶æ˜¯åœ¨éœ€è¦éƒ¨ç½²å¤šä¸ªå¤æ‚åº”ç”¨æ—¶ï¼ŒHelm çš„æ¨¡æ¿åŒ–å’Œç‰ˆæœ¬æŽ§åˆ¶åŠŸèƒ½ä½¿å¾—é…ç½®æ›´åŠ çµæ´»å’Œå¯ç»´æŠ¤ã€‚å¯¹äºŽå¼€å‘è€…å’Œè¿ç»´äººå‘˜æ¥è¯´ï¼ŒHelm æ˜¯ Kubernetes çŽ¯å¢ƒä¸­éžå¸¸æœ‰ç”¨çš„å·¥å…·ã€‚

ä¸€ä¸ªç®€å•çš„Chart çš„ç»“æž„å¦‚ä¸‹ï¼š

```
myapp/
â”œâ”€â”€ Chart.yaml          # Chart çš„å…ƒæ•°æ®æ–‡ä»¶
â”œâ”€â”€ values.yaml         # é»˜è®¤çš„é…ç½®æ–‡ä»¶
â”œâ”€â”€ charts/             # å¯é€‰çš„ä¾èµ–åŒ…
â”œâ”€â”€ templates/          # å­˜æ”¾ Kubernetes èµ„æºæ¨¡æ¿æ–‡ä»¶
â”‚   â”œâ”€â”€ deployment.yaml # Deployment æ¨¡æ¿
â”‚   â”œâ”€â”€ service.yaml    # Service æ¨¡æ¿
â”‚   â””â”€â”€ ingress.yaml    # Ingress æ¨¡æ¿
â””â”€â”€ README.md           # Chart çš„æ–‡æ¡£è¯´æ˜Ž
```

> **Go æ¨¡æ¿è¯­æ³•**åœ¨ Helm ä¸­çš„ä½œç”¨æ˜¯å°†é™æ€çš„ YAML æ–‡ä»¶æ¨¡æ¿åŒ–ï¼Œä½¿å¾—ä½ å¯ä»¥æ ¹æ®ä¸åŒçš„é…ç½®ã€æ¡ä»¶å’ŒçŽ¯å¢ƒåŠ¨æ€ç”Ÿæˆ Kubernetes èµ„æºæ–‡ä»¶ã€‚

=>å¯ä»¥é…ç½®ä¸€ä¸ªKubernetesçš„ç½‘é¡µDashboardï¼Œå°±åƒAWSçš„ç•Œé¢ä¸€æ ·

> Prometheus æ˜¯ä¸€ä¸ªå¼ºå¤§çš„å¼€æºç›‘æŽ§å·¥å…·ï¼Œä¸“é—¨ä¸ºåˆ†å¸ƒå¼ç³»ç»Ÿã€å®¹å™¨åŒ–åº”ç”¨ä»¥åŠå¾®æœåŠ¡æž¶æž„è®¾è®¡ã€‚å®ƒè¢«å¹¿æ³›åº”ç”¨äºŽ Kubernetes é›†ç¾¤ã€äº‘åŽŸç”Ÿæž¶æž„ã€å®¹å™¨ç›‘æŽ§ç­‰é¢†åŸŸï¼Œæ˜¯çŽ°ä»£ DevOps å’Œäº‘åŽŸç”ŸçŽ¯å¢ƒä¸­ä¸å¯æˆ–ç¼ºçš„ç›‘æŽ§å·¥å…·ä¹‹ä¸€ã€‚

=>Prometheus æœ€ç»ˆä¹Ÿæ˜¯ä¸ª ç½‘é¡µGUIæ¥ç›‘è§† å®¹å™¨çš„å„ç§æ•°æ®ï¼ŒCPUå æœ‰çŽ‡å•¥çš„ï¼Œå¥½åƒéœ€è¦è·Ÿ**Grafana** ç»“åˆ

> **EFK** æ˜¯ä¸€ä¸ªå¹¿æ³›ä½¿ç”¨çš„æ—¥å¿—æ”¶é›†å’Œåˆ†æžæ ˆï¼Œé€šå¸¸ç”¨äºŽ Kubernetes é›†ç¾¤çš„æ—¥å¿—ç®¡ç†ã€‚EFK ç”±ä¸‰ä¸ªä¸»è¦ç»„ä»¶ç»„æˆï¼š
>
> - **Elasticsearch**ï¼šç”¨äºŽå­˜å‚¨å’ŒæŸ¥è¯¢æ—¥å¿—æ•°æ®ã€‚
> - **Fluentd**ï¼šæ—¥å¿—æ”¶é›†å™¨ï¼Œè´Ÿè´£ä»Žå„ä¸ªå®¹å™¨å’ŒèŠ‚ç‚¹ä¸­æ”¶é›†æ—¥å¿—ï¼Œé€šå¸¸ç”¨äºŽå°†æ—¥å¿—ä»Ž Kubernetes é›†ç¾¤æŽ¨é€åˆ° Elasticsearchã€‚
> - **Kibana**ï¼šä¸€ä¸ªå¯è§†åŒ–ç•Œé¢ï¼Œç”¨äºŽæ˜¾ç¤º Elasticsearch ä¸­å­˜å‚¨çš„æ—¥å¿—æ•°æ®ï¼Œæä¾›æŸ¥è¯¢å’Œåˆ†æžçš„åŠŸèƒ½ã€‚

=>ä¹Ÿå¯ä»¥è¯´é¢†ç”¨Helmå¯ä»¥ä¸‹è½½è®¸å¤šç»„ä»¶ç»™Kuberneteæ·»åŠ ä¸Šdashboardï¼Œç›‘è§†å·¥å…·ä»¥åŠæ—¥å¿—å·¥å…·

### é«˜å¯ç”¨k8sæž„å»º 20241118

æ— éžå°±æ˜¯ loader Balancerå¢žåŠ å‰¯æœ¬å®¹é”™ 

æž„å»ºå„èŠ‚ç‚¹çš„æ—¶å€™å¦‚åŒAnsibleé¡¹ç›®ä¸­æ‰€è¯´çš„å¯¹linux æœ‰å„ç§ é˜²ç«å¢™ å†…æ ¸å‚æ•°ä¿®æ”¹ ç­‰ç»†å¾®æ“ä½œ

ç„¶åŽå°±æ˜¯å»ºç«‹å¤šä¸ªmasterèŠ‚ç‚¹ï¼Œä¾æ¬¡å®‰è£…å„ä¸ªæ¨¡å—ä»¥åŠDockerï¼Œå¯ä»¥é¢„æƒ³ä¸ŽAnsibleç»“åˆèµ·æ¥ç”¨ï¼Œå¯¹linuxçš„æ“ä½œå‘½ä»¤è¡Œè¦å¾ˆç†Ÿ

## Ericsson AKS Demo Session 20250122

**Agenda**

- Introduction to Azure Kubernetes Service
- Managed Istio
- Open Service Mesh
- Managed Nginx Ingress in AKS
- GitOps
- Prometheus
- Service Connector (Preview)
- KEDA Addon
- Custom Resource Definition
- GitHub Copilot for AKS
- Application Gateway for Containers
- Azure Load Testing



Load Balancer Service Ingress Controllers - Layer 7 Load Balancing

Istio Gateway

Service Mesh -  Istio add-on for AKS (AKSæä¾›çš„ Istio æ’ä»¶ï¼Œç”¨äºŽç®¡ç†å¾®æœåŠ¡ä¹‹é—´çš„é€šä¿¡ï¼Œè®©æœåŠ¡é—´æµé‡ç®¡ç†ã€å®‰å…¨è®¤è¯ç­‰æ›´å®¹æ˜“æŽ§åˆ¶å’Œè§‚å¯Ÿ) =>ä¸ŽAzure Managed Grafana, Azure Managed Prometheusä¸€èµ·å·¥ä½œ

NGINX Ingress Controller - App Routing Addonï¼ˆåº”ç”¨è·¯ç”±æ’ä»¶ï¼‰

=>AKSæœ‰æ›´å¤šå¯ä»¥é›†æˆçš„æ’ä»¶ç»™Ingress Controllerï¼Œå³æ’å³ç”¨ï¼Œç»™developeræ›´å¥½çš„ä½¿ç”¨ä½“éªŒï¼Œä¸ç”¨æ‹…å¿ƒç‰ˆæœ¬å†²çªå•¥çš„

Application Gateway for Containers  => AKSé™¤äº†kubernetesä¸€èˆ¬å…·æœ‰çš„æµé‡å‡è¡¡è´Ÿè½½ï¼Œè¿˜å¯ä»¥æä¾›é›†æˆçš„firewall

> **GitOps**ï¼ˆGit Operationsï¼‰æ˜¯ä¸€ç§**åŸºç¡€è®¾æ–½è‡ªåŠ¨åŒ–å’Œåº”ç”¨äº¤ä»˜**çš„æ–¹æ³•ï¼Œå®ƒä½¿ç”¨ **Git ä½œä¸ºå•ä¸€äº‹å®žæ¥æºï¼ˆSingle Source of Truthï¼‰**ï¼Œå¹¶ç»“åˆ **CI/CD æµç¨‹** æ¥è‡ªåŠ¨åŒ–éƒ¨ç½²å’Œç®¡ç† Kubernetes ç­‰äº‘åŽŸç”ŸçŽ¯å¢ƒã€‚
>
> ç®€å•æ¥è¯´ï¼ŒGitOps **æŠŠ Git å½“ä½œé…ç½®ç®¡ç†å·¥å…·**ï¼Œè®©å¼€å‘å›¢é˜Ÿå¯ä»¥åƒç®¡ç†ä»£ç ä¸€æ ·ç®¡ç†åŸºç¡€è®¾æ–½å’Œåº”ç”¨éƒ¨ç½²ã€‚

 =>VScodeä¸­ä¸‹è½½GitHub Copilot for Azure

> GitHub Copilot æ˜¯**AI ä»£ç åŠ©æ‰‹**ï¼Œå¯ä»¥å¸®åŠ©å¼€å‘è€…**æ›´å¿«åœ°ç¼–å†™ Kubernetes ç›¸å…³çš„ YAMLã€Helm Charts ä»¥åŠ CI/CD è„šæœ¬**ã€‚

# Docker

## å°šç¡…è°·Dockerå®žæˆ˜æ•™ç¨‹

[Link](https://www.bilibili.com/video/BV1gr4y1U7CY/?spm_id_from=333.337.search-card.all.click&vd_source=c13700902d2c98df282b6f1f2889c0cb)

### æ•™ç¨‹ç®€ä»‹ 20241127

1. Dockerç®€ä»‹
2. Dockerå®‰è£…
3. Dockerå¸¸ç”¨å‘½ä»¤
4. Dockeré•œåƒ
5. æœ¬åœ°é•œåƒå‘å¸ƒåˆ°é˜¿é‡Œäº‘
6. æœ¬åœ°é•œåƒå‘å¸ƒåˆ°ç§æœ‰åº“
7. Dockerå®¹å™¨æ•°æ®å·
8. Dockerå¸¸è§„å®‰è£…ç®€ä»‹

è¿›é˜¶ï¼š

1. Dockerå¤æ‚å®‰è£…è¯¦è¯´
2. DockerFileè§£æž
3. Dockerå¾®æœåŠ¡å®žæˆ˜
4. Dockerç½‘ç»œ
5. Docker-composeå®¹å™¨ç¼–æŽ’
6. Dockerè½»é‡çº§å¯è§†åŒ–å·¥å…·Portainer
7. Dockerå®¹å™¨ç›‘æŽ§ä¹‹CADvisor+InfulxDB+Granfana



### Dockerç®€ä»‹ 20241211

ç³»ç»ŸçŽ¯å¢ƒå¹³æ»‘ç§»æ¤

ä»Žç³»ç»ŸçŽ¯å¢ƒå¼€å§‹ï¼Œè‡ªåº•è‡³ä¸Šæ‰“åŒ…åº”ç”¨ã€‚åƒè™šæ‹Ÿæœºä¸€æ ·ä¸€ä¸ªisoæ–‡ä»¶æžå®šä¸€åˆ‡ã€‚

=>å…ˆå®‰è£…Dockerï¼Œç„¶åŽç”¨è¿™ä¸ªå·¥å…·è¿è¡Œisoæ–‡ä»¶å°±è¡Œ

ä¼ ç»Ÿè™šæ‹Ÿæœº å¯åŠ¨å¤ªæ…¢ï¼Œå ç”¨èµ„æºåˆå¤šï¼Œä»Žè€Œä¼˜åŒ–å‘å±•å‡ºæ¥ å®¹å™¨è™šæ‹ŸåŒ–æŠ€æœ¯

å®˜ç½‘ + é•œåƒä»“åº“

Dockerså¿…é¡»éƒ¨ç½²åœ¨Linuxå†…æ ¸çš„ç³»ç»Ÿä¸Šã€‚å¦‚æžœWindowsä¸Šéƒ¨ç½²Dockerçš„æ–¹æ³•éƒ½æ˜¯å…ˆå®‰è£…ä¸€ä¸ªè™šæ‹Ÿæœº

> Docker Desktop for Windowsåˆ©ç”¨ WSL2 æä¾›ä¸€ä¸ª Linux å†…æ ¸çŽ¯å¢ƒï¼ŒDocker çš„å®¹å™¨å’Œé•œåƒå®žé™…è¿è¡Œåœ¨è¿™ä¸ª WSL2 çŽ¯å¢ƒä¸­ã€‚

Dockerä¸‰è¦ç´ ï¼šé•œåƒimageï¼Œå®¹å™¨containerï¼Œä»“åº“repository =>å®¹å™¨å¯ä»¥çœ‹æˆæ˜¯é•œåƒçš„å®žä¾‹åŒ–

> **WSL**ï¼šWSLé€šè¿‡æ“ä½œç³»ç»Ÿçº§åˆ«çš„è™šæ‹ŸåŒ–æ¥è¿è¡ŒLinuxçŽ¯å¢ƒã€‚ç‰¹åˆ«æ˜¯WSL 1ï¼Œå®ƒé€šè¿‡åœ¨Windowsä¸Šæ¨¡æ‹ŸLinuxå†…æ ¸çš„ç³»ç»Ÿè°ƒç”¨æ¥è¿è¡ŒLinuxåº”ç”¨ç¨‹åºï¼Œè€ŒWSL 2å¼•å…¥äº†ä¸€ä¸ªè½»é‡çº§çš„è™šæ‹Ÿæœºæ¥è¿è¡Œä¸€ä¸ªå®Œæ•´çš„Linuxå†…æ ¸ï¼Œä½†å®ƒå¹¶ä¸æ˜¯æ¨¡æ‹Ÿæ•´ä¸ªè®¡ç®—æœºç¡¬ä»¶çš„è™šæ‹Ÿæœºï¼Œè€Œæ˜¯ä¸€ä¸ªè™šæ‹ŸåŒ–çš„Linuxå†…æ ¸çŽ¯å¢ƒã€‚
>
> **è™šæ‹Ÿæœº**ï¼šè™šæ‹Ÿæœºæ˜¯ç¡¬ä»¶çº§åˆ«çš„è™šæ‹ŸåŒ–ï¼Œæ¯ä¸ªè™šæ‹Ÿæœºè¿è¡Œä¸€ä¸ªå®Œæ•´çš„æ“ä½œç³»ç»Ÿï¼ˆåŒ…æ‹¬ç‹¬ç«‹çš„å†…æ ¸ï¼‰ï¼Œå¹¶ä¸”æ¨¡æ‹Ÿäº†è®¡ç®—æœºç¡¬ä»¶çš„æ‰€æœ‰éƒ¨åˆ†ï¼Œå¦‚CPUã€å†…å­˜ã€ç¡¬ç›˜å’Œç½‘ç»œç­‰ã€‚
>
> **WSLæ›´æŽ¥è¿‘äºŽæ“ä½œç³»ç»Ÿçº§è™šæ‹ŸåŒ–ï¼Œè€Œè™šæ‹Ÿæœºåˆ™æ˜¯ç¡¬ä»¶çº§è™šæ‹ŸåŒ–**ï¼ŒäºŒè€…çš„è™šæ‹ŸåŒ–æ–¹å¼ä¸åŒã€‚
>
> **WSL**ï¼ˆWindows Subsystem for Linuxï¼‰æ›´æŽ¥è¿‘äºŽ**å®¹å™¨è™šæ‹ŸåŒ–æŠ€æœ¯**ï¼Œå°¤å…¶æ˜¯WSL 2ï¼Œå®ƒä¸Žå®¹å™¨åŒ–æŠ€æœ¯åœ¨ä¸€äº›æ–¹é¢æœ‰ç›¸ä¼¼ä¹‹å¤„ã€‚

Dockerå°±æ˜¯ä¸“é—¨ç”¨äºŽCICDéƒ¨ç½²çš„ï¼Œè€ŒWSLæ›´åå‘ä¸€ä¸ªè™šæ‹ŸåŒ–å¼€å‘çŽ¯å¢ƒ

å¯ä»¥æŠŠå®¹å™¨çœ‹åšä¸€ä¸ªç®€æ˜“ç‰ˆçš„LinuxçŽ¯å¢ƒ(åŒ…æ‹¬rootç”¨æˆ·æžé™ï¼Œè¿›ç¨‹ç©ºé—´ï¼Œç”¨æˆ·ç©ºé—´å’Œç½‘ç»œç©ºé—´ç­‰)å’Œè¿è¡Œåœ¨å…¶ä¸­çš„åº”ç”¨ç¨‹åºã€‚

æ³¨æ„ Docker daemonçš„æ¦‚å¿µæ‰€åœ¨çš„ä½ç½®ï¼Œå®ƒåœ¨containerä¹‹å¤–

> Docker çš„æž¶æž„éµå¾ªäº†å…¸åž‹çš„å®¢æˆ·ç«¯-æœåŠ¡å™¨C/Sæ¨¡å¼ï¼Œä¸»è¦ç”± **Docker å®¢æˆ·ç«¯** å’Œ **Docker å®ˆæŠ¤è¿›ç¨‹ï¼ˆDaemonï¼‰** ä¸¤éƒ¨åˆ†ç»„æˆã€‚

Dockerè¿è¡Œrunå‘½ä»¤ï¼ŒçŽ°åœ¨æœ¬åœ°å¯»æ‰¾ç›¸å…³é•œåƒï¼Œæ²¡æœ‰å°±åŽ»Hubä¸Šå¯»æ‰¾å¹¶ä¸‹è½½



Dockerä¸ºä»€ä¹ˆæ¯”è™šæ‹Ÿæœºå¿«ï¼š

1. dockerä¸éœ€è¦Hypervisor(è™šæ‹Ÿæœº)å®žçŽ°ç¡¬ä»¶èµ„æºè™šæ‹ŸåŒ–ï¼Œè¿è¡Œåœ¨dockerå®¹å™¨ä¸Šçš„ç¨‹åºç›´æŽ¥ä½¿ç”¨çš„éƒ½æ˜¯å®žé™…ç‰©ç†æœºçš„ç¡¬ä»¶èµ„æºã€‚
2. dockeråˆ©ç”¨çš„æ˜¯å®¿ä¸»æœºçš„å†…æ ¸ï¼Œè€Œä¸éœ€è¦åŠ è½½æ“ä½œç³»ç»ŸOSå†…æ ¸ã€‚æ–°å»ºè™šæ‹Ÿæœºæ˜¯å‡ åˆ†é’Ÿçº§åˆ«çš„ï¼Œè€Œæ–°å»ºdockerå°±æ˜¯å‡ ç§’é’Ÿ

è™šæ‹Ÿæœºï¼šOS => Hypervisor => OS =>Appllication

Dockersï¼šOS => Docker => Application



### Dockerå¸¸ç”¨å‘½ä»¤ 20241213

```bash
#å¸®åŠ©å¯åŠ¨ç±»å‘½ä»¤
sudo systemctl start docker
sudo systemctl stop docker
sudo systemctl restart docker
sudo systemctl enable docker
#é•œåƒå‘½ä»¤
docker images
docker pull <é•œåƒå>:<æ ‡ç­¾>
#å®¹å™¨å‘½ä»¤
docker run -d -p <å®¿ä¸»ç«¯å£>:<å®¹å™¨ç«¯å£> --name <å®¹å™¨å> <é•œåƒå>
docker run -d -p 8080:80 --name my-nginx nginx #ç¤ºä¾‹
docker ps
docker start <å®¹å™¨IDæˆ–åç§°> #å¯åŠ¨å·²åœæ­¢è¿è¡Œçš„å®¹å™¨
docker stop <å®¹å™¨IDæˆ–åç§°>
docker rm <å®¹å™¨IDæˆ–åç§°>
docker exec -it <å®¹å™¨IDæˆ–åç§°> /bin/bash #è¿›å…¥åŽå°å¼å®¹å™¨
docker cp <å®¹å™¨ID>:<å®¹å™¨è·¯å¾„> <æœ¬åœ°è·¯å¾„> #ä»Žå®¹å™¨ä¸­å¤åˆ¶æ–‡ä»¶åˆ°æœ¬åœ°
```

docker runä¹‹åŽå°±è¿›å…¥dockerå®¹å™¨çš„äº¤äº’è¡Œäº†ï¼Œlsä¸€ä¸‹å¥½åƒlinuxä»€ä¹ˆéƒ½é½å…¨ï¼Œä½†æ˜¯æ¯”å¦‚vimè¿™äº›å‘½ä»¤è‚¯å®šå°±æ²¡æœ‰äº†ï¼Œä¸æ˜¯Linuxå†…æ ¸çš„ä¸œè¥¿dockerä¸ä¼šè£…ä¸ŠåŽ»ï¼Œå°½å¯èƒ½ç˜¦èº«ã€‚

ä¸¤ç§é€€å‡ºæ–¹å¼ï¼š

1. exitï¼Œrunè¿›åŽ»å®¹å™¨ï¼Œexité€€å‡ºï¼Œå®¹å™¨åœæ­¢
2. ctrl+p+q   runè¿›åŽ»å®¹å™¨ï¼Œctrl+p+qé€€å‡ºï¼Œå®¹å™¨ä¸åœæ­¢

### Dockeré•œåƒ 20241218

>  **UnionFS (Union File System)** æ˜¯ä¸€ç§åˆ†å±‚æ–‡ä»¶ç³»ç»Ÿï¼Œå®ƒæ˜¯å®¹å™¨é•œåƒçš„åŸºç¡€æŠ€æœ¯ä¹‹ä¸€ã€‚

> ### **1. ä»€ä¹ˆæ˜¯ bootfs å’Œ rootfsï¼Ÿ**
>
> åœ¨å®¹å™¨çš„æ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œæœ‰ä¸¤ä¸ªæ ¸å¿ƒæ¦‚å¿µï¼š
>
> - **bootfs (Boot File System)**ï¼šç±»ä¼¼äºŽä¼ ç»Ÿ Linux ç³»ç»Ÿä¸­çš„å†…æ ¸æ–‡ä»¶ç³»ç»Ÿï¼ŒåŒ…æ‹¬å†…æ ¸ä»¥åŠåˆå§‹åŒ–ç³»ç»Ÿï¼ˆinitrd/initramfsï¼‰ã€‚å®ƒä¸ºå®¹å™¨æä¾›æœ€åŸºæœ¬çš„è¿è¡ŒçŽ¯å¢ƒã€‚
> - **rootfs (Root File System)**ï¼šLinux çš„æ ¹æ–‡ä»¶ç³»ç»Ÿï¼ŒåŒ…å« `/bin`, `/etc`, `/usr`, `/var` ç­‰ç›®å½•å’Œæ–‡ä»¶ã€‚å®ƒæ˜¯å®¹å™¨ç”¨æˆ·æ€çš„è¿è¡ŒçŽ¯å¢ƒã€‚
>
> åœ¨å®¹å™¨å¯åŠ¨æ—¶ï¼Œ**bootfs** ä¼šåŠ è½½å†…æ ¸å’ŒåŸºæœ¬è¿è¡ŒçŽ¯å¢ƒï¼ŒéšåŽä¼šè¢«å¸è½½ï¼Œè€Œå®¹å™¨ä¸»è¦è¿è¡Œåœ¨ **rootfs** ä¸Šã€‚
>
> ### **2. UnionFS çš„ç®€å•ç»“æž„**
>
> UnionFS çš„æ ¸å¿ƒæ˜¯åˆ†å±‚çš„æ–‡ä»¶ç³»ç»Ÿç»“æž„ã€‚åœ¨ Docker ä¸­ï¼š
>
> - æ¯ä¸ªé•œåƒæ˜¯ç”±å¤šä¸ªå±‚ç»„æˆçš„ï¼Œåº•å±‚æ˜¯åŸºç¡€é•œåƒï¼ˆå¦‚ `alpine` æˆ– `ubuntu`ï¼‰ï¼Œä¸Šå±‚æ˜¯ç”¨æˆ·ä¿®æ”¹æˆ–æ·»åŠ çš„æ–‡ä»¶ã€‚
> - å®¹å™¨å¯åŠ¨åŽï¼Œä¼šåœ¨é•œåƒé¡¶éƒ¨åˆ›å»ºä¸€ä¸ª**å¯å†™å±‚**ã€‚
>
> ä¸€ä¸ªç®€å•çš„ UnionFS ç»“æž„å¦‚ä¸‹ï¼š
>
> ```
> /bootfs   (å·²å¸è½½ï¼Œä»…ç”¨äºŽå¯åŠ¨)
> /rootfs
>  â”œâ”€â”€ Layer 1 (åŸºç¡€é•œåƒå±‚ï¼Œread-only)
>  â”œâ”€â”€ Layer 2 (å®‰è£…äº†è½¯ä»¶åŒ…çš„å¢žé‡å±‚ï¼Œread-only)
>  â”œâ”€â”€ Layer 3 (ç”¨æˆ·é…ç½®å±‚ï¼Œread-only)
>  â””â”€â”€ Writeable Layer (å®¹å™¨çš„å¯å†™å±‚)
> ```
>
> ### **3. é€æ­¥åˆ†æžä¸€ä¸ªç®€å•çš„ UnionFS æ¡ˆä¾‹**
>
> #### **(1) åŸºç¡€é•œåƒå±‚**
>
> å‡è®¾ä¸€ä¸ªå®¹å™¨ä»¥ `ubuntu` é•œåƒä¸ºåŸºç¡€ï¼š
>
> - ç¬¬ä¸€å±‚æ˜¯åŸºç¡€é•œåƒï¼Œæä¾›äº†æœ€å°åŒ–çš„æ ¹æ–‡ä»¶ç³»ç»Ÿï¼ˆå¦‚ `/bin/bash`ï¼‰ã€‚
> - è¿™æ˜¯ä¸€ä¸ªåªè¯»å±‚ï¼Œä¸ä¼šå› å®¹å™¨çš„è¿è¡Œè€Œæ”¹å˜ã€‚
>
> å†…å®¹ç¤ºä¾‹ï¼š
>
> ```
> bashCopy codeLayer 1:
>   /bin/bash
>   /etc/passwd
> ```
>
> #### **(2) ç”¨æˆ·ä¿®æ”¹æˆ–å®‰è£…å±‚**
>
> åœ¨æž„å»ºé•œåƒæ—¶ï¼Œç”¨æˆ·å¯èƒ½æ·»åŠ äº†æ–°çš„è½¯ä»¶æˆ–æ–‡ä»¶ï¼Œè¿™äº›æ›´æ”¹ä¼šå½¢æˆæ–°çš„åªè¯»å±‚ï¼š
>
> - ç”¨æˆ·é€šè¿‡ `RUN apt-get install` æˆ–å…¶ä»–å‘½ä»¤å®‰è£…äº†é¢å¤–çš„è½¯ä»¶ã€‚
> - ç”Ÿæˆç¬¬äºŒå±‚ï¼Œè®°å½•å¢žé‡ä¿®æ”¹ï¼ˆå¦‚æ–°æ–‡ä»¶æˆ–æ›´æ”¹çš„æ–‡ä»¶ï¼‰ã€‚
>
> å†…å®¹ç¤ºä¾‹ï¼š
>
> ```
> rubyCopy codeLayer 2:
>   /usr/bin/python3
>   /etc/apt/sources.list
> ```
>
> #### **(3) å®¹å™¨å¯å†™å±‚**
>
> å½“å®¹å™¨è¿è¡Œæ—¶ï¼š
>
> - ç³»ç»Ÿä¸ºé•œåƒæ·»åŠ ä¸€ä¸ªå¯å†™å±‚ï¼Œæ‰€æœ‰çš„å†™æ“ä½œéƒ½ä¼šåœ¨è¿™å±‚æ‰§è¡Œã€‚
> - ä»»ä½•ä¿®æ”¹ï¼ˆå¦‚æ–°å¢žæ–‡ä»¶ã€ä¿®æ”¹é…ç½®ï¼‰éƒ½åªå½±å“è¿™ä¸€å±‚ï¼Œä¸ä¼šæ”¹å˜åº•å±‚çš„åªè¯»å±‚ã€‚
>
> å†…å®¹ç¤ºä¾‹ï¼š
>
> ```
> bashCopy codeWriteable Layer:
>   /tmp/newfile.txt
>   /etc/hostname  (è¦†ç›– Layer 1 çš„æ–‡ä»¶)
> ```
>
> ------
>
> ### **4. UnionFS çš„åˆæˆæ–‡ä»¶ç³»ç»Ÿ**
>
> å®¹å™¨å†…å®žé™…çœ‹åˆ°çš„æ–‡ä»¶ç³»ç»Ÿæ˜¯ç”± UnionFS åˆæˆçš„ï¼š
>
> - ç”¨æˆ·åªä¼šçœ‹åˆ°ä¸€ä¸ªæ•´ä½“çš„æ–‡ä»¶ç³»ç»Ÿã€‚
> - æŸ¥æ‰¾æ–‡ä»¶æ—¶ï¼ŒUnionFS ä¼šä»Žé¡¶éƒ¨å‘åº•å±‚é€å±‚æœç´¢ï¼Œæ‰¾åˆ°ç¬¬ä¸€ä¸ªåŒ¹é…çš„æ–‡ä»¶ã€‚
>
> æœ€ç»ˆåˆæˆç»“æžœï¼š
>
> ```
> bashCopy code/
> â”œâ”€â”€ /bin/bash          (æ¥è‡ª Layer 1)
> â”œâ”€â”€ /usr/bin/python3   (æ¥è‡ª Layer 2)
> â”œâ”€â”€ /tmp/newfile.txt   (æ¥è‡ª Writeable Layer)
> â”œâ”€â”€ /etc/passwd        (æ¥è‡ª Layer 1)
> â””â”€â”€ /etc/hostname      (æ¥è‡ª Writeable Layerï¼Œè¦†ç›– Layer 1)
> ```
>
> ------
>
> ### **5. ç»†èŠ‚ï¼šå†™æ—¶å¤åˆ¶ï¼ˆCopy-on-Writeï¼‰**
>
> å½“å®¹å™¨å°è¯•ä¿®æ”¹ä¸€ä¸ªæ¥è‡ªåªè¯»å±‚çš„æ–‡ä»¶æ—¶ï¼ŒUnionFS ä¼šæ‰§è¡Œ **å†™æ—¶å¤åˆ¶**ï¼š
>
> 1. å°†ç›®æ ‡æ–‡ä»¶ä»Žåªè¯»å±‚å¤åˆ¶åˆ°å¯å†™å±‚ã€‚
> 2. ä¿®æ”¹æ–‡ä»¶çš„å‰¯æœ¬ï¼ŒåŽŸå§‹æ–‡ä»¶ä¿æŒä¸å˜ã€‚
>
> ä¾‹å¦‚ï¼š
>
> - ä¿®æ”¹ `/etc/hostname` æ—¶ï¼ŒåŽŸå§‹æ–‡ä»¶åœ¨ Layer 1 ä¿æŒä¸å˜ã€‚
> - å¯å†™å±‚åˆ›å»º `/etc/hostname` çš„å‰¯æœ¬ï¼Œå®¹å™¨åªä¼šçœ‹åˆ°å‰¯æœ¬çš„ä¿®æ”¹ç»“æžœã€‚
>
> ------
>
> ### **6. æ€»ç»“**
>
> é€šè¿‡ **bootfs** å’Œ **rootfs** çš„åˆ†ç¦»ï¼Œä»¥åŠ UnionFS çš„åˆ†å±‚æœºåˆ¶ï¼ŒDocker å®žçŽ°äº†ä»¥ä¸‹ä¼˜åŠ¿ï¼š
>
> 1. **å¿«é€Ÿå¯åŠ¨**ï¼šbootfs ä»…ç”¨äºŽåŠ è½½å†…æ ¸ï¼Œéšå³å¸è½½ï¼Œrootfs æä¾›ç”¨æˆ·æ€çŽ¯å¢ƒã€‚
> 2. **é«˜æ•ˆå­˜å‚¨**ï¼šåˆ†å±‚æ–‡ä»¶ç³»ç»Ÿå‡å°‘äº†é‡å¤å­˜å‚¨ã€‚
> 3. **å†™æ—¶éš”ç¦»**ï¼šå®¹å™¨çš„ä¿®æ”¹ä»…å½±å“å¯å†™å±‚ï¼Œä¸ä¼šæ±¡æŸ“åº•å±‚é•œåƒã€‚
>
> å¦‚æžœæœ‰è¿›ä¸€æ­¥çš„é—®é¢˜ï¼Œå¯ä»¥æ·±å…¥è®¨è®º UnionFS çš„å®žçŽ°ç»†èŠ‚æˆ–æ‰©å±•åˆ°å…·ä½“æ–‡ä»¶ç³»ç»Ÿï¼ˆå¦‚ OverlayFSï¼‰çš„æ¡ˆä¾‹ï¼

=>ä¸‹è½½ä¸€ä¸ªUbuntué•œåƒï¼Œç”¨aptä¸‹è½½vimï¼Œç”¨docker commitæäº¤å®¹å™¨å‰¯æœ¬ä½¿ä¹‹æˆä¸ºæœ¬åœ°çš„ä¸€ä¸ªæ–°çš„é•œåƒï¼Œæœ€ç®€å•çš„Dockeré•œåƒ70M,åŠ äº†ä¸€ä¸ªvimå°±doubleäº†...è·Ÿgitä¸€æ ·è¿˜å¯ä»¥docker pushæŽ¨é€åˆ°é˜¿é‡Œäº‘ä¸ŠåŽ»



### Dockerå®¹å™¨æ•°æ®å· 20250116

> Docker å®¹å™¨ä¸­çš„æ•°æ®å·ï¼ˆVolumesï¼‰æ˜¯ Docker ç”¨äºŽå®žçŽ°æ•°æ®æŒä¹…åŒ–å’Œå®¹å™¨ä¹‹é—´æ•°æ®å…±äº«çš„ä¸€ç§æœºåˆ¶ã€‚æ•°æ®å·çš„ä¸»è¦ç‰¹ç‚¹æ˜¯å®ƒç‹¬ç«‹äºŽå®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸï¼Œå¯ä»¥ç”¨äºŽå­˜å‚¨æ•°æ®ï¼Œå³ä½¿å®¹å™¨è¢«åˆ é™¤ï¼Œæ•°æ®å·ä¸­çš„æ•°æ®ä¾ç„¶ä¿ç•™ã€‚

å°†dockerå®¹å™¨å†…çš„æ•°æ®ä¿å­˜è¿›å®¿ä¸»æœºçš„ç£ç›˜ä¸­

=> æ•°æ®å·å¯ä»¥æŒ‚è½½åˆ°å®¿ä¸»æœºæŸä¸€ä¸ªè·¯å¾„ä¸Šï¼Œæ•°æ®å·ä¸Ždockeräº’ç›¸åæ˜ æ•°æ®å˜åŒ–ï¼Œæ¯”å¦‚åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ä»€ä¹ˆçš„ï¼ŒåŒå‘å½±å“

=>Volumes ä¸Žå…¶çœ‹ä½œæ˜¯ä¸ªâ€œç›˜â€ï¼Œä¸å¦‚è¯´çœ‹æˆä¸€ç§ æŒ‚è½½çš„ æ˜ å°„å…³ç³»ï¼Œæ‰€è°“å®¹å™¨Bç»§æ‰¿å®¹å™¨Açš„Volumeså…¶å®žå°±æ˜¯èŽ·å–è¿™ä¸ª æ˜ å°„å…³ç³»ï¼Œæ‰€ä»¥å³ä¾¿å®¹å™¨AæŒ‚äº†ï¼Œä¹Ÿä¸å½±å“å®¹å™¨Bç»§ç»­ä½¿ç”¨è¿™ä¸ª æ˜ å°„å…³ç³»



dockerhubä¸Šæœç´¢ tomcat,mysqlï¼Œæ‹‰ä¸‹æ¥åˆ›å»ºå®žä¾‹ï¼Œé…ç½®ç«¯å£ï¼Œè¿è¡Œ

### Dockerfileç®€ä»‹ 20250129

ç›¸å½“äºŽlinuxçš„shellè„šæœ¬ï¼Œä½œç”¨ä¸Žå¤šæ¬¡æäº¤commitå½¢æˆçš„æ–°é•œåƒä¸€æ · 

> **Dockerfile** æ˜¯ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ï¼ŒåŒ…å«ä¸€ç³»åˆ—æŒ‡ä»¤ï¼Œç”¨äºŽè‡ªåŠ¨åŒ–æž„å»º Docker é•œåƒã€‚é€šè¿‡ Dockerfileï¼Œç”¨æˆ·å¯ä»¥å®šä¹‰é•œåƒçš„æž„å»ºæ­¥éª¤ï¼ŒåŒ…æ‹¬åŸºç¡€é•œåƒçš„é€‰æ‹©ã€è½¯ä»¶å®‰è£…ã€æ–‡ä»¶å¤åˆ¶ã€çŽ¯å¢ƒå˜é‡è®¾ç½®ç­‰ã€‚Docker æ ¹æ® Dockerfile ä¸­çš„æŒ‡ä»¤é€æ­¥æž„å»ºé•œåƒã€‚

ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„ Dockerfile ç¤ºä¾‹ï¼Œç”¨äºŽæž„å»ºä¸€ä¸ªè¿è¡Œ Python åº”ç”¨çš„é•œåƒï¼š

```dockerfile
# ä½¿ç”¨å®˜æ–¹ Python é•œåƒä½œä¸ºåŸºç¡€é•œåƒ
FROM python:3.8-slim

# è®¾ç½®å·¥ä½œç›®å½•ï¼Œç»ˆç«¯é»˜è®¤è¿›å…¥çš„è½è„šç‚¹
WORKDIR /app

# å¤åˆ¶å½“å‰ç›®å½•å†…å®¹åˆ°å®¹å™¨çš„ /app ç›®å½•
COPY . /app

# å®‰è£…ä¾èµ–
# RUN ç­‰åŒäºŽï¼Œåœ¨ç»ˆç«¯æ“ä½œçš„shellå‘½ä»¤
RUN pip install --no-cache-dir -r requirements.txt

# æš´éœ²ç«¯å£
EXPOSE 80

# è®¾ç½®çŽ¯å¢ƒå˜é‡
ENV NAME World

# è¿è¡Œåº”ç”¨
CMD ["python", "app.py"]
```

ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æž„å»ºé•œåƒï¼š

```shell
#docker build æ˜¯ Docker æä¾›çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œç”¨äºŽæ ¹æ® Dockerfile ä¸­çš„æŒ‡ä»¤æž„å»ºé•œåƒã€‚
docker build -t my-python-app
docker run -p 4000:80 my-python-app
```



å¸¸ç”¨ä¿ç•™å­—æŒ‡ä»¤å‡æ˜¯å¤§å†™ï¼Œå¦‚ FROM

æ¯æ¡æŒ‡ä»¤éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„é•œåƒå±‚å¯¹é•œåƒè¿›è¡Œæäº¤

dockerhubä¸Šæ‹‰ä¸‹æ¥çš„é•œåƒåŸºæœ¬ä¸Šæœ€åŽéƒ½ä¼šæœ‰ä¸€ä¸ªdockerfileä½œä¸ºç†è®ºæ”¯æŒ

> `FROM` æŒ‡ä»¤ä¸­çš„é•œåƒæŸ¥æ‰¾é¡ºåºå¦‚ä¸‹ï¼š
>
> 1. æœ¬åœ°é•œåƒç¼“å­˜
> 2. Docker Hubï¼ˆé»˜è®¤ï¼‰
> 3. ç§æœ‰é•œåƒä»“åº“ï¼ˆå¦‚æžœæŒ‡å®šäº†ä»“åº“åœ°å€ï¼‰
> 4. å…¶ä»–å…¬å…±é•œåƒä»“åº“ï¼ˆå¦‚ Quay.ioã€GCRã€ECR ç­‰ï¼‰
> 5. æœ¬åœ°æž„å»ºçš„é•œåƒ

ADDå‘½ä»¤å¯ä»¥ç›´æŽ¥å°†æœ¬åœ°ä¸‹è½½å¥½çš„æ¯”å¦‚jdkç›´æŽ¥æ‰“å…¥docker...ç‰›é€¼

### Docker network 20250131

> ### **1. ä»€ä¹ˆæ˜¯ç½‘ç»œæŽ¥å£ï¼Ÿ**
>
> ç½‘ç»œæŽ¥å£ï¼ˆNetwork Interfaceï¼‰æ˜¯è®¾å¤‡ï¼ˆå¦‚è®¡ç®—æœºã€æœåŠ¡å™¨ã€è·¯ç”±å™¨ç­‰ï¼‰ä¸Žç½‘ç»œä¹‹é—´è¿›è¡Œæ•°æ®ä¼ è¾“çš„ç¡¬ä»¶æˆ–è½¯ä»¶ç»„ä»¶ã€‚å®ƒå¯ä»¥æ˜¯ç‰©ç†çš„ï¼ˆå¦‚ç½‘å¡ï¼‰æˆ–è™šæ‹Ÿçš„ï¼ˆå¦‚è™šæ‹Ÿç½‘æ¡¥ã€è™šæ‹Ÿä»¥å¤ªç½‘æŽ¥å£ï¼‰ã€‚
>
> - **ç‰©ç†ç½‘ç»œæŽ¥å£**ï¼šé€šå¸¸æ˜¯ç¡¬ä»¶è®¾å¤‡ï¼Œå¦‚ä»¥å¤ªç½‘å¡ï¼ˆ`ens33`ï¼‰ã€æ— çº¿ç½‘å¡ï¼ˆ`wlp2s0`ï¼‰ã€‚
> - **è™šæ‹Ÿç½‘ç»œæŽ¥å£**ï¼šç”±è½¯ä»¶å®žçŽ°ï¼Œå¦‚è™šæ‹Ÿç½‘æ¡¥ï¼ˆ`docker0`ï¼‰ã€è™šæ‹Ÿä»¥å¤ªç½‘æŽ¥å£ï¼ˆ`veth`ï¼‰ã€å›žçŽ¯æŽ¥å£ï¼ˆ`lo`ï¼‰ã€‚
>
> ### **2. ç½‘ç»œæŽ¥å£çš„ä½œç”¨**
>
> ç½‘ç»œæŽ¥å£çš„ä¸»è¦ä½œç”¨æ˜¯ï¼š
>
> 1. **æ•°æ®ä¼ è¾“**ï¼šåœ¨ç½‘ç»œä¸­å‘é€å’ŒæŽ¥æ”¶æ•°æ®åŒ…ã€‚
> 2. **åœ°å€åˆ†é…**ï¼šä¸ºè®¾å¤‡åˆ†é… IP åœ°å€å’Œ MAC åœ°å€ã€‚
> 3. **åè®®æ”¯æŒ**ï¼šæ”¯æŒç½‘ç»œåè®®ï¼ˆå¦‚ TCP/IPï¼‰çš„å®žçŽ°ã€‚
> 4. **ç½‘ç»œéš”ç¦»**ï¼šé€šè¿‡è™šæ‹ŸæŽ¥å£å®žçŽ°ç½‘ç»œéš”ç¦»ï¼ˆå¦‚ Docker å®¹å™¨ç½‘ç»œï¼‰ã€‚
>
> ------
>
> ### **3. ç½‘ç»œæŽ¥å£çš„ç‰©ç†å›¾ä¾‹**
>
> ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„ç½‘ç»œæ‹“æ‰‘å›¾ï¼Œå±•ç¤ºäº†ä¸åŒç±»åž‹çš„ç½‘ç»œæŽ¥å£åŠå…¶ä½œç”¨ï¼š
>
> ```
> +-------------------+       +-------------------+       +-------------------+
> |    Host Machine   |       |    Docker Host    |       |   Remote Server   |
> |                   |       |                   |       |                   |
> |  +-------------+  |       |  +-------------+  |       |  +-------------+  |
> |  |   ens33     |  |       |  |   docker0    |  |       |  |   eth0      |  |
> |  | (Physical)  |  |       |  | (Virtual)    |  |       |  | (Physical)  |  |
> |  +-----+-------+  |       |  +-----+-------+  |       |  +-----+-------+  |
> |        |          |       |        |          |       |        |          |
> |        |          |       |        |          |       |        |          |
> |        |          |       |        |          |       |        |          |
> |  +-----+-------+  |       |  +-----+-------+  |       |  +-----+-------+  |
> |  |   Switch    |  |       |  |   veth       |  |       |  |   Router    |  |
> |  +-----+-------+  |       |  +-----+-------+  |       |  +-----+-------+  |
> |        |          |       |        |          |       |        |          |
> |        |          |       |        |          |       |        |          |
> |        |          |       |        |          |       |        |          |
> |  +-----+-------+  |       |  +-----+-------+  |       |  +-----+-------+  |
> |  |   Internet  |  |       |  |   Container |  |       |  |   Internet  |  |
> |  +-------------+  |       |  +-------------+  |       |  +-------------+  |
> +-------------------+       +-------------------+       +-------------------+
> ```

ens33å°±æ˜¯ä¹‹å‰çš„é¢eth0ï¼Œeth1ä¸€ç±»çš„ï¼Œå½“ç„¶ä¸æ­¢è¿™ä¸‰ç§ç½‘ç»œæŽ¥å£ï¼Œç”¨ipconfigæ‰“å‡ºæ¥çš„ä¿¡æ¯å¯ä»¥çœ‹

> åœ¨ Docker å®¹å™¨ç½‘ç»œä¸­ï¼Œ`veth`ï¼ˆVirtual Ethernet Deviceï¼Œè™šæ‹Ÿä»¥å¤ªç½‘è®¾å¤‡ï¼‰å’Œ `docker0`ï¼ˆé»˜è®¤çš„è™šæ‹Ÿç½‘æ¡¥ï¼‰ä¸€èµ·å·¥ä½œï¼Œå®žçŽ°äº†å®¹å™¨ä¸Žå®¿ä¸»æœºåŠå…¶ä»–å®¹å™¨çš„ç½‘ç»œé€šä¿¡ã€‚å®ƒä»¬çš„å…³ç³»å¯ä»¥ç†è§£ä¸º **â€œæ¡¥æŽ¥ç½‘ç»œä¸­çš„è™šæ‹Ÿç½‘å¡â€** å’Œ **â€œè¿žæŽ¥è¿™äº›ç½‘å¡çš„äº¤æ¢æœºâ€**ã€‚
>
> `docker0` æ˜¯ Docker é»˜è®¤åˆ›å»ºçš„ **Linux ç½‘æ¡¥ï¼ˆbridgeï¼‰**ï¼Œç›¸å½“äºŽä¸€ä¸ªäºŒå±‚äº¤æ¢æœºï¼Œè´Ÿè´£è¿žæŽ¥æ‰€æœ‰ Docker å®¹å™¨çš„ç½‘ç»œæŽ¥å£ï¼Œå¹¶æä¾›å®ƒä»¬ä¹‹é—´çš„é€šä¿¡ã€‚
>
> - é»˜è®¤æƒ…å†µä¸‹ï¼Œ`docker0` å…·æœ‰ä¸€ä¸ªåˆ†é…çš„ç½‘æ®µï¼ˆä¾‹å¦‚ `172.17.0.1/16`ï¼‰ã€‚
> - å®¹å™¨ä¹‹é—´çš„é€šä¿¡é€šè¿‡ `docker0` è¿›è¡Œè½¬å‘ï¼Œç±»ä¼¼ç‰©ç†ç½‘ç»œä¸­çš„äº¤æ¢æœºã€‚
> - å®¿ä¸»æœºå¯ä»¥é€šè¿‡ `docker0` è®¿é—®æ‰€æœ‰è¿žæŽ¥åˆ°è¯¥ç½‘æ¡¥çš„å®¹å™¨ã€‚
>
> `veth` æ˜¯ **ä¸€å¯¹è™šæ‹Ÿç½‘å¡ï¼ˆveth pairï¼‰**ï¼Œç”¨æ¥è¿žæŽ¥ Linux ç½‘ç»œå‘½åç©ºé—´ï¼ˆNetwork Namespaceï¼‰ã€‚å®ƒçš„ç‰¹ç‚¹æ˜¯ï¼š
>
> - `veth` æ€»æ˜¯æˆå¯¹å‡ºçŽ°ï¼ˆ`vethX` å’Œ `vethY`ï¼‰ï¼Œç±»ä¼¼ç½‘çº¿çš„ä¸¤ç«¯ã€‚
> - ä¸€ç«¯ï¼ˆ`vethX`ï¼‰è¿žæŽ¥åˆ° `docker0` ç½‘æ¡¥ï¼Œå¦ä¸€ç«¯ï¼ˆ`vethY`ï¼‰æ”¾å…¥å®¹å™¨çš„ç½‘ç»œå‘½åç©ºé—´ï¼Œå……å½“å®¹å™¨çš„ `eth0`ã€‚
> - `veth` è®¾å¤‡å¯ä»¥ä¼ è¾“æ•°æ®ï¼Œç±»ä¼¼ç‰©ç†ç½‘å¡+ç½‘çº¿ã€‚



**Docker ç½‘ç»œæ¨¡å¼**

| **ç½‘ç»œæ¨¡å¼** | **bridge**                           | **host**                 | **none**         |
| :----------- | :----------------------------------- | :----------------------- | :--------------- |
| **æè¿°**     | é»˜è®¤æ¨¡å¼ï¼Œä½¿ç”¨ `docker0` ç½‘æ¡¥        | å®¹å™¨ç›´æŽ¥ä½¿ç”¨ä¸»æœºçš„ç½‘ç»œæ ˆ | å®¹å™¨æ²¡æœ‰ç½‘ç»œæŽ¥å£ |
| **ç½‘ç»œéš”ç¦»** | æ˜¯                                   | å¦                       | æ˜¯               |
| **IP åœ°å€**  | å®¹å™¨åˆ†é…ç‹¬ç«‹çš„ IPï¼ˆå¦‚ `172.17.0.2`ï¼‰ | ä½¿ç”¨ä¸»æœºçš„ IP åœ°å€       | æ—  IP åœ°å€       |

> - **`bridge` æ¨¡å¼**ï¼š
>   - é»˜è®¤æ¨¡å¼ï¼Œå®¹å™¨é€šè¿‡ `docker0` ç½‘æ¡¥ä¸Žä¸»æœºå’Œå…¶ä»–å®¹å™¨é€šä¿¡ã€‚
>   - éœ€è¦æ‰‹åŠ¨æ˜ å°„ç«¯å£ï¼ˆå¦‚ `-p 8080:80`ï¼‰ã€‚
>   - é€‚ç”¨äºŽå¤šå®¹å™¨é€šä¿¡çš„åœºæ™¯ã€‚
> - **`host` æ¨¡å¼**ï¼š
>   - å®¹å™¨ç›´æŽ¥ä½¿ç”¨ä¸»æœºçš„ç½‘ç»œæ ˆï¼Œæ€§èƒ½è¾ƒé«˜ã€‚
>   - ä¸éœ€è¦ç«¯å£æ˜ å°„ï¼Œå®¹å™¨ç«¯å£ç›´æŽ¥ç»‘å®šåˆ°ä¸»æœºç«¯å£ã€‚
>   - é€‚ç”¨äºŽé«˜æ€§èƒ½éœ€æ±‚çš„åœºæ™¯ã€‚
> - **`none` æ¨¡å¼**ï¼š
>   - å®¹å™¨æ²¡æœ‰ç½‘ç»œæŽ¥å£ï¼Œå®Œå…¨éš”ç¦»ç½‘ç»œã€‚
>   - é€‚ç”¨äºŽä¸éœ€è¦ç½‘ç»œè®¿é—®çš„åœºæ™¯ã€‚

> - `bridge` æ¨¡å¼æ˜¯é»˜è®¤æ¨¡å¼ï¼Œé€‚åˆå¤§å¤šæ•°åœºæ™¯ã€‚
> - `host` æ¨¡å¼æ€§èƒ½é«˜ï¼Œä½†å®‰å…¨æ€§è¾ƒä½Žã€‚
> - `none` æ¨¡å¼å®Œå…¨éš”ç¦»ç½‘ç»œï¼Œé€‚åˆç‰¹æ®Šéœ€æ±‚ã€‚

=>bridgeæ¨¡å¼ä½¿ç”¨docker0ç½‘æ¡¥ æ˜¯ä¸»æµï¼Ÿ

=>å¯¹ä¸€ä¸ªdockerå®¹å™¨è€Œè¨€ï¼Œä»–æœ‰å¯èƒ½æœ‰ä¸¤ä¸ªç½‘ç»œæŽ¥å£ï¼Œé™¤äº†å›žçŽ¯ä¹‹å¤–ï¼Œeth0å°±æ˜¯dockerç»™å®ƒå•ç‹¬åˆ†é…çš„ï¼ï¼è¿™ä¹Ÿæ˜¯å®¹å™¨å†…éƒ¨ç›‘è§† *:5000 ä¸Ž localhost:5000ä¸åŒçš„åŽŸå› ï¼(2025.2.16)

```
1: lo: <LOOPBACK,UP,LOWER_UP> mtu 65536 qdisc noqueue state UNKNOWN
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
2: eth0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UP
    link/ether 02:42:ac:11:00:02 brd ff:ff:ff:ff:ff:ff
    inet 172.17.0.2/16 brd 172.17.255.255 scope global eth0
```

è¿˜æœ‰containeræ¨¡å¼ï¼Œå°±æ˜¯å¤šä¸ªcontainerå…¬ç”¨ä¸€ä¸ªè™šæ‹Ÿç½‘å¡eth0ä¸Žbridgeè¿žæŽ¥ã€‚

è¿˜å¯ä»¥è‡ªå®šä¹‰ç½‘ç»œæ¨¡å¼ï¼Œå¥½åƒå¯ä»¥æŒ‡å®šä¸»æœºåä¸Žipå¯¹åº”ï¼Œè€Œä¸æ˜¯åƒbridgeé‚£æ ·è‡ªåŠ¨åˆ†é…

### Docker compose 20250203

> **Docker Compose** æ˜¯ä¸€ä¸ªç”¨äºŽå®šä¹‰å’Œè¿è¡Œå¤šå®¹å™¨ Docker åº”ç”¨ç¨‹åºçš„å·¥å…·ã€‚å®ƒé€šè¿‡ä¸€ä¸ª **YAML æ–‡ä»¶**ï¼ˆé€šå¸¸å‘½åä¸º `docker-compose.yml`ï¼‰æ¥æè¿°åº”ç”¨ç¨‹åºçš„ **æœåŠ¡ã€ç½‘ç»œå’Œæ•°æ®å·**ï¼Œå¹¶ä¸”å¯ä»¥ä½¿ç”¨ **ä¸€æ¡å‘½ä»¤** (`docker-compose up`) æ¥å¯åŠ¨æˆ–ç®¡ç†æ‰€æœ‰å®¹å™¨ã€‚
>
> ä»¥ä¸‹æ˜¯ä¸€ä¸ª `docker-compose.yml` ç¤ºä¾‹
>
> ```yaml
> version: '3.8'
> 
> services:
>   web:
>     image: python:3.9
>     container_name: flask_app
>     working_dir: /app
>     volumes:
>       - .:/app
>     ports:
>       - "5000:5000"
>     command: python app.py
>     depends_on:
>       - db
> 
>   db:
>     image: mysql:5.7
>     container_name: mysql_db
>     restart: always
>     environment:
>       MYSQL_ROOT_PASSWORD: root
>       MYSQL_DATABASE: mydb
>       MYSQL_USER: user
>       MYSQL_PASSWORD: password
>     ports:
>       - "3306:3306"
> ```
>
> å¯åŠ¨æ‰€æœ‰æœåŠ¡: docker-compose up



> **Docker Compose** ä¸»è¦ç”¨äºŽ **å•æœº** ä¸Šç®¡ç†å¤šä¸ª Docker å®¹å™¨ã€‚
>
> **Kubernetesï¼ˆK8sï¼‰** ä¸»è¦ç”¨äºŽ **åˆ†å¸ƒå¼çŽ¯å¢ƒ**ï¼Œç®¡ç†å¤šä¸ªèŠ‚ç‚¹ä¸Šçš„å®¹å™¨ã€‚

Docker Composeç”¨äºŽæœ¬åœ°å¼€å‘ã€æµ‹è¯•çŽ¯å¢ƒï¼Œè€ŒK8sç”Ÿäº§çº§å®¹å™¨ç¼–æŽ’



### Portainer ä¸Ž CIG 20250204

> Portainer æ˜¯ä¸€ä¸ªè½»é‡çº§çš„å®¹å™¨ç®¡ç†å·¥å…·ï¼Œæ—¨åœ¨ç®€åŒ– DockerçŽ¯å¢ƒçš„ç®¡ç†ã€‚å®ƒæä¾›äº†ä¸€ä¸ªç›´è§‚çš„ Web UIï¼Œä½¿ç”¨æˆ·èƒ½å¤Ÿæ–¹ä¾¿åœ°éƒ¨ç½²ã€ç®¡ç†å’Œç›‘æŽ§å®¹å™¨åº”ç”¨ï¼Œè€Œæ— éœ€ä½¿ç”¨å¤æ‚çš„å‘½ä»¤è¡Œå·¥å…·ã€‚

=>windowsä¸æ˜¯ç›´æŽ¥æœ‰guiç•Œé¢å˜›...

Portainer å°±æ˜¯è½»é‡çº§ï¼Œé‡é‡çº§çš„ç›‘æŽ§ç³»ç»Ÿå°±è¦ç”¨CAdvisor+InfulxDB+Granfana

> ### **â‘  cAdvisorï¼ˆContainer Advisorï¼‰**
>
> - **åŠŸèƒ½**ï¼šç”± Google å¼€å‘çš„å¼€æºå·¥å…·ï¼Œä¸“é—¨ç”¨äºŽæ”¶é›†å®¹å™¨çš„èµ„æºä½¿ç”¨æƒ…å†µï¼ˆCPUã€å†…å­˜ã€ç£ç›˜ I/Oã€ç½‘ç»œæµé‡ç­‰ï¼‰ã€‚
>   - è½»é‡çº§ï¼Œç›´æŽ¥è¿è¡Œåœ¨å®¿ä¸»æœºä¸Š
>   - åŽŸç”Ÿæ”¯æŒ Dockerï¼Œæ— éœ€é¢å¤–é…ç½®
>   - æä¾› REST APIï¼Œæ”¯æŒ Prometheusã€InfluxDB ç­‰å¤šç§åŽç«¯å­˜å‚¨
>
> ### **InfluxDBï¼ˆæ—¶åºæ•°æ®åº“ï¼‰**
>
> - **åŠŸèƒ½**ï¼šä¸€ä¸ªé«˜æ•ˆçš„æ—¶åºæ•°æ®åº“ï¼Œä¸“é—¨ç”¨äºŽå­˜å‚¨æ—¶é—´åºåˆ—æ•°æ®ï¼Œå¦‚æŒ‡æ ‡ã€äº‹ä»¶ã€æ—¥å¿—ç­‰ã€‚
>   - é€‚ç”¨äºŽé«˜åžåé‡å†™å…¥çš„åœºæ™¯
>   - æ”¯æŒ SQL ç±»ä¼¼çš„æŸ¥è¯¢è¯­è¨€ï¼ˆInfluxQLï¼‰
>   - å¯ä¸Ž cAdvisorã€Telegrafã€Grafana è½»æ¾é›†æˆ
>
> ### **â‘¢ Grafanaï¼ˆæ•°æ®å¯è§†åŒ–ï¼‰**
>
> - **åŠŸèƒ½**ï¼šä¸€ä¸ªå¼ºå¤§çš„æ•°æ®å¯è§†åŒ–å·¥å…·ï¼Œå¯è¿žæŽ¥å¤šä¸ªæ•°æ®æºï¼ˆInfluxDBã€Prometheusã€MySQL ç­‰ï¼‰å¹¶åˆ›å»ºè‡ªå®šä¹‰ç›‘æŽ§é¢æ¿ã€‚
>   - ç›´è§‚çš„ä»ªè¡¨ç›˜ï¼ˆDashboardï¼‰
>   - çµæ´»çš„æ•°æ®æŸ¥è¯¢å’Œå‘Šè­¦åŠŸèƒ½
>   - å¤šç§æ’ä»¶æ”¯æŒï¼ˆGraphiteã€InfluxDBã€Prometheusã€Elasticsearchï¼‰

cAdvisoråªèƒ½å­˜å‚¨2åˆ†é’Ÿçš„æ•°æ®ï¼Œæ‰€ä»¥éœ€è¦InfluxDB

**cAdvisorã€InfluxDB å’Œ Grafana** éƒ½å¯ä»¥è¿è¡Œåœ¨å®¹å™¨ä¸­ï¼Œé€šå¸¸ä½¿ç”¨ **Docker å®¹å™¨** éƒ¨ç½²å®ƒä»¬ï¼Œä»¥å®žçŽ°å¿«é€Ÿå®‰è£…ã€éš”ç¦»çŽ¯å¢ƒå’Œä¾¿æ·ç®¡ç†ã€‚æœ€åŽç”¨ **Docker Compose** æˆ– **Kubernetes (K8s)** æ¥ç®¡ç†è¿™äº›å®¹å™¨ï¼Œä½¿å®ƒä»¬èƒ½å¤Ÿè‡ªåŠ¨å¯åŠ¨ã€é‡å¯å¹¶ç›¸äº’è¿žæŽ¥ã€‚

ä¸ºGranfanaé…ç½®æ¥è‡ªInfluxDBçš„æ•°æ®æº...



# JIRA

> Jira å’Œ Azure DevOps Boards éƒ½æ˜¯æ”¯æŒæ•æ·å¼€å‘çš„é¡¹ç›®ç®¡ç†å·¥å…·ï¼Œæä¾›å¦‚å·¥ä½œé¡¹ç®¡ç†ã€çœ‹æ¿è§†å›¾ã€å†²åˆºè§„åˆ’ã€Backlog ç®¡ç†ç­‰æ ¸å¿ƒåŠŸèƒ½ï¼Œé€‚ç”¨äºŽæ•æ·å›¢é˜Ÿçš„æ—¥å¸¸åä½œã€‚ä¸¤è€…çš„ä¸»è¦åŒºåˆ«åœ¨äºŽä¾§é‡ç‚¹ä¸åŒï¼š**Jira** æ›´çµæ´»ï¼Œæ”¯æŒé«˜åº¦è‡ªå®šä¹‰çš„å·¥ä½œæµå’Œä¸°å¯Œçš„æŠ¥è¡¨ï¼Œé€‚åˆäº§å“ç®¡ç†å’Œè·¨éƒ¨é—¨åä½œï¼›è€Œ **Azure DevOps Boards** æ·±åº¦é›†æˆä»£ç åº“ã€æž„å»ºã€éƒ¨ç½²å’Œæµ‹è¯•ï¼Œè´´åˆå¼€å‘æµç¨‹ï¼Œé€‚åˆä»¥å¼€å‘ä¸ºä¸­å¿ƒçš„å›¢é˜Ÿï¼Œå°¤å…¶æ˜¯åœ¨ä½¿ç”¨ Azure Pipelines æˆ– Repos çš„æƒ…å†µä¸‹æ›´å…·ä¼˜åŠ¿ã€‚

## Azure DevOps Boards 20250407

Azure Boards ä¸­çš„å±‚çº§ç»“æž„:

```
Epic  # å²è¯—,ä»£è¡¨ å¤§åž‹ç›®æ ‡æˆ–ä¸šåŠ¡éœ€æ±‚,é€šå¸¸è·¨è¶Šå¤šä¸ªå›¢é˜Ÿã€å¤šä¸ªå†²åˆºç”šè‡³å¤šä¸ªç‰ˆæœ¬
â””â”€â”€ Feature # Epic çš„ç»„æˆéƒ¨åˆ†ï¼Œä»£è¡¨ä¸€ä¸ªå¯äº¤ä»˜çš„ã€æœ‰ä¸šåŠ¡ä»·å€¼çš„å­ç›®æ ‡
       â””â”€â”€ Task # è¿›ä¸€æ­¥ç»†åŒ–ï¼Œç”¨äºŽå¼€å‘ã€æµ‹è¯•ã€è®¾è®¡ç­‰å…·ä½“å·¥ä½œ
```

å·¦ä¾§èœå•ï¼ˆBoardsã€Backlogsã€Work Items ç­‰ï¼‰å…¶å®žæ˜¯ä»Žä¸åŒè§’åº¦æ¥æŸ¥çœ‹å’Œç®¡ç†å·¥ä½œé¡¹ï¼ˆWork Itemsï¼‰:

| èœå•é¡¹     | ä½œç”¨       | è§†è§’       | é€‚åˆäººç¾¤               |
| ---------- | ---------- | ---------- | ---------------------- |
| Work Items | å¿«é€ŸæŸ¥æ‰¾   | å•ä¸ªå·¥ä½œé¡¹ | æ‰€æœ‰äºº                 |
| Boards     | çŠ¶æ€çœ‹æ¿   | çŠ¶æ€æµè½¬   | å¼€å‘ã€æµ‹è¯•             |
| Backlogs   | å±‚çº§è§„åˆ’   | éœ€æ±‚ç»“æž„   | äº§å“ç»ç†ã€Scrum Master |
| Sprints    | å†²åˆºç®¡ç†   | ä»»åŠ¡æ‰§è¡Œ   | Scrum å›¢é˜Ÿ             |
| Queries    | è‡ªå®šä¹‰æœç´¢ | çµæ´»åˆ†æž   | PMã€QAã€æŠ€æœ¯è´Ÿè´£äºº     |

=>æ‰€ä»¥èœå•é¡¹é’ˆå¯¹ä¸åŒçš„äººç¾¤å“ˆï¼ŒWork Itemsæ˜¯æœ€æ ¸å¿ƒçš„ï¼Œä½ å¢žåŠ ä¸€ä¸ªFeatureï¼Œå¯ä»¥æ²¡æœ‰çˆ¶èŠ‚ç‚¹ï¼Œå³ä¸å¿…attachåˆ°æŸä¸€ä¸ªEpicä¸ŠåŽ»ï¼Œä½ åœ¨Backlogså¯ä»¥ç”¨è½¬åˆ° Featureè§†è§’ä½ å°±å¯ä»¥çœ‹åˆ°è¿™ä¸ªFeatureçš„

=>å¦å¤–ä¸ä»…æ˜¯Work Itemsï¼Œä½ åœ¨Backlogsï¼ŒSprintsé‡Œå‡å¯ä»¥å¢žåŠ è®¸å¤šå±‚çº§çš„ä»»åŠ¡ï¼Œç„¶åŽåœ¨å…¶ä»–èœå•ä¸­ä¹Ÿä¼šå…³è”æ˜¾ç¤ºå‡ºæ¥ã€‚å…¶åº•å±‚éƒ½æ˜¯å„ç§ä»»åŠ¡ï¼Œä¸åŒçš„èœå•å°±æ˜¯ä¸åŒç­›é€‰ä¸åŒè§†è§’çš„å‘ˆçŽ°è€Œå·²ï¼
